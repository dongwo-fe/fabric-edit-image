/*! For license information please see main.3828d331.chunk.js.LICENSE.txt */
(this["webpackJsonp@dm/edit-image-example"]=this["webpackJsonp@dm/edit-image-example"]||[]).push([[0],{135:function(e,t,n){e.exports=n(303)},136:function(e,t,n){},144:function(e,t){},145:function(e,t){},146:function(e,t){},302:function(e,t,n){},303:function(e,t,n){"use strict";n.r(t);n(136);var a,r=n(0),o=n.n(r),i=n(20),c=n.n(i),s=n(14),l=n(12),u=n(7),d=n(134),f=n(133),v=n(5),m=n(11),p=n(126),h=n(127),g=n(16),b=n(17),j=n(3),_=n(84),y=n.n(_),O=n(15),w=n(89),x=n(88),k=n(86),E=n.n(k),S=n(306),C=n(87),A=n.n(C),N=n(61),I=n(62),L=n(132),T=n.n(L);function H(){H=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,a){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),c=new A(a||[]);return r(i,"_invoke",{value:k(e,n,c)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var f="suspendedStart",v="executing",m="completed",p={};function h(){}function g(){}function b(){}var j={};l(j,i,(function(){return this}));var _=Object.getPrototypeOf,y=_&&_(_(N([])));y&&y!==n&&a.call(y,i)&&(j=y);var O=b.prototype=h.prototype=Object.create(j);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(r,o,i,c){var s=d(e[r],e,o);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&a.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(u).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var o;r(this,"_invoke",{value:function(e,a){function r(){return new t((function(t,r){n(e,a,t,r)}))}return o=o?o.then(r,r):r()}})}function k(t,n,a){var r=f;return function(o,i){if(r===v)throw new Error("Generator is already running");if(r===m){if("throw"===o)throw i;return{value:e,done:!0}}for(a.method=o,a.arg=i;;){var c=a.delegate;if(c){var s=E(c,a);if(s){if(s===p)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===f)throw r=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=v;var l=d(t,n,a);if("normal"===l.type){if(r=a.done?m:"suspendedYield",l.arg===p)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(r=m,a.method="throw",a.arg=l.arg)}}}function E(t,n){var a=n.method,r=t.iterator[a];if(r===e)return n.delegate=null,"throw"===a&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),p;var o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,p;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function N(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(a.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return g.prototype=b,r(O,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,s,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},w(x.prototype),l(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,a,r,o){void 0===o&&(o=Promise);var i=new x(u(e,n,a,r),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(O),l(O,s,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=N,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(a,r){return c.type="throw",c.arg=t,n.next=a,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:N(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),p}},t}var R={workContent:"_styles-module__workContent__2NudB"},P=function(e,t){var n=null;return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];n&&clearTimeout(n),n=setTimeout((function(){e.apply(void 0,r)}),t)}};function z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function M(e){if(!e)return"0";var t=(""+e).replace(/[^0-9]/g,"");return Number(t)+""}function W(e){return"url(\"data:image/svg+xml,%3Csvg height='18' width='18' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'%3E%3Cg fill='none' transform='rotate(".concat(e," 16 16)'%3E%3Cpath d='M22.4484 0L32 9.57891L22.4484 19.1478V13.1032C17.6121 13.8563 13.7935 17.6618 13.0479 22.4914H19.2141L9.60201 32.01L0 22.4813H6.54912C7.36524 14.1073 14.0453 7.44023 22.4484 6.61688V0Z' fill='white'/%3E%3Cpath d='M24.0605 3.89587L29.7229 9.57896L24.0605 15.252V11.3562C17.0479 11.4365 11.3753 17.0895 11.3048 24.0879H15.3048L9.60201 29.7308L3.90932 24.0879H8.0806C8.14106 15.3223 15.2645 8.22345 24.0605 8.14313V3.89587Z' fill='black'/%3E%3C/g%3E%3C/svg%3E \") 12 12,crosshair")}var U=function(){function e(t){Object(g.a)(this,e),this.canvas=t}return Object(b.a)(e,[{key:"centerH",value:function(e,t){return this.canvas._centerObject(t,new j.fabric.Point(e.getCenterPoint().x,t.getCenterPoint().y))}},{key:"center",value:function(e,t){var n=e.getCenterPoint();return this.canvas._centerObject(t,n)}},{key:"centerV",value:function(e,t){return this.canvas._centerObject(t,new j.fabric.Point(t.getCenterPoint().x,e.getCenterPoint().y))}},{key:"position",value:function(e){var t=this.canvas.getActiveObject();if(["centerH","center","centerV"].includes(e)&&t){var n=this.canvas.getObjects().find((function(e){return"workspace"===e.id}));n&&this[e](n,t),this.canvas.renderAll()}}}]),e}(),G="left,right,down,up",D="shift+left,shift+right,shift+down,shift+up",Y="delete,backspace",B="ctrl+z,command+z",X="ctrl+shift+z,command+shift+z",F="enter",Z="esc",q="command+*,command+*,ctrl+*,ctrl+*";var J="changeScale",V="clipImage",Q="show_loading",K=new y.a,$=function(e){return"number"===typeof e},ee=function(e){return"undefined"===typeof e};j.fabric.Object.NUM_FRACTION_DIGITS=4;var te=function(e,t){e&&e.setControlsVisibility({mt:t,mb:t,ml:t,mr:t,tl:t,tr:t,bl:t,br:t})},ne=function(e,t){e&&e.setControlsVisibility({copy:t,delete:t,clip:t,rotate:t,topBg:t})};function ae(e,t,n,a,r,o,i){void 0!==i&&(e.save(),e.translate(t,n),e.rotate(j.fabric.util.degreesToRadians(i)),e.drawImage(a,-r/2,-o/2,r,o),e.restore())}function re(e){!function(){var e=document.createElement("img");function t(t,n,a,r,o){ae(t,n,a,e,25,25,o.angle)}e.src="https://ossprod.jrdaimao.com/file/1691055938230666.svg",j.fabric.Object.prototype.controls.tl=new j.fabric.Control({x:-.5,y:-.5,cursorStyleHandler:j.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingEqually,render:t}),j.fabric.Object.prototype.controls.bl=new j.fabric.Control({x:-.5,y:.5,cursorStyleHandler:j.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingEqually,render:t}),j.fabric.Object.prototype.controls.tr=new j.fabric.Control({x:.5,y:-.5,cursorStyleHandler:j.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingEqually,render:t}),j.fabric.Object.prototype.controls.br=new j.fabric.Control({x:.5,y:.5,cursorStyleHandler:j.fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingEqually,render:t})}(),function(){var e=document.createElement("img");e.src="https://ossprod.jrdaimao.com/file/1691055918106919.svg";var t=document.createElement("img");function n(t,n,a,r,o){ae(t,n,a,e,20,25,o.angle)}function a(e,n,a,r,o){ae(e,n,a,t,25,20,o.angle)}t.src="https://ossprod.jrdaimao.com/file/1691055964267980.svg",j.fabric.Object.prototype.controls.ml=new j.fabric.Control({x:-.5,y:0,offsetX:-1,cursorStyleHandler:j.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingXOrSkewingY,getActionName:j.fabric.controlsUtils.scaleOrSkewActionName,render:n}),j.fabric.Object.prototype.controls.mr=new j.fabric.Control({x:.5,y:0,offsetX:1,cursorStyleHandler:j.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingXOrSkewingY,getActionName:j.fabric.controlsUtils.scaleOrSkewActionName,render:n}),j.fabric.Object.prototype.controls.mb=new j.fabric.Control({x:0,y:.5,offsetY:1,cursorStyleHandler:j.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingYOrSkewingX,getActionName:j.fabric.controlsUtils.scaleOrSkewActionName,render:a}),j.fabric.Object.prototype.controls.mt=new j.fabric.Control({x:0,y:-.5,offsetY:-1,cursorStyleHandler:j.fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:j.fabric.controlsUtils.scalingYOrSkewingX,getActionName:j.fabric.controlsUtils.scaleOrSkewActionName,render:a})}(),function(){var e=document.createElement("img");e.src="https://ossprod.jrdaimao.com/file/1691574701262500.svg",j.fabric.Object.prototype.controls.rotate=new j.fabric.Control({y:.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,actionHandler:j.fabric.controlsUtils.rotationWithSnapping,offsetY:25,actionName:"rotate",cursorStyle:"pointer",render:function(t,n,a,r,o){ae(t,n,a,e,60,60,o.angle)}})}(),function(){var e=document.createElement("img");e.src="https://ossprod.jrdaimao.com/file/1691978616647204.svg";var t=document.createElement("img");t.src="https://ossprod.jrdaimao.com/file/1691660518949720.svg";var n=document.createElement("img");n.src="https://ossprod.jrdaimao.com/file/1691662370382182.svg";var a=document.createElement("img");function r(e,t){var n=t.target;if(n){var a=n.canvas;K.emit(Q,!0),n.clone((function(e){e.set({id:z(),left:n.left+20,top:n.top+20,sourceSrc:n.sourceSrc,rawScaleX:n.rawScaleX,rawScaleY:n.rawScaleY,rectDiffLeft:n.rectDiffLeft,rectDiffTop:n.rectDiffTop,prevWidth:n.prevWidth,prevHeight:n.prevHeight}),e.setCoords(),a.add(e),a.setActiveObject(e),a.renderAll(),K.emit(Q,!1)}))}}function o(e,t){var n=t.target;if(n){var a=n.canvas,r=a.getObjects().find((function(e){return"currentClipRect"===e.id}));r&&a.remove(r),a.remove(n),a.requestRenderAll()}}a.src="https://ossprod.jrdaimao.com/file/1691718842537240.svg",j.fabric.Object.prototype.controls.topBg=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:function(){},offsetY:-25,cursorStyle:"pointer",render:function(t,n,a,r,o){"image"===o.type&&ae(t,n,a,e,136,68,o.angle),"i-text"===o.type&&ae(t,n,a,e,90,68,o.angle)}}),j.fabric.Object.prototype.controls.copy=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:r,offsetY:-25,offsetX:-30,cursorStyle:"pointer",render:function(e,n,a,r,o){"image"===o.type&&ae(e,n,a,t,30,30,o.angle)}}),j.fabric.Object.prototype.controls.delete=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:o,offsetY:-25,offsetX:30,cursorStyle:"pointer",render:function(e,t,a,r,o){"image"===o.type&&ae(e,t,a,n,30,30,o.angle)}}),j.fabric.Object.prototype.controls.clip=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:function(e,t){var n=t.target;if("image"===n.type){var a=n.canvas,r=n.left,o=n.top,i=n.sourceSrc,c=n.rawScaleX||n.scaleX,s=n.rawScaleY||n.scaleY,l=n.rectDiffLeft,u=n.rectDiffTop,d=a.getObjects().findIndex((function(e){return e.id===n.id})),f=n.getScaledWidth(),v=n.getScaledHeight();n.clone((function(e){return n.set({cloneObject:e})})),i&&(n.setSrc(i,(function(){a.renderAll()}),{crossOrigin:"anonymous"}),n.set({id:"clipRawImage",scaleX:c,scaleY:s,left:ee(l)?n.left:n.left-l*n.scaleX,top:ee(u)?n.top:n.top-u*n.scaleY})),n.bringToFront(),ne(n,!1);var m=new j.fabric.Rect({left:r,top:o,fill:"rgba(0,0,0,0.3)",originX:"left",originY:"top",stroke:"black",opacity:1,width:f,height:v,hasRotatingPoint:!1,transparentCorners:!1,cornerColor:"white",cornerStrokeColor:"black",borderColor:"black",cornerSize:12,padding:0,cornerStyle:"circle",borderDashArray:[5,5],borderScaleFactor:1.3,id:"currentClipRect",lockMovementX:!0,lockMovementY:!0,hoverCursor:"default"});n.set({sourceSrc:n.sourceSrc||n._element.src});var p=!1,g=!1;m.on("mousedown",(function(e){return Object(h.a)(e),p=!0})),m.on("scaling",(function(){return p=!1})),m.on("mousemove",(function(e){var t=e.e;if(p){te(m,!1),n.set({left:n.left+t.movementX,top:n.top+t.movementY}),n.left>m.left&&n.set({left:m.left});var r=m.getScaledWidth();n.left+n.getScaledWidth()<=m.left+r&&n.set({left:m.left+r-n.getScaledWidth()}),n.top>m.top&&n.set({top:m.top});var o=m.getScaledHeight();n.top+n.getScaledHeight()<=m.top+o&&n.set({top:m.top+o-n.getScaledHeight()}),a.renderAll()}})),m.on("mouseup",(function(){p=!1,te(m,!0),a.renderAll()})),m.on("scaling",(function(e){var t=e.transform.target;t.left<n.left&&t.set({left:n.left}),t.top<n.top&&t.set({top:n.top}),t.left+t.getScaledWidth()>n.left+n.getScaledWidth()&&t.set({left:n.left+n.getScaledWidth()-t.getScaledWidth()}),t.top+t.getScaledHeight()>n.top+n.getScaledHeight()&&t.set({top:n.top+n.getScaledHeight()-t.getScaledHeight()}),n.getScaledWidth()/t.getScaledWidth()<1&&t.set({scaleX:n.getScaledWidth()/m.getScaledWidth()*t.get("scaleX"),left:n.left}),n.getScaledHeight()/t.getScaledHeight()<1&&t.set({scaleY:n.getScaledHeight()/m.getScaledHeight()*t.get("scaleY"),top:n.top}),a.renderAll()})),n.on("moving",(function(e){var t=e.transform.target;t.left>m.left&&t.set({left:m.left}),t.top>m.top&&t.set({top:m.top});var n=m.getScaledWidth();t.left<m.left+n-t.getScaledWidth()&&t.set({left:m.left+n-t.getScaledWidth()});var r=m.getScaledHeight();t.top<m.top+r-t.getScaledHeight()&&t.set({top:m.top+r-t.getScaledHeight()}),a.renderAll()})),n.on("scaling",(function(e){var t=e.transform.target;t.left>m.left&&t.set({left:m.left}),t.top>m.top&&t.set({top:m.top}),m.getScaledWidth()/t.getScaledWidth()>1&&t.set({scaleX:m.getScaledWidth()*t.get("scaleX")/t.getScaledWidth()}),m.getScaledHeight()/t.getScaledHeight()>1&&t.set({scaleY:m.getScaledHeight()*t.get("scaleY")/t.getScaledHeight()}),a.renderAll()})),n.on("mousedown",(function(){return g=!0})),n.on("mousemove",(function(){g&&(te(n,!1),a.renderAll())})),n.on("mouseup",(function(){g=!1,te(n,!0),a.renderAll()})),ne(m,!1),a.add(m),a.setActiveObject(m),a.renderAll(),K.emit(V,{visible:!0,rawIndex:d,clipImageId:n.id})}},offsetY:-25,offsetX:0,cursorStyle:"pointer",render:function(e,t,n,r,o){"image"===o.type&&ae(e,t,n,a,30,30,o.angle)}}),j.fabric.Object.prototype.controls.textC=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:r,offsetY:-25,offsetX:-15,cursorStyle:"pointer",render:function(e,n,a,r,o){"i-text"===o.type&&ae(e,n,a,t,30,30,o.angle)}}),j.fabric.Object.prototype.controls.textdelete=new j.fabric.Control({y:-.5,cursorStyleHandler:j.fabric.controlsUtils.rotationStyleHandler,mouseUpHandler:o,offsetY:-25,offsetX:15,cursorStyle:"pointer",render:function(e,t,a,r,o){"i-text"===o.type&&ae(e,t,a,n,30,30,o.angle)}})}(),j.fabric.Object.prototype.set({transparentCorners:!1,borderColor:"#51B9F9",cornerColor:"#FFF",borderScaleFactor:2.5,cornerStyle:"circle",cornerStrokeColor:"#0E98FC",borderOpacityWhenMoving:1})}var oe=function(e,t){var n=t?"left":"top",a=t?"width":"height";e.sort((function(e,t){return e[n]-t[n]}));var r,o=[],i=Object.assign({},e[0]),c=Object(p.a)(e);try{for(c.s();!(r=c.n()).done;){var s=r.value,l=Object.assign({},s);i[n]+i[a]>=l[n]?i[a]=Math.max(i[n]+i[a],l[n]+l[a])-i[n]:(o.push(i),i=Object.assign({},l))}}catch(u){c.e(u)}finally{c.f()}return o.push(i),o},ie=function(e,t){e.save();var n=t.left,a=t.top,r=t.width,o=t.height,i=t.stroke,c=t.lineWidth;e.beginPath(),i&&(e.strokeStyle=i),e.lineWidth=c||1,e.moveTo(n,a),e.lineTo(n+r,a+o),e.stroke(),e.restore()},ce=function(e,t){e.save();var n=t.left,a=t.top,r=t.text,o=t.fill,i=t.align,c=t.angle,s=t.fontSize;o&&(e.fillStyle=o),e.textAlign=i||"left",e.textBaseline="top",e.font="".concat(s||10,"px sans-serif"),c&&(e.translate(n,a),e.rotate(Math.PI/180*c),e.translate(-n,-a)),e.fillText(r,n,a),e.restore()},se=function(e,t){e.save();var n=t.left,a=t.top,r=t.width,o=t.height,i=t.fill,c=t.stroke,s=t.strokeWidth;e.beginPath(),i&&(e.fillStyle=i),e.rect(n,a,r,o),e.fill(),c&&(e.strokeStyle=c,e.lineWidth=s||1,e.stroke()),e.restore()},le=function(e,t){e.save();var n=t.isHorizontal,a=t.left,r=t.top,o=t.width,i=t.height,c=t.backgroundColor,s=n?e.createLinearGradient(a,i/2,a+o,i/2):e.createLinearGradient(o/2,r,o/2,i+r),l=new j.fabric.Color(c);l.setAlpha(0),s.addColorStop(0,l.toRgba()),s.addColorStop(.33,c),s.addColorStop(.67,c),s.addColorStop(1,l.toRgba()),se(e,{left:a,top:r,width:o,height:i,fill:s}),e.restore()};var ue=function(){function e(t){var n=this;Object(g.a)(this,e),this.activeOn="up",this.eventHandler={calcObjectRect:P(this.calcObjectRect.bind(this),15),clearStatus:this.clearStatus.bind(this),canvasMouseDown:this.canvasMouseDown.bind(this),canvasMouseMove:P(this.canvasMouseMove.bind(this),15),canvasMouseUp:this.canvasMouseUp.bind(this),render:function(e){e.ctx&&n.render()}},this.lastAttr={status:"out",cursor:void 0,selection:void 0},this.getCommonEventInfo=function(e){if(n.tempGuidelLine&&e.absolutePointer)return{e:e.e,transform:n.tempGuidelLine.get("transform"),pointer:{x:e.absolutePointer.x,y:e.absolutePointer.y},target:n.tempGuidelLine}},this.options=Object.assign({ruleSize:20,fontSize:10,enabled:!1,backgroundColor:"#fff",borderColor:"#ddd",highlightColor:"#007fff",textColor:"#888"},t),this.ctx=this.options.canvas.getContext(),j.fabric.util.object.extend(this.options.canvas,{ruler:this}),j.fabric.GuideLine||(j.fabric.GuideLine=j.fabric.util.createClass(j.fabric.Line,{type:"GuideLine",selectable:!1,hasControls:!1,hasBorders:!1,stroke:"#4bec13",originX:"center",originY:"center",padding:4,globalCompositeOperation:"difference",axis:"horizontal",initialize:function(e,t){var n=this,a="horizontal"===t.axis;this.hoverCursor=a?"ns-resize":"ew-resize";var r=a?[-999999,e,999999,e]:[e,-999999,e,999999];t[a?"lockMovementX":"lockMovementY"]=!0,this.callSuper("initialize",r,t),this.on("mousedown:before",(function(e){"down"===n.activeOn&&n.canvas.setActiveObject(n,e.e)})),this.on("moving",(function(e){n.canvas.ruler.options.enabled&&n.isPointOnRuler(e.e)?n.moveCursor="not-allowed":n.moveCursor=n.isHorizontal()?"ns-resize":"ew-resize",n.canvas.fire("guideline:moving",{target:n,e:e.e})})),this.on("mouseup",(function(e){n.canvas.ruler.options.enabled&&n.isPointOnRuler(e.e)?n.canvas.remove(n):(n.moveCursor=n.isHorizontal()?"ns-resize":"ew-resize",n.canvas.fire("guideline:mouseup",{target:n,e:e.e}))})),this.on("removed",(function(){n.off("removed"),n.off("mousedown:before"),n.off("moving"),n.off("mouseup")}))},getBoundingRect:function(e,t){this.bringToFront();var n=this.isHorizontal(),a=this.callSuper("getBoundingRect",e,t);return a[n?"top":"left"]+=a[n?"height":"width"]/2,a[n?"height":"width"]=0,a},isPointOnRuler:function(e){var t=this.isHorizontal(),n=this.canvas.ruler.isPointOnRuler(new j.fabric.Point(e.offsetX,e.offsetY));return!!(t&&"horizontal"===n||!t&&"vertical"===n)&&n},isHorizontal:function(){return 0===this.height}}),j.fabric.GuideLine.fromObject=function(e,t){var n=(0,j.fabric.util.object.clone)(e,!0),a=0===n.height;n.xy=a?n.y1:n.x1,n.axis=a?"horizontal":"vertical",j.fabric.Object._fromObject(n.type,n,(function(e){delete e.xy,t&&t(e)}),"xy")}),this.options.enabled&&this.enable()}return Object(b.a)(e,[{key:"destroy",value:function(){this.disable()}},{key:"clearGuideline",value:function(){var e;(e=this.options.canvas).remove.apply(e,Object(m.a)(this.options.canvas.getObjects(j.fabric.GuideLine.prototype.type)))}},{key:"showGuideline",value:function(){this.options.canvas.getObjects(j.fabric.GuideLine.prototype.type).forEach((function(e){e.set("visible",!0)})),this.options.canvas.renderAll()}},{key:"hideGuideline",value:function(){this.options.canvas.getObjects(j.fabric.GuideLine.prototype.type).forEach((function(e){e.set("visible",!1)})),this.options.canvas.renderAll()}},{key:"enable",value:function(){this.options.enabled=!0,this.options.canvas.on("after:render",this.eventHandler.calcObjectRect),this.options.canvas.on("after:render",this.eventHandler.render),this.options.canvas.on("mouse:down",this.eventHandler.canvasMouseDown),this.options.canvas.on("mouse:move",this.eventHandler.canvasMouseMove),this.options.canvas.on("mouse:up",this.eventHandler.canvasMouseUp),this.options.canvas.on("selection:cleared",this.eventHandler.clearStatus),this.showGuideline(),this.render()}},{key:"disable",value:function(){this.options.canvas.off("after:render",this.eventHandler.calcObjectRect),this.options.canvas.off("after:render",this.eventHandler.render),this.options.canvas.off("mouse:down",this.eventHandler.canvasMouseDown),this.options.canvas.off("mouse:move",this.eventHandler.canvasMouseMove),this.options.canvas.off("mouse:up",this.eventHandler.canvasMouseUp),this.options.canvas.off("selection:cleared",this.eventHandler.clearStatus),this.hideGuideline(),this.options.enabled=!1}},{key:"render",value:function(){var e,t,n=this.options.canvas.viewportTransform;n&&(this.draw({isHorizontal:!0,rulerLength:this.getSize().width,startCalibration:null!==(e=this.startCalibration)&&void 0!==e&&e.x?this.startCalibration.x:-n[4]/n[0]}),this.draw({isHorizontal:!1,rulerLength:this.getSize().height,startCalibration:null!==(t=this.startCalibration)&&void 0!==t&&t.y?this.startCalibration.y:-n[5]/n[3]}),le(this.ctx,{isHorizontal:!0,left:-10,top:-10,width:2*this.options.ruleSize+10,height:this.options.ruleSize+10,backgroundColor:this.options.backgroundColor}),le(this.ctx,{isHorizontal:!1,left:-10,top:-10,width:this.options.ruleSize+10,height:2*this.options.ruleSize+10,backgroundColor:this.options.backgroundColor}))}},{key:"getSize",value:function(){return{width:this.options.canvas.width||0,height:this.options.canvas.height||0}}},{key:"getZoom",value:function(){return this.options.canvas.getZoom()}},{key:"draw",value:function(e){var t=this,n=e.isHorizontal,a=e.rulerLength,r=e.startCalibration,o=this.getZoom(),i=function(e){for(var t=[.02,.03,.05,.1,.2,.5,1,2,5,10,18],n=0;n<t.length&&t[n]<e;)n++;return[5e3,2500,1e3,500,250,100,50,25,10,5,2][n-1]||5e3}(o),c=a/o,s=Math[r>0?"floor":"ceil"](r/i)*i,l=s-r,u=this.getSize();se(this.ctx,{left:0,top:0,width:n?u.width:this.options.ruleSize,height:n?this.options.ruleSize:u.height,fill:this.options.backgroundColor,stroke:this.options.borderColor});for(var d=new j.fabric.Color(this.options.textColor),f=0;f+l<=Math.ceil(c);f+=i){var m=(l+f)*o,p=s+f+"",h=10*p.length/4,g=n?m-h-1:this.options.ruleSize/2-this.options.fontSize/2-4,b=n?this.options.ruleSize/2-this.options.fontSize/2-4:m+h;ce(this.ctx,{text:p,left:g,top:b,fill:d.toRgb(),angle:n?0:-90})}for(var _=0;_+l<=Math.ceil(c);_+=i){var y=Math.round((l+_)*o),O=n?y:this.options.ruleSize-8,w=n?this.options.ruleSize-8:y,x=n?0:8,k=n?8:0;ie(this.ctx,{left:O,top:w,width:x,height:k,stroke:d.toRgb()})}if(this.objectRect){var E=n?"x":"y";this.objectRect[E].forEach((function(e){if(e.skip!==E){var a=function(e){return Math.round(e/o+r)+""},i=a(n?e.left:e.top),c=a(n?e.left+e.width:e.top+e.height),s=i===c,l={isHorizontal:n,width:n?160:t.options.ruleSize-8,height:n?t.options.ruleSize-8:160,backgroundColor:t.options.backgroundColor};le(t.ctx,Object(v.a)(Object(v.a)({},l),{},{left:n?e.left-80:0,top:n?0:e.top-80})),s||le(t.ctx,Object(v.a)(Object(v.a)({},l),{},{left:n?e.width+e.left-80:0,top:n?0:e.height+e.top-80}));var u=new j.fabric.Color(t.options.highlightColor);u.setAlpha(.5),se(t.ctx,{left:n?e.left:t.options.ruleSize-8,top:n?t.options.ruleSize-8:e.top,width:n?e.width:8,height:n?8:e.height,fill:u.toRgba()});var d=t.options.ruleSize/2-t.options.fontSize/2-4,f={fill:u.toRgba(),angle:n?0:-90};ce(t.ctx,Object(v.a)(Object(v.a)({},f),{},{text:i,left:n?e.left-2:d,top:n?d:e.top-2,align:s?"center":n?"right":"left"})),s||ce(t.ctx,Object(v.a)(Object(v.a)({},f),{},{text:c,left:n?e.left+e.width+2:d,top:n?d:e.top+e.height+2,align:n?"left":"right"}));var m=s?8:14;u.setAlpha(1);var p={width:n?0:m,height:n?m:0,stroke:u.toRgba()};ie(t.ctx,Object(v.a)(Object(v.a)({},p),{},{left:n?e.left:t.options.ruleSize-m,top:n?t.options.ruleSize-m:e.top})),s||ie(t.ctx,Object(v.a)(Object(v.a)({},p),{},{left:n?e.left+e.width:t.options.ruleSize-m,top:n?t.options.ruleSize-m:e.top+e.height}))}}))}}},{key:"calcObjectRect",value:function(){var e=this,t=this.options.canvas.getActiveObjects();if(0!==t.length){var n=t.reduce((function(t,n){var a=n.getBoundingRect(!1,!0);if(n.group){var r=Object(v.a)({top:0,left:0,width:0,height:0,scaleX:1,scaleY:1},n.group);a.width*=r.scaleX,a.height*=r.scaleY;var o=r.width/2+r.left,i=(r.width/2+(n.left||0))*(1-r.scaleX);a.left+=(o-i)*e.getZoom();var c=r.height/2+r.top,s=(r.height/2+(n.top||0))*(1-r.scaleY);a.top+=(c-s)*e.getZoom()}return n instanceof j.fabric.GuideLine&&(a.skip=n.isHorizontal()?"x":"y"),t.push(a),t}),[]);0!==n.length&&(this.objectRect={x:oe(n,!0),y:oe(n,!1)})}}},{key:"clearStatus",value:function(){this.objectRect=void 0}},{key:"isPointOnRuler",value:function(e){return new j.fabric.Rect({left:0,top:0,width:this.options.ruleSize,height:this.options.canvas.height}).containsPoint(e)?"vertical":!!new j.fabric.Rect({left:0,top:0,width:this.options.canvas.width,height:this.options.ruleSize}).containsPoint(e)&&"horizontal"}},{key:"canvasMouseDown",value:function(e){if(e.pointer&&e.absolutePointer){var t=this.isPointOnRuler(e.pointer);t&&"up"===this.activeOn&&(this.lastAttr.selection=this.options.canvas.selection,this.options.canvas.selection=!1,this.activeOn="down",this.tempGuidelLine=new j.fabric.GuideLine("horizontal"===t?e.absolutePointer.y:e.absolutePointer.x,{axis:t,visible:!1}),this.options.canvas.add(this.tempGuidelLine),this.options.canvas.setActiveObject(this.tempGuidelLine),this.options.canvas._setupCurrentTransform(e.e,this.tempGuidelLine,!0),this.tempGuidelLine.fire("down",this.getCommonEventInfo(e)))}}},{key:"canvasMouseMove",value:function(e){if(e.pointer){if(this.tempGuidelLine&&e.absolutePointer){var t={};"horizontal"===this.tempGuidelLine.axis?t.top=e.absolutePointer.y:t.left=e.absolutePointer.x,this.tempGuidelLine.set(Object(v.a)(Object(v.a)({},t),{},{visible:!0})),this.options.canvas.requestRenderAll();var n=this.getCommonEventInfo(e);this.options.canvas.fire("object:moving",n),this.tempGuidelLine.fire("moving",n)}var a=this.isPointOnRuler(e.pointer);a?"out"!==this.lastAttr.status&&a===this.lastAttr.status||(this.lastAttr.cursor=this.options.canvas.defaultCursor,this.options.canvas.defaultCursor="horizontal"===a?"ns-resize":"ew-resize",this.lastAttr.status=a):"out"!==this.lastAttr.status&&(this.options.canvas.defaultCursor=this.lastAttr.cursor,this.lastAttr.status="out")}}},{key:"canvasMouseUp",value:function(e){var t;"down"===this.activeOn&&(this.options.canvas.selection=this.lastAttr.selection,this.activeOn="up",null===(t=this.tempGuidelLine)||void 0===t||t.fire("up",this.getCommonEventInfo(e)),this.tempGuidelLine=void 0)}}]),e}();var de=function(){function e(t){Object(g.a)(this,e),this.canvas=t,this._init(),this.isDown=!1}return Object(b.a)(e,[{key:"_init",value:function(){var e=this;this.canvas.on("mouse:down",(function(t){if(e.isDown=!0,t.target&&"group"===t.target.type){var n=e._getGroupTextObj(t);n?(e._bedingEditingEvent(n,t),e.canvas.setActiveObject(n),n.enterEditing()):e.canvas.setActiveObject(t.target)}})),this.canvas.on("mouse:up",(function(){e.isDown=!1})),this.canvas.on("mouse:move",(function(t){if(e.isDown&&t.target&&"group"===t.target.type)e._getGroupTextObj(t)}))}},{key:"_getGroupTextObj",value:function(e){var t,n=this.canvas.getPointer(e.e,!0),a=this.canvas._searchPossibleTargets(null===(t=e.target)||void 0===t?void 0:t._objects,n);return!(!a||!this.isText(a))&&a}},{key:"_bedingEditingEvent",value:function(e,t){var n=this;if(t.target){var a=t.target.left,r=t.target.top,o=this._unGroup()||[];e.on("editing:exited",(function t(){var i=n.canvas.getObjects().filter((function(e){return e.id&&o.includes(e.id)}));i.forEach((function(e){return n.canvas.remove(e)}));var c=new j.fabric.Group(Object(m.a)(i));c.set("left",a),c.set("top",r),c.set("id",z()),e.off("editing:exited",t),n.canvas.add(c),n.canvas.discardActiveObject().renderAll()}))}}},{key:"_unGroup",value:function(){var e=[],t=this.canvas.getActiveObject();if(t)return t.getObjects().forEach((function(t){var n=z();e.push(n),t.set("id",n)})),t.toActiveSelection(),e}},{key:"isText",value:function(e){return e.type&&["i-text","text","textbox"].includes(e.type)}}]),e}(),fe=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(e){var a;Object(g.a)(this,n),(a=t.call(this)).canvas=e,a.editorWorkspace=null;var r=function(e){var t,n=!1,a=e.getSelectionContext(),r=1;function o(e){i(e.x1>e.x2?e.x2:e.x1,e.y+.5,e.x2>e.x1?e.x2:e.x1,e.y+.5)}function i(e,o,i,c){null==t||n||(a.save(),a.lineWidth=1,a.strokeStyle="rgb(0,255,0)",a.beginPath(),a.moveTo(e*r+t[4],o*r+t[5]),a.lineTo(i*r+t[4],c*r+t[5]),a.stroke(),a.restore())}function c(e,t){e=Math.round(e),t=Math.round(t);for(var n=e-4,a=e+4;n<=a;n++)if(n===t)return!0;return!1}var s=[],l=[];return e.on("mouse:down",(function(){t=e.viewportTransform,r=e.getZoom()})),e.on("object:moving",(function(n){if(void 0!==t&&void 0!==n.target){var a=n.target,r=e.getObjects(),o=a.getCenterPoint(),i=o.x,u=o.y,d=a.getBoundingRect(),f=d.height/t[3],v=d.width/t[0],m=!1,p=!1;if(e._currentTransform){for(var h=r.length;h--;)if(r[h]!==a&&!(a instanceof j.fabric.GuideLine&&r[h]instanceof j.fabric.GuideLine)){var g=r[h].getCenterPoint(),b=g.x,_=g.y,y=r[h].getBoundingRect(),O=y.height/t[3],w=y.width/t[0];c(b,i)&&(p=!0,s.push({x:b,y1:_<u?_-O/2-5:_+O/2+5,y2:u>_?u+f/2+5:u-f/2-5}),a.setPositionByOrigin(new j.fabric.Point(b,u),"center","center")),c(b-w/2,i-v/2)&&(p=!0,s.push({x:b-w/2,y1:_<u?_-O/2-5:_+O/2+5,y2:u>_?u+f/2+5:u-f/2-5}),a.setPositionByOrigin(new j.fabric.Point(b-w/2+v/2,u),"center","center")),c(b+w/2,i+v/2)&&(p=!0,s.push({x:b+w/2,y1:_<u?_-O/2-5:_+O/2+5,y2:u>_?u+f/2+5:u-f/2-5}),a.setPositionByOrigin(new j.fabric.Point(b+w/2-v/2,u),"center","center")),c(_,u)&&(m=!0,l.push({y:_,x1:b<i?b-w/2-5:b+w/2+5,x2:i>b?i+v/2+5:i-v/2-5}),a.setPositionByOrigin(new j.fabric.Point(i,_),"center","center")),c(_-O/2,u-f/2)&&(m=!0,l.push({y:_-O/2,x1:b<i?b-w/2-5:b+w/2+5,x2:i>b?i+v/2+5:i-v/2-5}),a.setPositionByOrigin(new j.fabric.Point(i,_-O/2+f/2),"center","center")),c(_+O/2,u+f/2)&&(m=!0,l.push({y:_+O/2,x1:b<i?b-w/2-5:b+w/2+5,x2:i>b?i+v/2+5:i-v/2-5}),a.setPositionByOrigin(new j.fabric.Point(i,_+O/2-f/2),"center","center"))}m||(l.length=0),p||(s.length=0)}}})),e.on("before:render",(function(){try{e.clearContext(e.contextTop)}catch(t){console.log(t)}})),e.on("after:render",(function(){for(var e=s.length;e--;)i((t=s[e]).x+.5,t.y1>t.y2?t.y2:t.y1,t.x+.5,t.y2>t.y1?t.y2:t.y1);for(var t,n=l.length;n--;)o(l[n]);s.length=0,l.length=0})),e.on("mouse:up",(function(){s.length=0,l.length=0,e.renderAll()})),{disable:function(){return n=!0},enable:function(){return n=!1}}}(e),o=r.disable,i=r.enable;return a.disableGuidelines=o,a.enableGuidelines=i,function(e){Object(O.a)(G,(function(t,n){var a=e.getActiveObject();if(a){switch(n.key){case"left":if(void 0===a.left)return;a.set("left",a.left-1);break;case"right":if(void 0===a.left)return;a.set("left",a.left+1);break;case"down":if(void 0===a.top)return;a.set("top",a.top+1);break;case"up":if(void 0===a.top)return;a.set("top",a.top-1)}e.renderAll()}})),Object(O.a)(D,(function(t,n){var a=e.getActiveObject();if(a){switch(n.key){case"shift+left":if(void 0===a.left)return;a.set("left",a.left-10);break;case"shift+right":if(void 0===a.left)return;a.set("left",a.left+10);break;case"shift+down":if(void 0===a.top)return;a.set("top",a.top+10);break;case"shift+up":if(void 0===a.top)return;a.set("top",a.top-10)}e.renderAll()}}))}(e),re(),function(e){j.fabric.Object.prototype.controls.mtr=new j.fabric.Control({x:-.5,y:-.5,offsetY:-10,offsetX:-10,rotate:20,actionName:"rotate",actionHandler:j.fabric.controlsUtils.rotationWithSnapping,render:function(){return""}}),j.fabric.Object.prototype.controls.mtr2=new j.fabric.Control({x:.5,y:-.5,offsetY:-10,offsetX:10,rotate:20,actionName:"rotate",actionHandler:j.fabric.controlsUtils.rotationWithSnapping,render:function(){return""}}),j.fabric.Object.prototype.controls.mtr3=new j.fabric.Control({x:.5,y:.5,offsetY:10,offsetX:10,rotate:20,actionName:"rotate",actionHandler:j.fabric.controlsUtils.rotationWithSnapping,render:function(){return""}}),j.fabric.Object.prototype.controls.mtr4=new j.fabric.Control({x:-.5,y:.5,offsetY:10,offsetX:-10,rotate:20,actionName:"rotate",actionHandler:j.fabric.controlsUtils.rotationWithSnapping,render:function(){return""}}),e.on("after:render",(function(){var t,n=e.getActiveObject(),a=null===n||void 0===n||null===(t=n.angle)||void 0===t?void 0:t.toFixed(2);void 0!==a&&(j.fabric.Object.prototype.controls.mtr.cursorStyle=W(Number(a)),j.fabric.Object.prototype.controls.mtr2.cursorStyle=W(Number(a)+90),j.fabric.Object.prototype.controls.mtr3.cursorStyle=W(Number(a)+180),j.fabric.Object.prototype.controls.mtr4.cursorStyle=W(Number(a)+270))})),e.on("object:rotating",(function(t){var n,a,r,o=e.lowerCanvasEl.nextSibling,i=null===(n=e.getActiveObject())||void 0===n||null===(a=n.angle)||void 0===a?void 0:a.toFixed(2);if(void 0!==i)switch(null===(r=t.transform)||void 0===r?void 0:r.corner){case"mtr":o.style.cursor=W(Number(i));break;case"mtr2":o.style.cursor=W(Number(i)+90);break;case"mtr3":o.style.cursor=W(Number(i)+180);break;case"mtr4":o.style.cursor=W(Number(i)+270)}}))}(e),new de(e),a.centerAlign=new U(e),a.ruler=function(e,t){var n=new ue(Object(v.a)({canvas:e},t)),a=void 0,r=function(){a=e.getObjects().find((function(e){return"workspace"===e.id}))},o=function(e,t){var n=e.top,a=e.height,r=e.left,o=e.width;if(void 0===n||void 0===a||void 0===r||void 0===o)return!1;var i=t.getBoundingRect(!0,!0),c=i.top,s=i.height,l=i.left,u=i.width;return!(!t.isHorizontal()||!(n>c+1||n+a<c+s-1))||!t.isHorizontal()&&(r>l+1||r+o<l+u-1)};return e.on("guideline:moving",(function(e){if(a){var t=e.target;o(a,t)&&(t.moveCursor="not-allowed")}else r()})),e.on("guideline:mouseup",(function(t){if(a){var n=t.target;o(a,n)&&(e.remove(n),e.setCursor(e.defaultCursor||""))}else r()})),n}(e),a}return Object(b.a)(n,[{key:"_copyActiveSelection",value:function(e){var t=this.canvas;null===e||void 0===e||e.clone((function(e){e.clone((function(e){t.discardActiveObject(),void 0!==e.left&&void 0!==e.top&&(e.canvas=t,e.set({left:e.left+10,top:e.top+10,evented:!0,id:z()}),e.forEachObject((function(e){e.id=z(),t.add(e)})),e.setCoords(),t.setActiveObject(e),t.requestRenderAll())}))}))}},{key:"_copyObject",value:function(e){var t=this.canvas;null===e||void 0===e||e.clone((function(e){void 0!==e.left&&void 0!==e.top&&(t.discardActiveObject(),e.set({left:e.left+10,top:e.top+10,evented:!0,id:z()}),t.add(e),t.setActiveObject(e),t.requestRenderAll())}))}},{key:"clone",value:function(e){var t=e||this.canvas.getActiveObject();t&&("activeSelection"===(null===t||void 0===t?void 0:t.type)?this._copyActiveSelection(t):this._copyObject(t))}},{key:"unGroup",value:function(){var e=this.canvas.getActiveObject();e&&(e.toActiveSelection(),e.getObjects().forEach((function(e){e.set("id",z())})),this.canvas.discardActiveObject().renderAll())}},{key:"group",value:function(){var e=this,t=this.canvas.getActiveObject();if(t){var n=t.toGroup(),a=n.getObjects();n.clone((function(t){t.set("id",z()),e.canvas.remove(n),a.forEach((function(t){e.canvas.remove(t)})),e.canvas.add(t),e.canvas.setActiveObject(t)}))}}},{key:"getWorkspace",value:function(){return this.canvas.getObjects().find((function(e){return"workspace"===e.id}))}},{key:"workspaceSendToBack",value:function(){var e=this.getWorkspace();e&&e.sendToBack()}},{key:"getJson",value:function(){return this.canvas.toJSON(["id","gradientAngle","selectable","hasControls","sourceSrc","rawScaleX","rawScaleY","rectDiffLeft","rectDiffTop","prevWidth","prevHeight","cloneObject"])}},{key:"dragAddItem",value:function(e,t){var n=this.canvas.getSelectionElement().getBoundingClientRect(),a=n.left,r=n.top;if(!(e.x<a||e.y<r||void 0===t.width)){var o={x:e.x-a,y:e.y-r},i=this.canvas.restorePointerVpt(o);t.left=i.x-t.width/2,t.top=i.y,this.canvas.add(t),this.canvas.requestRenderAll()}}}]),n}(y.a),ve=function(){},me=Object(r.createContext)({editor:null,canvas:null,workSpace:null,drawMode:"",selectMode:"",selectIds:[],selectOneType:"",selectActive:[],show:!1,mainUrl:"",isClipImage:!1,clipRawIndex:null,clipImageId:null,setClipRawIndex:ve,setClipImageId:ve,setIsClipImage:ve,setMainUrl:ve,setSelectOneType:ve,setSelectActive:ve,setSelectMode:ve,setSelectIds:ve,setDrawMode:ve,setCanvas:ve,setEditor:ve,setWorkSpace:ve,setShow:ve}),pe=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(u.a)(n,2),i=a[0],c=a[1],s=Object(r.useState)(null),l=Object(u.a)(s,2),d=l[0],f=l[1],v=Object(r.useState)(null),m=Object(u.a)(v,2),p=m[0],h=m[1],g=Object(r.useState)("default"),b=Object(u.a)(g,2),j=b[0],_=b[1],y=Object(r.useState)(""),O=Object(u.a)(y,2),w=O[0],x=O[1],k=Object(r.useState)([]),E=Object(u.a)(k,2),S=E[0],C=E[1],A=Object(r.useState)(""),N=Object(u.a)(A,2),I=N[0],L=N[1],T=Object(r.useState)([]),H=Object(u.a)(T,2),R=H[0],P=H[1],z=Object(r.useState)(!1),M=Object(u.a)(z,2),W=M[0],U=M[1],G=Object(r.useState)(""),D=Object(u.a)(G,2),Y=D[0],B=D[1],X=Object(r.useState)(!1),F=Object(u.a)(X,2),Z=F[0],q=F[1],J=Object(r.useState)(null),V=Object(u.a)(J,2),Q=V[0],K=V[1],$=Object(r.useState)(null),ee=Object(u.a)($,2),te={canvas:i,editor:d,workSpace:p,drawMode:j,selectMode:w,setSelectMode:x,selectIds:S,setSelectIds:C,selectOneType:I,setSelectOneType:L,selectActive:R,setSelectActive:P,setDrawMode:_,setWorkSpace:h,setCanvas:c,setEditor:f,show:W,setShow:U,mainUrl:Y,setMainUrl:B,isClipImage:Z,setIsClipImage:q,clipImageId:Q,setClipImageId:K,clipRawIndex:ee[0],setClipRawIndex:ee[1]};return o.a.createElement(me.Provider,{value:te},t)},he="_index-module__size__25rEe",ge="_index-module__ratio__Z8umb",be="_index-module__title__28Pa_",je="_index-module__content__2c1fu",_e="_index-module__customInput__1bhWg",ye="_index-module__title__9y0uL",Oe="_index-module__inputWrap__3aQ84",we=function(e){var t=e.title,n=e.afterText,a=e.value,r=e.onChange;return o.a.createElement("div",{className:_e},o.a.createElement("div",{className:ye},t),o.a.createElement("div",{className:Oe},o.a.createElement("input",{onChange:r,value:a,type:"text"}),n?o.a.isValidElement(n)?n:o.a.createElement("span",null,n):""))},xe=function(){var e=Object(r.useContext)(me).canvas,t=function(){if(e){var t=null===e||void 0===e?void 0:e.getActiveObject();if(t)return t}};return{getActiveObject:t,setAttr:function(n){if(e){var a=t();a&&(a.set(n),e.renderAll())}}}},ke=["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY"],Ee=function(){var e=Object(r.useContext)(me).canvas,t=xe().getActiveObject;return{changeOwnLock:Object(r.useCallback)((function(n,a){var r=null;(r=a||t())&&(r.hasControls=n,ke.forEach((function(e){r[e]=!n})),r.selectable=n,null===e||void 0===e||e.renderAll())}),[e,t]),changeInRatioLock:Object(r.useCallback)((function(n,a){var r=null;(r=a||t())&&(r.setControlsVisibility({mt:n,mb:n,ml:n,mr:n}),null===e||void 0===e||e.renderAll())}),[e,t])}};function Se(e,t){var n=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,r=Math.pow(10,Math.max(n,a));return(Ce(e,r)-Ce(t,r))/r}function Ce(e,t){var n=e.toString(),a=t.toString(),r=(n.split(".")[1]||"").length,o=(a.split(".")[1]||"").length,i=Math.pow(10,r+o);return Number(n.replace(".",""))*Number(a.replace(".",""))/i}function Ae(e,t){var n=e.toString(),a=t.toString(),r=(n.split(".")[1]||"").length,o=(a.split(".")[1]||"").length,i=Math.pow(10,r+o),c=Ce(e,i),s=Ce(t,i);return Number(c)/Number(s)}function Ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ae(Math.round(Ce(e,Math.pow(10,t))),Math.pow(10,t));return n.toFixed(t)}var Ie=function(e){var t=e.getActiveObject,n=e.showRation,a=e.isWorkSpace,i=Object(r.useContext)(me),c=i.canvas,s=i.workSpace,l=Ee().changeInRatioLock,d=Object(r.useState)(""),f=Object(u.a)(d,2),v=f[0],m=f[1],p=Object(r.useState)(""),h=Object(u.a)(p,2),g=h[0],b=h[1],j=Object(r.useState)(!1),_=Object(u.a)(j,2),y=_[0],O=_[1];Object(r.useEffect)((function(){w()}),[c,t]),Object(r.useEffect)((function(){if(c)return c.on("object:modified",w),function(){c.off("object:modified",w)}}),[c]);var w=function(){var e=t();e&&(m(Ne(e.width)),b(Ne(e.height)),O(function(e){var t=e._controlsVisibility;return!(!t||t.mb||t.ml||t.mr||t.mt)}(e)))};return o.a.createElement("div",{className:he},o.a.createElement(we,{afterText:"\u50cf\u7d20",title:"\u5bbd\u5ea6",value:v,onChange:function(e){return function(e){var n=t();if(n){if(e=M(e),a)return null===s||void 0===s||s.setSize(e,g),void m(e);n.set({width:+e}),null===c||void 0===c||c.renderAll(),m(e)}}(e.target.value)}}),o.a.createElement(we,{afterText:"\u50cf\u7d20",title:"\u9ad8\u5ea6",value:g,onChange:function(e){return function(e){var n=t();if(n){if(e=M(e),a)return null===s||void 0===s||s.setSize(v,e),void b(e);n.set({height:+e}),null===c||void 0===c||c.renderAll(),b(e)}}(e.target.value)}}),n?o.a.createElement("div",{className:ge},o.a.createElement("div",{className:be},"\u6bd4\u4f8b"),o.a.createElement("div",{className:je,onClick:function(){l(y),O((function(e){return!e}))}},o.a.createElement("img",{src:y?"https://ossprod.jrdaimao.com/file/1690955813239228.svg":"https://ossprod.jrdaimao.com/file/1690425288688481.svg",alt:""}))):o.a.createElement("div",{className:ge}))},Le="_index-module__workSpaceAttr__2plhR",Te="_index-module__base__35ejr",He="_index-module__division__2ohzj",Re="_index-module__title__J5Xgh",Pe="_index-module__colorPicker__3uPze",ze="_index-module__position__3JjkO",Me="_index-module__rotate__pZ0Ae",We="_index-module__title__ivS8M",Ue="_index-module__content__25bwl",Ge=function(){var e=Object(r.useContext)(me).canvas,t=xe(),n=t.getActiveObject,a=t.setAttr,i=Object(r.useState)("0"),c=Object(u.a)(i,2),s=c[0],l=c[1],d=Object(r.useState)(0),f=Object(u.a)(d,2),v=f[0],m=f[1],p=Object(r.useState)(0),h=Object(u.a)(p,2),g=h[0],b=h[1];Object(r.useEffect)((function(){j()}),[e]),Object(r.useEffect)((function(){if(e)return e.on("object:modified",j),function(){e.off("object:modified",j)}}),[e]);var j=function(){var e=n();e&&(m(Ne(e.left||0)),b(Ne(e.top||0)),l(Ne(e.angle||0)))};return o.a.createElement("div",{className:ze},o.a.createElement(we,{afterText:"\u50cf\u7d20",value:v,onChange:function(e){return t=M(t=e.target.value),a({left:+t}),void m(t);var t},title:"X"}),o.a.createElement(we,{afterText:"\u50cf\u7d20",value:g,onChange:function(e){return t=M(t=e.target.value),a({top:+t}),void b(t);var t},title:"Y"}),o.a.createElement("div",{className:Me},o.a.createElement("div",{className:We},"\u65cb\u8f6c"),o.a.createElement("div",{className:Ue},o.a.createElement("input",{value:s,onChange:function(t){return function(t){var a=n();a&&(a.rotate(+t),null===e||void 0===e||e.renderAll(),l(t))}(M(t.target.value))},type:"text"}))))},De={transparent:"_index-module__transparent__3zB_Q",title:"_index-module__title__1TUJG",reverseWrap:"_index-module__reverseWrap__2IPAY",visible:"_index-module__visible__37zRW",content:"_index-module__content__1EJOQ"},Ye=function(){var e=Object(r.useContext)(me).canvas,t=xe(),n=t.getActiveObject,a=t.setAttr,i=Object(r.useState)(0),c=Object(u.a)(i,2),s=c[0],l=c[1],d=Object(r.useState)(!1),f=Object(u.a)(d,2),v=f[0],m=f[1];Object(r.useEffect)((function(){var e=n();e&&(l(Ce(e.opacity,100)),m(e.visible||!1))}),[n]);var p=function(t){var a=n();a&&(a.set("flip".concat(t),!a["flip".concat(t)]).setCoords(),null===e||void 0===e||e.renderAll())};return o.a.createElement("div",{className:De.transparent},o.a.createElement("div",{className:_e},o.a.createElement("div",{className:ye},"\u4e0d\u900f\u660e\u5ea6"),o.a.createElement("div",{className:Oe},o.a.createElement("input",{style:{width:48},onChange:function(e){return(t=e.target.value)>100&&(t=100),t=M(t),a({opacity:Ae(t,100)}),void l(+t);var t},value:s,type:"text"}),o.a.createElement("span",null,"%"))),o.a.createElement("div",{className:De.reverse},o.a.createElement("div",{className:De.title},"\u7ffb\u8f6c"),o.a.createElement("div",{className:De.reverseWrap},o.a.createElement("div",{onClick:function(){return p("X")}},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690428298144872.svg",alt:""})),o.a.createElement("div",{onClick:function(){return p("Y")}},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690428330458222.svg",alt:""})))),o.a.createElement("div",{className:De.visible},o.a.createElement("div",{className:De.title},"\u53ef\u89c1\u6027"),o.a.createElement("div",{className:De.content,onClick:function(){a({visible:!v}),m((function(e){return!e}))}},v?o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690428533888278.svg",alt:""}):o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690883271867109.svg",alt:""}))))},Be=[{icon:"https://ossprod.jrdaimao.com/file/1690799178088909.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690802921403421.svg",title:"\u5de6\u5bf9\u9f50",key:"left"},{icon:"https://ossprod.jrdaimao.com/file/1690429259779371.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690799287561375.svg",title:"\u9876\u5bf9\u9f50",key:"top"},{icon:"https://ossprod.jrdaimao.com/file/1690429281715912.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690799296804215.svg",title:"\u5de6\u53f3\u5c45\u4e2d\u5bf9\u9f50",key:"alignCenter"},{icon:"https://ossprod.jrdaimao.com/file/1690429302732969.svg",activeIcon:"https://ossprod.jrdaimao.com/file/169079930793443.svg",title:"\u4e0a\u4e0b\u5c45\u4e2d\u5bf9\u9f50",key:"middleCenter"},{icon:"https://ossprod.jrdaimao.com/file/1690429331770745.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690799316293458.svg",title:"\u53f3\u5bf9\u9f50",key:"right"},{icon:"https://ossprod.jrdaimao.com/file/169042936033629.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690799325119567.svg",title:"\u5e95\u5bf9\u9f50",key:"bottom"}],Xe="_index-module__pageAlign__1MOiB",Fe="_index-module__title__QElwi",Ze="_index-module__shareShapeList__2raEw",qe="_index-module__shareShapeListItem__3uaCf",Je=function(){var e=function(){var e=Object(r.useContext)(me),t=e.canvas,n=e.workSpace,a=Object(r.useCallback)((function(e,n){if(t){var a;if(!(a=n||t.getActiveObject()))return console.log("no allow activeObject");var r=e.left,o=e.top,i={};ee(r)||(i.left=r),ee(o)||(i.top=o),a.set(i),t.renderAll()}}),[t,n]);return{left:function(){a({left:0})},top:function(){a({top:0})},alignCenter:function(){if(t&&n){var e=t.getActiveObject();if(e){var r=(null===n||void 0===n?void 0:n.width)||0;a({left:(r-e.width*e.scaleX)/2})}}},middleCenter:function(){if(t&&n){var e=t.getActiveObject();if(e){var r=(null===n||void 0===n?void 0:n.height)||0;a({top:(r-e.height*e.scaleY)/2})}}},right:function(){if(t&&n){var e=t.getActiveObject();if(e){var r=(null===n||void 0===n?void 0:n.width)||0;a({left:r-e.width*e.scaleX})}}},bottom:function(){if(t&&n){var e=t.getActiveObject();if(e){var r=(null===n||void 0===n?void 0:n.height)||0;a({top:r-e.height*e.scaleY})}}}}}();return o.a.createElement("div",{className:Xe},o.a.createElement("div",{className:Fe},"\u9875\u9762\u5bf9\u9f50"),o.a.createElement("div",{className:Ze},Be.map((function(t){return o.a.createElement("div",{onClick:function(){return function(t){var n;null===(n=e[t.key])||void 0===n||n.call(e)}(t)},key:t.key,className:qe},o.a.createElement("img",{src:t.icon,alt:""}),o.a.createElement("img",{src:t.activeIcon,alt:""}),o.a.createElement("span",null,t.title))}))))},Ve=[{icon:"https://ossprod.jrdaimao.com/file/1690802981178203.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690430789758861.svg",title:"\u4e0a\u79fb\u4e00\u5c42",key:"up"},{icon:"https://ossprod.jrdaimao.com/file/1690430798470387.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690803025753461.svg",title:"\u79fb\u5230\u9876\u5c42",key:"upTop"},{icon:"https://ossprod.jrdaimao.com/file/1690430807961422.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690803032757409.svg",title:"\u4e0b\u79fb\u4e00\u5c42",key:"down"},{icon:"https://ossprod.jrdaimao.com/file/1690430815475268.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690803040084442.svg",title:"\u79fb\u5230\u5e95\u5c42",key:"downTop"}],Qe=function(){var e=Object(r.useContext)(me),t=e.canvas,n=e.editor,a=Object(r.useCallback)((function(e,a){var r,o;if(t){var i;if(a)i=a;else{var c=t.getActiveObjects();c&&1===c.length&&(i=t.getActiveObjects()[0])}i&&(i&&(null===(r=(o=i)[e])||void 0===r||r.call(o)),t.renderAll(),null===n||void 0===n||n.workspaceSendToBack())}}),[t,n]);return{up:Object(r.useCallback)((function(e){a("bringForward",e)}),[t,n]),upTop:Object(r.useCallback)((function(e){a("bringToFront",e)}),[t,n]),down:Object(r.useCallback)((function(e){a("sendBackwards",e)}),[t,n]),downTop:Object(r.useCallback)((function(e){a("sendToBack",e)}),[t,n])}},Ke="_index-module__coverOrder__h4hzi",$e="_index-module__coverOrderTitle__2k_YY",et=function(){var e=Qe();return o.a.createElement("div",{className:Ke},o.a.createElement("div",{className:$e},"\u56fe\u5c42\u987a\u5e8f"),o.a.createElement("div",{className:Ze},Ve.map((function(t){return o.a.createElement("div",{onClick:function(){return function(t){var n;null===(n=e[t.key])||void 0===n||n.call(e)}(t)},key:t.key,className:qe},o.a.createElement("img",{src:t.icon,alt:""}),o.a.createElement("img",{src:t.activeIcon,alt:""}),o.a.createElement("span",null,t.title))}))))},tt={textArea:"_index-module__textArea__2bdXD",title:"_index-module__title__24HCb",fontFamily:"_index-module__fontFamily__3y7kb",size:"_index-module__size__3QZ4S",color:"_index-module__color__3P8p7",colorContent:"_index-module__colorContent__30T-A",style:"_index-module__style__vb8BV",alignGroup:"_index-module__alignGroup__1S5zb",alignGroupActive:"_index-module__alignGroupActive__ZYMEy",styleGroup:"_index-module__styleGroup__1oIDh",styleGroupActive:"_index-module__styleGroupActive__2_4Pb",fixColorPicker:"_index-module__fixColorPicker__1aFhU",disabledSelect:"_index-module__disabledSelect__2Wd1K",select:"_index-module__select__1s-z0",colorPicker:"_index-module__colorPicker__pHtr_"},nt=function(){return o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690959702767983.svg",alt:""})},at={singleValue:function(e){return Object(v.a)(Object(v.a)({},e),{},{color:"#ADADB3",fontWeight:600})},menuList:function(e){return Object(v.a)(Object(v.a)({},e),{},{background:"#1C1D29"})},option:function(e){return Object(v.a)(Object(v.a)({},e),{},{background:"#1C1D29",color:"#ADADB3",height:"32px",lineHeight:"32px",padding:"0px 11px",boxSizing:"border-box",cursor:"pointer","&:hover":{color:"#fff",background:"#2C375E"}})},container:function(e){return Object(v.a)(Object(v.a)({},e),{},{width:"100%"})},control:function(){return{width:"100%",cursor:"pointer",paddingRight:8,boxSizing:"border-box",flex:1,height:28,borderRadius:4,background:"#232634",color:"#ADADB3",fontSize:14,fontWeight:600,display:"flex"}}},rt="_index-module__inputNumber__2oJGQ",ot="_index-module__control__1MYtS",it=function(e){var t=e.value,n=e.onChange,a=Object(r.useState)(t),i=Object(u.a)(a,2),c=i[0],s=i[1],l=Object(r.useRef)();l.current=c;var d=Object(r.useRef)();Object(r.useEffect)((function(){s(t)}),[t]),Object(r.useEffect)((function(){var e;return null===(e=d.current)||void 0===e||e.addEventListener("keydown",f),function(){var e;null===(e=d.current)||void 0===e||e.removeEventListener("keydown",f)}}),[t,n]);var f=function(e){"ArrowUp"===e.key?v():"ArrowDown"===e.key&&m()},v=function(){var e=+l.current+1;s(e),n(e)},m=function(){if(!(l.current<=12)){var e=+l.current-1;s(e),n(e)}};return o.a.createElement("div",{className:rt},o.a.createElement("input",{ref:d,value:c,onChange:function(e){var t=M(e.target.value);s(t),n(t)}}),o.a.createElement("span",{className:ot},o.a.createElement("span",{onClick:v},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690962892247333.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691034645816626.svg",alt:""})),o.a.createElement("span",{onClick:m},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690962924824666.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691035025689960.svg",alt:""}))))},ct=[{src:"https://ossprod.jrdaimao.com/file/1690963862052534.svg",activeSrc:"https://ossprod.jrdaimao.com/file/1690963932538814.svg",key:"left"},{src:"https://ossprod.jrdaimao.com/file/1690963869720196.svg",activeSrc:"https://ossprod.jrdaimao.com/file/1690963940992258.svg",key:"center"},{src:"https://ossprod.jrdaimao.com/file/1690963877465292.svg",activeSrc:"https://ossprod.jrdaimao.com/file/1690963948610334.svg",key:"right"},{src:"https://ossprod.jrdaimao.com/file/1690963884592828.svg",activeSrc:"https://ossprod.jrdaimao.com/file/1690963958787177.svg",key:"justify"}],st=[{label:"\u5e38\u89c4",value:"normal"},{label:"\u7c97\u4f53",value:600}],lt=["serif"],ut=new Map,dt=null,ft=function(){var e=xe().setAttr,t=Object(r.useContext)(bt).setLoading,n=Object(r.useState)([]),a=Object(u.a)(n,2),o=a[0],i=a[1],c=Object(r.useState)(!1),s=Object(u.a)(c,2),d=s[0],f=s[1],v=Object(r.useRef)();return v.current=o,Object(r.useEffect)((function(){Object(l.a)(H().mark((function e(){var t,n;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!dt){e.next=5;break}t=dt,e.next=9;break;case 5:return e.next=7,Promise.resolve([{id:1,fontlibName:"\u96e8\u843d\u5357\u6ce5\u884c\u6977",key:"ylnnxk",fontlibfile:"https://osstest.jrdaimao.com/file/1684482933910660.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1684482969861534.jpg",operator:"",createdAt:"2023-05-19T07:56:12.000Z",updatedAt:"2023-05-19T07:56:12.000Z"},{id:2,fontlibName:"\u6c49\u4eea\u5b59\u5c1a\u9999\u7e41\u4f53",key:"hyssxft",fontlibfile:"https://osstest.jrdaimao.com/file/168448426103890.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1684484313329597.jpg",operator:"",createdAt:"2023-05-19T08:18:35.000Z",updatedAt:"2023-05-19T08:18:35.000Z"},{id:3,fontlibName:"DINBLACK",key:"dinblack",fontlibfile:"https://osstest.jrdaimao.com/file/1684926716437711.otf",fontImgUrl:"https://osstest.jrdaimao.com/file/1684926724428125.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-24T11:12:15.000Z",updatedAt:"2023-05-24T11:12:15.000Z"},{id:4,fontlibName:"Bebas-Regular",key:"bebasRegular",fontlibfile:"https://osstest.jrdaimao.com/file/1684932496362386.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1684932519267667.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-24T12:48:43.000Z",updatedAt:"2023-05-24T12:48:43.000Z"},{id:6,fontlibName:"\u6c49\u4eea\u5c0f\u677e\u6fc0\u6d6a\u4f53",key:"hyxsjl",fontlibfile:"https://osstest.jrdaimao.com/file/1685001304598186.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1685001311019992.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-25T07:55:34.000Z",updatedAt:"2023-05-30T08:58:25.000Z"},{id:13,fontlibName:"\u53f6\u5b50",key:"yezi",fontlibfile:"https://osstest.jrdaimao.com/file/168543899068477.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1685438995766786.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-30T09:30:14.000Z",updatedAt:"2023-05-30T09:30:14.000Z"},{id:14,fontlibName:"Aa\u9a6c\u514b",key:"aamk",fontlibfile:"https://osstest.jrdaimao.com/file/1685439688863813.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1685439704617823.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-30T09:41:46.000Z",updatedAt:"2023-05-30T09:41:46.000Z"},{id:15,fontlibName:"Egosta",key:"egosta",fontlibfile:"https://osstest.jrdaimao.com/file/1685439871684955.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1685439875954916.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-30T09:44:45.000Z",updatedAt:"2023-05-30T09:44:45.000Z"},{id:16,fontlibName:"\u6c49\u4eea\u6c38\u5b57\u4e03\u5de7\u677f",key:"hyyzqqb",fontlibfile:"https://osstest.jrdaimao.com/file/1685440650813535.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1685440825332319.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-05-30T10:00:28.000Z",updatedAt:"2023-05-30T10:00:28.000Z"},{id:17,fontlibName:"\u963f\u91cc\u5988\u5988\u6570\u9ed1\u4f53",key:"alimamasht",fontlibfile:"https://osstest.jrdaimao.com/file/1688626758184870.ttf",fontImgUrl:"https://osstest.jrdaimao.com/file/1688626774033978.jpg",operator:"\u7ba1\u7406\u5458",createdAt:"2023-07-06T06:59:37.000Z",updatedAt:"2023-07-06T06:59:37.000Z"}]);case 7:n=e.sent,t=n.map((function(e){return{value:e.key,label:e.fontlibName,url:e.fontlibfile}}));case 9:f(!0),dt=t,i(t);case 12:case"end":return e.stop()}}),e)})))()}),[]),{fontList:o,runChange:Object(r.useCallback)((function(n){if(!ut.has(n.name)){t(!0);var a="\n     @font-face {\n      font-family: ".concat(n.name,";\n      src: url('").concat(n.src,"');\n     }"),r=document.createElement("style");return r.innerHTML=a,document.body.appendChild(r),new E.a(n.name).load(n.name,2e6).then((function(){ut.set(n.name,!0),t(!1),console.log("Font is available"),e({fontFamily:n.name})}),(function(e){t(!1),document.body.removeChild(r),console.log("Font is not available",e)}))}e({fontFamily:n.name})}),[e]),loadFont:Object(r.useCallback)((function(e){if(!e)return Promise.resolve();var t,n=(t=e,Array.isArray(t)?t.filter((function(e){return"i-text"===e.type&&!lt.includes(e.fontFamily)})):[]),a="";if(n.forEach((function(e){v.current.forEach((function(t){e.fontFamily!==t.value||ut.has(t.value)||(a+="@font-face {font-family: ".concat(t.value,";src: url('").concat(t.url,"');}"))}))})),""===a)return Promise.resolve();var r=document.createElement("style");r.innerHTML=a,document.body.appendChild(r);var o=n.map((function(e){return new Promise((function(t,n){new E.a(e.fontFamily).load(e.fontFamily,2e6).then((function(){ut.set(e.fontFamily,!0),t()})).catch((function(e){n(),console.log("loadFont",e)}))}))}));return Promise.all(o)}),[o,d]),fontLoaded:d}},vt=x.a,mt=function(){var e=xe(),t=e.getActiveObject,n=e.setAttr,a=ft(),i=a.fontList,c=a.runChange,s=Object(r.useState)("12"),l=Object(u.a)(s,2),d=l[0],f=l[1],v=Object(r.useState)("#000000"),m=Object(u.a)(v,2),p=m[0],h=m[1],g=Object(r.useState)(!1),b=Object(u.a)(g,2),j=b[0],_=b[1],y=Object(r.useState)(!1),O=Object(u.a)(y,2),x=O[0],k=O[1],E=Object(r.useState)(!1),S=Object(u.a)(E,2),C=S[0],A=S[1],N=Object(r.useState)(!1),I=Object(u.a)(N,2),L=I[0],T=I[1],H=Object(r.useState)(""),R=Object(u.a)(H,2),P=R[0],z=R[1],M=Object(r.useState)(null),W=Object(u.a)(M,2),U=W[0],G=W[1],D=Object(r.useState)(null),Y=Object(u.a)(D,2),B=Y[0],X=Y[1];Object(r.useEffect)((function(){var e=t();if(e){f(e.get("fontSize")),h(e.get("fill")),A(e.get("underline")),z(e.get("textAlign")),T("italic"===e.get("fontStyle"));var n=e.get("fontWeight"),a="bold"===n||n>500;k(a),G(a?st[1]:st[0])}}),[t,i]),Object(r.useEffect)((function(){var e=t();if(e){var n=e.get("fontFamily");X(i.find((function(e){return e.value===n})))}}),[t,i]),Object(r.useEffect)((function(){var e=document.querySelector("#attr-content");if(e)return e.style.overflow=j?"inherit":"auto",function(){e.style.overflow="auto"}}),[j]);return o.a.createElement("div",{className:tt.textArea},o.a.createElement("div",{className:tt.title},"\u6587\u5b57"),o.a.createElement("div",{className:tt.textAreaContent},o.a.createElement("div",{className:tt.fontFamily},o.a.createElement(w.a,{placeholder:"\u8bf7\u9009\u62e9\u5b57\u4f53",onChange:function(e){c({src:e.url,name:e.value})},components:{DropdownIndicator:nt},className:tt.select,styles:at,isSearchable:!1,options:i,value:B}),o.a.createElement("div",{className:tt.size},o.a.createElement(it,{value:d,onChange:function(e){n({fontSize:+e}),f(e)}}))),o.a.createElement("div",{className:tt.color},o.a.createElement(w.a,{isDisabled:!0,onChange:function(e){G(e),n({fontWeight:e.value})},value:U,components:{DropdownIndicator:nt},className:"".concat(tt.select," ").concat(tt.disabledSelect),styles:at,isSearchable:!1,options:st}),o.a.createElement("div",{className:tt.colorContent,onClick:function(){return _((function(e){return!e}))}},o.a.createElement("div",{style:{background:p}}),o.a.createElement("span",null,p))),o.a.createElement("div",{className:tt.style},o.a.createElement("div",{className:tt.alignGroup},ct.map((function(e){return o.a.createElement("div",{className:e.key===P?tt.alignGroupActive:"",onClick:function(){return function(e){n({textAlign:e.key}),z(e.key)}(e)},key:e.key},o.a.createElement("img",{src:e.src,alt:""}),o.a.createElement("img",{src:e.activeSrc,alt:""}))}))),o.a.createElement("div",{className:tt.styleGroup},o.a.createElement("div",{onClick:function(){n(x?{fontWeight:"normal"}:{fontWeight:"bold"}),k((function(e){return!e}))}},o.a.createElement("div",{className:x?tt.styleGroupActive:""},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690964441564257.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690964450733564.svg",alt:""}))),o.a.createElement("div",{onClick:function(){n(L?{fontStyle:"normal"}:{fontStyle:"italic"}),T((function(e){return!e}))}},o.a.createElement("div",{className:L?tt.styleGroupActive:""},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690971550502930.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690971566471578.svg",alt:""}))),o.a.createElement("div",{onClick:function(){n({underline:!C}),A((function(e){return!e}))}},o.a.createElement("div",{className:C?tt.styleGroupActive:""},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690964614214969.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690964622200366.svg",alt:""})))))),j?o.a.createElement("div",{className:tt.fixColorPicker},o.a.createElement(vt,{className:tt.colorPicker,onChangeComplete:function(e){n({fill:e.hex}),h(e.hex)},color:p})):null)},pt=[{title:"\u5c5e\u6027",key:"Attr",bg:"https://ossprod.jrdaimao.com/file/1690510922616482.svg"},{title:"\u56fe\u5c42",key:"coverage",bg:"https://ossprod.jrdaimao.com/file/1690511949701720.svg"}],ht={image:function(){var e=xe().getActiveObject;return o.a.createElement("div",{className:Le},o.a.createElement("div",{className:Te},o.a.createElement("div",null,o.a.createElement(Ie,{getActiveObject:e,showRation:!0})),o.a.createElement("div",null,o.a.createElement(Ge,null)),o.a.createElement("div",null,o.a.createElement(Ye,null))),o.a.createElement("div",{className:He}),o.a.createElement(Je,null),o.a.createElement("div",{className:He}),o.a.createElement(et,null))},"i-text":function(){var e=xe().getActiveObject;return o.a.createElement("div",{className:Le},o.a.createElement("div",{className:Te},o.a.createElement("div",null,o.a.createElement(Ie,{getActiveObject:e,showRation:!0})),o.a.createElement("div",null,o.a.createElement(Ge,null)),o.a.createElement("div",null,o.a.createElement(Ye,null))),o.a.createElement("div",{className:He}),o.a.createElement(mt,null),o.a.createElement("div",{className:He}),o.a.createElement(Je,null),o.a.createElement("div",{className:He}),o.a.createElement(et,null))}},gt={attrTab:"Attr",loading:!1,loadingText:"",setLoading:function(){},setLoadingText:function(){},setAttrTab:function(){}},bt=Object(r.createContext)(gt),jt=function(e){var t=e.children,n=Object(r.useState)("Attr"),a=Object(u.a)(n,2),i=a[0],c=a[1],s=Object(r.useState)(!1),l=Object(u.a)(s,2),d=l[0],f=l[1],v=Object(r.useState)("\u52a0\u8f7d\u4e2d"),m=Object(u.a)(v,2),p={attrTab:i,loading:d,loadingText:m[0],setLoading:f,setLoadingText:m[1],setAttrTab:c};return o.a.createElement(bt.Provider,{value:p},t)},_t=function(e){return e?new Promise((function(t,n){var a=new Image;a.onload=function(){t()},a.onerror=function(e){n(e)},a.src=e})):Promise.resolve()};function yt(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],a=n.split("/")[1],r=atob(t[1]),o=r.length,i=new Uint8Array(o);o--;)i[o]=r.charCodeAt(o);return new File([i],"".concat(z(),".")+a,{type:n})}var Ot=S.a.create({baseURL:""});Ot.interceptors.response.use((function(e){if("200"===e.data.code)return e.data.data;throw new Error(e.data.message)}),(function(e){throw new Error(e)}));var wt=function(e,t){return Ot.get(e,{params:t})},xt=function(e,t){return Ot.post(e,t)},kt=function(e){var t=new FormData;return t.append("file",e),xt("/api_image/upload",t)},Et=function(){return{error:Object(r.useCallback)((function(e){A()(e,{duration:1500,style:{borderRadius:"10px",background:"#333",color:"#fff"}})}),[])}},St=function(){var e=Object(r.useContext)(me),t=e.workSpace,n=e.canvas,a=e.clipImageId,o=e.clipRawIndex,i=e.setIsClipImage,c=Object(r.useContext)(bt).setLoading,s=Et(),u=Object(r.useCallback)(Object(l.a)(H().mark((function e(){var r,l,u,f,v,m,p,h,g;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&t){e.next=2;break}return e.abrupt("return");case 2:if(r=n.getZoom(),e.prev=3,l=null,u=null,f=null,n.getObjects().forEach((function(e,t){"currentClipRect"===e.id&&(u=e),e.id===a&&(l=e,f=t)})),l&&u){e.next=10;break}return e.abrupt("return");case 10:return c(!0),v=new j.fabric.Rect({left:u.left,top:u.top,width:u.getScaledWidth(),height:u.getScaledHeight(),absolutePositioned:!0}),l.clipPath=v,(m=new Image).crossOrigin="anonymous",n.remove(u),n.setViewportTransform([1,0,0,1,0,0]),p=n.toDataURL({left:v.left,top:v.top,width:v.width,height:v.height}),h=yt(p),e.next=21,kt(h);case 21:g=e.sent,m.src=g.url,null===t||void 0===t||t.setZoomAuto(r),m.onload=function(){n.remove(l);var e=new j.fabric.Image(m,{crossOrigin:"anonymous"});if(e.set({id:l.id,left:v.left,top:v.top,rawScaleX:l.scaleX,rawScaleY:l.scaleY,sourceSrc:l.sourceSrc,rectDiffLeft:v.left-l.left,rectDiffTop:v.top-l.top,prevWidth:v.getScaledWidth(),prevHeight:v.getScaledHeight()}),n.add(e),f!==o)for(;f!==o;)e.sendBackwards(),f--;n.renderAll(),i(!1),c(!1)},e.next=34;break;case 27:e.prev=27,e.t0=e.catch(3),c(!1),null===t||void 0===t||t.setZoomAuto(r),d(),s.error("\u88c1\u526a\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5~"),console.log(e.t0);case 34:case"end":return e.stop()}}),e,null,[[3,27]])}))),[n,t,a,o]),d=Object(r.useCallback)((function(){if(n){var e=null,t=null,r=null;if(n.getObjects().forEach((function(n,o){"currentClipRect"===n.id&&(e=n),n.id===a&&(t=n,r=o)})),t){e&&n.remove(e),n.remove(t);var c=t.get("cloneObject");if(t){if(c.set({id:z(),sourceSrc:t.sourceSrc,rawScaleX:t.scaleX,rawScaleY:t.scaleY,rectDiffLeft:t.rectDiffLeft,rectDiffTop:t.rectDiffTop}),n.add(c),c&&r!==o)for(;r!==o;)c.sendBackwards(),r--;i(!1),n.renderAll()}}}}),[n,t,a,o]);return{saveClipImage:u,cancelClipImage:d}},Ct=function(){function e(t,n){Object(g.a)(this,e),this.canvas=t;var a=document.querySelector("#workspace");if(!a)throw new Error("element #workspace is missing, plz check!");this.workspaceEl=a,this.workspace=null,this.option=n,this.dragMode=!1,this.fill="rgba(255,255,255,1)",this._initBackground(),this._initWorkspace(),this._initResizeObserve(),this._initDring()}return Object(b.a)(e,[{key:"_initBackground",value:function(){this.canvas.setWidth(this.workspaceEl.offsetWidth),this.canvas.setHeight(this.workspaceEl.offsetHeight)}},{key:"_initWorkspace",value:function(){var e=this,t=this.option,n=t.src,a=t.canvasData,r=t.callback;if(a&&a.objects.length){var o=a.objects.find((function(e){return"rect"===e.type}));return this.width=o.width,this.height=this.height=o.height,this.fill=o.fill,void this.canvas.loadFromJSON(a,(function(){var t=e.canvas.getObjects().find((function(e){return"workspace"===e.id}));t.set("selectable",!1),t.set("hasControls",!1),e.setSize(t.width,t.height),e.canvas.renderAll(),r()}))}if(!n)return this.width=1024,this.height=1024,void this._initRect();j.fabric.Image.fromURL(n,(function(t){t.set({type:"image",left:.5,top:.5,id:"mainImg"}),e.width=t.width||1024,e.height=t.height||1024,e._initRect(t)}),{crossOrigin:"anonymous"})}},{key:"_initRect",value:function(e){var t,n,a=new j.fabric.Rect({fill:this.fill,width:this.width,height:this.height,id:"workspace"});a.w=this,a.set("selectable",!1),a.set("hasControls",!1),a.hoverCursor="default",this.canvas.add(a),e&&e.width&&e.height&&this.canvas.add(e),this.canvas.renderAll(),this.workspace=a,null===(t=(n=this.option).callback)||void 0===t||t.call(n),this.auto()}},{key:"setBgColor",value:function(e){var t;this.fill=e,null===(t=this.workspace)||void 0===t||t.set({fill:e}),this.canvas.renderAll()}},{key:"setCenterFromObject",value:function(e){var t=this.canvas,n=e.getCenterPoint(),a=t.viewportTransform;void 0!==t.width&&void 0!==t.height&&a&&(a[4]=t.width/2-n.x*a[0],a[5]=t.height/2-n.y*a[3],t.setViewportTransform(a),t.renderAll())}},{key:"_initResizeObserve",value:function(){var e=this;new ResizeObserver(P((function(){e.auto()}),50)).observe(this.workspaceEl)}},{key:"setSize",value:function(e,t){this._initBackground(),this.width=$(e)?e:+e,this.height=$(t)?t:+t,this.workspace=this.canvas.getObjects().find((function(e){return"workspace"===e.id})),this.workspace.set("width",this.width),this.workspace.set("height",this.height),this.auto()}},{key:"setZoomAuto",value:function(e,t){var n=this,a=this.workspaceEl,r=a.offsetWidth,o=a.offsetHeight;this.canvas.setWidth(r),this.canvas.setHeight(o);var i=this.canvas.getCenter();this.canvas.setViewportTransform(j.fabric.iMatrix.concat()),this.canvas.zoomToPoint(new j.fabric.Point(i.left,i.top),e),this.workspace&&(this.setCenterFromObject(this.workspace),this.workspace.clone((function(e){n.canvas.clipPath=e,n.canvas.requestRenderAll()})),t&&t(this.workspace.left,this.workspace.top))}},{key:"getScale",value:function(){var e=this.workspaceEl.offsetWidth,t=this.workspaceEl.offsetHeight,n=this.width||0,a=this.height||0;return n&&a?Se(e/t<n/a?Ae(e,n):Ae(t,a),.08):0}},{key:"big",value:function(e){var t=this.canvas.getZoom();(t+=e||.05)>=3&&(t=3),K.emit(J,t);var n=this.canvas.getCenter();this.canvas.zoomToPoint(new j.fabric.Point(n.left,n.top),t)}},{key:"small",value:function(e){var t=this.canvas.getZoom();(t-=e||.05)<=.1&&(t=.1),K.emit(J,t);var n=this.canvas.getCenter();this.canvas.zoomToPoint(new j.fabric.Point(n.left,n.top),t<0?.01:t)}},{key:"auto",value:function(){var e=this.getScale();e&&(this.scale=e,K.emit(J,e),this.setZoomAuto(e))}},{key:"one",value:function(){this.setZoomAuto(.8-.08),this.canvas.requestRenderAll()}},{key:"startDring",value:function(){this.dragMode=!0,this.canvas.defaultCursor="grab"}},{key:"endDring",value:function(){this.dragMode=!1,this.canvas.defaultCursor="default"}},{key:"_initDring",value:function(){var e=this;this.canvas.on("mouse:down",(function(t){var n=t.e;(n.altKey||e.dragMode)&&(e.canvas.defaultCursor="grabbing",e.canvas.discardActiveObject(),e._setDring(),this.selection=!1,this.isDragging=!0,this.lastPosX=n.clientX,this.lastPosY=n.clientY,this.requestRenderAll())})),this.canvas.on("mouse:move",(function(t){if(this.isDragging){e.canvas.discardActiveObject(),e.canvas.defaultCursor="grabbing";var n=t.e;if(!this.viewportTransform)return;var a=this.viewportTransform;a[4]+=n.clientX-this.lastPosX,a[5]+=n.clientY-this.lastPosY,this.lastPosX=n.clientX,this.lastPosY=n.clientY,this.requestRenderAll()}})),this.canvas.on("mouse:up",(function(){this.viewportTransform&&(this.setViewportTransform(this.viewportTransform),this.isDragging=!1,this.selection=!0,this.getObjects().forEach((function(e){"workspace"!==e.id&&e.hasControls&&(e.selectable=!0)})),this.requestRenderAll(),e.canvas.defaultCursor="default")})),this.canvas.on("mouse:wheel",(function(e){var t=e.e.deltaY,n=this.getZoom();(n*=Math.pow(.999,t))>20&&(n=20),n<.01&&(n=.01);var a=this.getCenter();this.zoomToPoint(new j.fabric.Point(a.left,a.top),n),e.e.preventDefault(),e.e.stopPropagation()}))}},{key:"_setDring",value:function(){this.canvas.selection=!1,this.canvas.defaultCursor="grab",this.canvas.getObjects().forEach((function(e){e.selectable=!1})),this.canvas.renderAll(),this.canvas.requestRenderAll()}}]),e}(),At=function(){var e=Et(),t=Object(r.useContext)(me),n=t.editor,a=t.canvas,o=t.workSpace,i=t.mainUrl,c=t.isClipImage,s=t.clipImageId,d=t.clipRawIndex,f=St().cancelClipImage,v=Object(r.useState)(!1),m=Object(u.a)(v,2),p=m[0],h=m[1],g=Object(r.useRef)({});g.current={editor:n,mainUrl:i};var b=Object(r.useCallback)((function(){var e=g.current,t=e.editor,n=e.mainUrl;if(t&&n){var a=t.getJson();a.objects=a.objects.filter((function(e){return"currentClipRect"!==e.id}));var r=JSON.stringify({data:a?JSON.stringify(a):"",imgSrc:n}),o=new Blob([r],{type:"application/json"}),i=navigator.sendBeacon("/api_editimg/save",o);console.log("navigator.sendBeacon event",i)}}),[n,i]),j=Object(r.useCallback)((function(){if(n&&i){var e,t=n.getJson();return e={data:t?JSON.stringify(t):"",imgSrc:i},xt("/api_editimg/save",e)}}),[n,i]),_=Object(r.useCallback)((function(){if(n){j();var e=n.getJson(),t="data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(e,null,"\t")));Object(N.saveAs)(t,"".concat(z(),".json"))}}),[n]),y=Object(r.useCallback)(Object(l.a)(H().mark((function t(){var r,i,s,l,u,d,v,m;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!p){t.next=2;break}return t.abrupt("return");case 2:if(a&&n){t.next=4;break}return t.abrupt("return");case 4:return c&&f(),t.prev=5,h(!0),t.next=9,j();case 9:if(r=null===a||void 0===a?void 0:a.getObjects().find((function(e){return"workspace"===e.id})),n.ruler.hideGuideline(),r){t.next=13;break}return t.abrupt("return");case 13:i=r.left,s=r.top,l=r.width,u=r.height,d={format:"png",quality:1,left:i,top:s,width:l,height:u},v=a.getZoom(),a.setViewportTransform([1,0,0,1,0,0]),m=a.toDataURL(d),Object(N.saveAs)(m,"".concat(z(),".png")),null===o||void 0===o||o.setZoomAuto(v),n.ruler.showGuideline(),h(!1),t.next=30;break;case 24:t.prev=24,t.t0=t.catch(5),console.log("onSaveToImage err",t.t0),null===o||void 0===o||o.auto(),e.error(t.t0.message),h(!1);case 30:case"end":return t.stop()}}),t,null,[[5,24]])}))),[a,n,o,c,s,d]);return{saveToJson:_,saveHistory:j,unloadSendBeacon:b,saveToImage:y}},Nt=function(e){var t=Object(r.useContext)(me),n=t.setCanvas,a=t.setEditor,i=t.setWorkSpace,c=t.setShow,s=t.setMainUrl,u=Object(r.useContext)(bt).setLoading,d=ft(),f=d.loadFont,v=d.fontLoaded,m=At().unloadSendBeacon;!function(){var e=Object(r.useContext)(me),t=e.canvas,n=e.editor,a=e.workSpace,o=e.setSelectMode,i=e.setSelectIds,c=e.setSelectOneType,s=e.clipImageId,l=e.setIsClipImage,u=(e.clipRawIndex,e.isClipImage),d=Object(r.useContext)(bt).setLoading;St().cancelClipImage;Object(r.useEffect)((function(){return K.on(Q,d),function(){K.off(Q,d)}}),[]),Object(r.useEffect)((function(){if(t)return t.on({"selection:created":f,"selection:updated":f,"selection:cleared":f,"mouse:wheel":m}),function(){t.off({"selection:created":f,"selection:updated":f,"selection:cleared":f,"mouse:wheel":m})}}),[t,n]),Object(r.useEffect)((function(){return Object(O.a)(Y,p),function(){O.a.unbind(Y,p)}}),[t,u,s]),Object(r.useEffect)((function(){return Object(O.a)(q,v),function(){O.a.unbind(q,v)}}),[t,a]);var f=Object(r.useCallback)((function(){if(t){var e=t.getActiveObjects().filter((function(e){return!(e instanceof j.fabric.GuideLine)}));if(e&&1===e.length){var n=e[0];n&&"image"===n.type&&(n.set({prevWidth:n.getScaledWidth(),prevHeight:n.getScaledHeight()}),t.renderAll()),"i-text"===n.type&&(n.setControlsVisibility({mt:!1,ml:!1,mb:!1,mr:!1}),t.renderAll()),o("one"),i([n.id]),c(n.type)}else e&&e.length>1?(o("multiple"),i(e.map((function(e){return e.id})))):(o(""),i([]),c(""))}}),[t,n]),v=Object(r.useCallback)((function(e){"Minus"===e.code&&(null===a||void 0===a||a.small(.05),e.preventDefault(),e.stopPropagation()),"Equal"===e.code&&(null===a||void 0===a||a.big(.05),e.preventDefault(),e.stopPropagation())}),[t,a]);Object(r.useEffect)((function(){t&&t.on("object:modified",(function(e){var n,a=null===(n=e.transform)||void 0===n?void 0:n.target;if(a&&"image"===a.type&&!ee(a.rawScaleX)&&!ee(a.rawScaleY)){var r=a.prevWidth,o=a.prevHeight;a.set({rawScaleX:a.getScaledWidth()/r*a.rawScaleX,rawScaleY:a.getScaledHeight()/o*a.rawScaleY,prevWidth:a.getScaledWidth(),prevHeight:a.getScaledHeight()}),t.renderAll()}}))}),[t]);var m=Object(r.useCallback)((function(e){var t=e.e;t.deltaY>0?null===a||void 0===a||a.small(.01):null===a||void 0===a||a.big(.01),t.preventDefault(),t.stopPropagation()}),[t,a]),p=(Object(r.useCallback)((function(){if(t){var e=null,n=null;t.getObjects().forEach((function(t){"currentClipRect"===t.id&&(e=t),t.id===s&&(n=t)})),e&&n&&(t.remove(e),t.remove(n),t.discardActiveObject(),t.renderAll(),l(!1))}}),[t,s]),Object(r.useCallback)((function(){if(!u){var e=t.getActiveObjects();e&&(e.map((function(e){return t.remove(e)})),t.discardActiveObject(),t.renderAll())}}),[t,u,s]))}(),Object(r.useEffect)((function(){v&&(p(),s(e.src))}),[v]),Object(r.useEffect)((function(){window.addEventListener("beforeunload",(function(){m()}))}),[]);var p=function(){var t=Object(l.a)(H().mark((function t(){var n;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.src){t.next=2;break}return t.abrupt("return",h());case 2:return t.prev=2,t.next=5,a={imgSrc:e.src},wt("/api_editimg/detail",a);case 5:n=t.sent,h(JSON.parse(n)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),h();case 12:case"end":return t.stop()}var a}),t,null,[[2,9]])})));return function(){return t.apply(this,arguments)}}(),h=function(){var t=Object(l.a)(H().mark((function t(r){var o,s,l,d,v;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=null,o=r&&r.objects?null===(s=r.objects.find((function(e){return"mainImg"===e.id})))||void 0===s?void 0:s.src:e.src,t.prev=2,u(!0),t.next=6,f(null===r||void 0===r?void 0:r.objects);case 6:return t.next=8,_t(o);case 8:u(!1),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(2),console.log("initCanvas error",t.t0),u(!1);case 15:l=new j.fabric.Canvas("fabric-canvas",{fireRightClick:!0,stopContextMenu:!0,controlsAboveOverlay:!0,preserveObjectStacking:!0}),d=new Ct(l,{src:e.src,callback:function(){return c(!0)},canvasData:r}),v=new fe(l),i(d),n(l),a(v);case 21:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}();return o.a.createElement("div",{className:R.workContent,id:"workspace"},o.a.createElement("canvas",{className:R.canvas,id:"fabric-canvas"}))},It={importFile:"_index-module__importFile__3dqN7",openFile:"_index-module__openFile__2iRcv"},Lt=function(e){var t=At(),n=t.saveHistory,a=t.unloadSendBeacon;return o.a.createElement("div",{className:It.importFile},e.onBack?o.a.createElement("span",{className:It.back,onClick:function(){var t;n(),a(),null===(t=e.onBack)||void 0===t||t.call(e)}},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690265070713402.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690358472515604.svg",alt:""}),o.a.createElement("span",null,"\u8fd4\u56de")):null)},Tt="_styles-module__headerControl__231xi",Ht="_styles-module__button__1BWG3",Rt="_styles-module__active__2gyAH",Pt="_styles-module__disabled__2q4y6",zt="_styles-module__ratioText__1kiSM",Mt="_styles-module__line__319O5",Wt="_styles-module__clipSaveButton__26Y5H";function Ut(e){var t=Object(r.useRef)(e);t.current=Object(r.useMemo)((function(){return e}),[e]);var n=Object(r.useRef)();return n.current||(n.current=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.current.apply(this,n)}),n.current}var Gt=function(e,t){var n=function(e,t){var n=e>0?e-1:t.length+e;return n>=t.length-1&&(n=t.length-1),n<0&&(n=0),n}(e,t);return{_current:t[n],_before:t.slice(0,n),_after:t.slice(n+1)}};var Dt=function(){var e=Object(r.useContext)(me),t=e.canvas,n=e.workSpace,a=e.editor,o=e.clipImageId,i=e.isClipImage,c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(r.useState)({present:e,past:[],future:[]}),a=Object(u.a)(n,2),o=a[0],i=a[1],c=o.present,s=o.past,l=o.future,d=Object(r.useRef)(e),f=function(){var e=arguments.length>0?arguments.length<=0?void 0:arguments[0]:d.current;d.current=e,i({present:e,future:[],past:[]})},v=function(e){var n=[].concat(Object(m.a)(s),[c]),a=$(t)?t:Number(t);a>0&&n.length>a&&n.splice(0,1),i({present:e,future:[],past:n})},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(0!==l.length){var t=Gt(e,l),n=t._before,a=t._current,r=t._after;i({past:[].concat(Object(m.a)(s),[c],Object(m.a)(n)),present:a,future:r})}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(0!==s.length){var t=Gt(e,s),n=t._before,a=t._current,r=t._after;i({past:n,present:a,future:[].concat(Object(m.a)(r),[c],Object(m.a)(l))})}},g=function(e){var t=$(e)?e:Number(e);if(0!==t)return t>0?p(t):void h(t)};return{value:c,backLength:s.length,forwardLength:l.length,setValue:Ut(v),go:Ut(g),back:Ut((function(){g(-1)})),forward:Ut((function(){g(1)})),reset:Ut(f)}}(void 0,50),s=c.value,l=c.setValue,d=c.go,f=c.reset,v=c.backLength,p=c.forwardLength,h=Object(r.useRef)(!1);Object(r.useEffect)((function(){return null===t||void 0===t||t.on({"object:added":g,"object:modified":g,"object:removed":g}),function(){null===t||void 0===t||t.off({"object:added":g,"object:modified":g,"object:removed":g})}}),[t,a,l,i,o]),Object(r.useEffect)((function(){n&&a&&f(a.getJson())}),[a,n]),Object(r.useEffect)((function(){t&&h.current&&(null===t||void 0===t||t.clear(),null===t||void 0===t||t.loadFromJSON(s,(function(){h.current=!1,t.renderAll()})))}),[s,t]);var g=Object(r.useCallback)((function(e){!(void 0===e.action&&e.e)&&t&&(h.current||e.target&&"currentClipRect"===e.target.id||i&&e.target.id===o||"clipRawImage"===e.target.id||l(null===a||void 0===a?void 0:a.getJson()))}),[t,a,l,i,o]);return{undo:Object(r.useCallback)((function(){h.current=!0,d(-1)}),[d]),redo:Object(r.useCallback)((function(){h.current=!0,d(1)}),[d]),backLength:v,forwardLength:p}},Yt=function(){var e=Object(r.useContext)(me),t=e.workSpace,n=e.drawMode,a=e.setDrawMode,i=e.canvas,c=e.editor,s=e.isClipImage,l=e.setIsClipImage,d=e.setClipImageId,f=e.setClipRawIndex,v=e.clipImageId,m=e.clipRawIndex,p=St(),h=p.saveClipImage,g=p.cancelClipImage,b=Dt(),j=b.undo,_=b.redo,y=b.backLength,w=b.forwardLength,x=Object(r.useState)(0),k=Object(u.a)(x,2),E=k[0],S=k[1],C=Object(r.useRef)("default");C.current=n,Object(r.useEffect)((function(){return Object(O.a)(F,h),Object(O.a)(Z,g),function(){O.a.unbind(F,h),O.a.unbind(Z,g)}}),[i,t,v,m]),Object(r.useEffect)((function(){return Object(O.a)(B,j),Object(O.a)(X,_),K.on(V,A),function(){O.a.unbind(B,j),O.a.unbind(X,_),K.off(V,A)}}),[]),Object(r.useEffect)((function(){null!==t&&void 0!==t&&t.scale&&S(Ne(100*t.scale))}),[null===t||void 0===t?void 0:t.scale]),Object(r.useEffect)((function(){return K.on(J,(function(e){S(Ne(100*e))})),window.addEventListener("keydown",N),window.addEventListener("keyup",I),function(){window.removeEventListener("keydown",N),window.removeEventListener("keyup",I)}}),[t,n]);var A=function(e){var t=e.visible,n=e.rawIndex,a=e.clipImageId;l(t),f(n),d(a)},N=function(e){"Space"===e.code&&"move"!==C.current&&L()},I=function(e){"Space"===e.code&&T()},L=function(){var e;null===c||void 0===c||null===(e=c.disableGuidelines)||void 0===e||e.call(c),null===t||void 0===t||t.startDring(),a("move")},T=function(){var e;null===c||void 0===c||null===(e=c.enableGuidelines)||void 0===e||e.call(c),null===t||void 0===t||t.endDring(),a("default")};return s?o.a.createElement("div",{className:Tt},o.a.createElement("span",{className:Wt,onClick:h},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691980964433863.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691981310968623.svg",alt:""}),o.a.createElement("span",null,"\u4fdd\u5b58")),o.a.createElement("span",{className:Wt,onClick:g},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691980998460679.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1691981320881591.svg",alt:""}),o.a.createElement("span",null,"\u53d6\u6d88"))):o.a.createElement("div",{className:Tt},o.a.createElement("div",null,o.a.createElement("div",{"data-tooltip-content":"\u64a4\u9500 Ctrl Z","data-tooltip-place":"bottom",onClick:j,className:"".concat(Ht," ").concat(y?"":Pt)},o.a.createElement("img",{src:y?"https://ossprod.jrdaimao.com/file/1690509281581673.svg":"https://ossprod.jrdaimao.com/file/1690789676330313.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509933132558.svg",alt:""})),o.a.createElement("div",{onClick:_,className:"".concat(Ht," ").concat(w?"":Pt),id:"control-tooltip","data-tooltip-content":"\u91cd\u505a Ctrl Shift Z","data-tooltip-place":"bottom"},o.a.createElement("img",{src:w?"https://ossprod.jrdaimao.com/file/1690509311318726.svg":"https://ossprod.jrdaimao.com/file/1690789758114451.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509942889198.svg",alt:""}))),o.a.createElement("div",{className:Mt}),o.a.createElement("div",null,o.a.createElement("div",{className:"".concat(Ht," ").concat("move"===n?Rt:""),onClick:L,id:"control-tooltip","data-tooltip-content":"\u79fb\u52a8\u89c6\u56fe Space","data-tooltip-place":"bottom"},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509577879796.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509952709638.svg",alt:""})),o.a.createElement("div",{className:"".concat(Ht," ").concat("default"===n?Rt:""),onClick:T,id:"control-tooltip","data-tooltip-content":"\u9009\u62e9","data-tooltip-place":"bottom"},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509620102920.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509961015895.svg",alt:""}))),o.a.createElement("div",{className:Mt}),o.a.createElement("div",null,o.a.createElement("div",{className:Ht,onClick:function(){return null===t||void 0===t?void 0:t.big()},id:"control-tooltip","data-tooltip-content":"\u653e\u5927\u89c6\u56fe Ctrl +","data-tooltip-place":"bottom"},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509650392929.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/169050996966396.svg",alt:""})),o.a.createElement("div",{className:Ht,onClick:function(){return null===t||void 0===t?void 0:t.small()},id:"control-tooltip","data-tooltip-content":"\u7f29\u5c0f\u89c6\u56fe Ctrl -","data-tooltip-place":"bottom"},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509673723181.svg",alt:""}),o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/1690509977928322.svg",alt:""})),o.a.createElement("div",{style:{visibility:E?"visible":"hidden"},className:zt},E,"%")))},Bt="_index-module__headerRightControl__1SUwQ",Xt="_index-module__saveButton__3Wh6y",Ft="_index-module__saveWrap__Mk1Te",Zt=function(){var e=At().saveToImage;return o.a.createElement("div",{className:Bt},o.a.createElement("span",{className:Ft},o.a.createElement("span",{onClick:e,className:Xt},"\u4e0b\xa0\u8f7d")))},qt="_index-module__imageResource__1mciG",Jt="_index-module__uploadFile__3rrLu",Vt="_index-module__fileList__1lwJG",Qt="_index-module__empty__1dOE_",Kt="_index-module__fileListItem__3PLjp",$t="_index-module__image__evLSw",en="_index-module__more__3qqMp",tn={fill:"#000000"},nn={},an=function(){var e=Object(r.useContext)(me),t=e.workSpace,n=e.canvas,a=e.isClipImage,o=e.clipImageId,i=e.clipRawIndex,c=St().cancelClipImage,s=Object(r.useContext)(bt).setLoading;return{addImage:Object(r.useCallback)((function(e,r,o){if(t){s(!0),a&&c();var i=t.getScale();j.fabric.Image.fromURL("".concat(e,"?t=").concat(Date.now()),(function(e){e.width&&e.height?(e.set(Object(v.a)(Object(v.a)({},nn),{},{id:z(),scaleY:i,scaleX:i,left:(t.width-e.width*i)/2,top:(t.height-e.height*i)/2},r)),null===n||void 0===n||n.add(e),null===n||void 0===n||n.setActiveObject(e),null===o||void 0===o||o(e),null===n||void 0===n||n.renderAll(),s(!1)):s(!1)}),{crossOrigin:"anonymous"})}}),[t,n,o,i]),addText:Object(r.useCallback)((function(e){if(t){a&&c();var r=new j.fabric.IText(e.title,Object(v.a)({fontFamily:"serif",fontSize:3*e.style.fontSize,fontWeight:e.style.fontWeight,id:z(),lockScalingX:!1,lockScalingY:!1},tn));r.set({left:(t.width-r.width)/2,top:(t.height-r.height)/2}),null===n||void 0===n||n.add(r),null===n||void 0===n||n.setActiveObject(r),null===n||void 0===n||n.renderAll()}}),[t,n,o,i])}},rn=[{title:"\u6dfb\u52a0\u6807\u9898",key:"addTitle",style:{fontSize:20,fontWeight:600}},{title:"\u6dfb\u52a0\u526f\u6807\u9898",key:"addSubTitle",style:{fontSize:16,fontWeight:600}},{title:"\u6dfb\u52a0\u6b63\u6587",key:"addText",style:{fontSize:14}},{title:"\u6dfb\u52a0\u6ce8\u91ca",key:"addAnnotation",style:{fontSize:12}}],on={textResource:"_index-module__textResource__qOoMp",addShareTextButton:"_index-module__addShareTextButton__3uKaf",textListItem:"_index-module__textListItem__3_inJ"},cn="alreadyUpload",sn="i-text",ln=[{title:"\u5df2\u4e0a\u4f20",icon:"https://ossprod.jrdaimao.com/file/1690351687096238.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690351735822596.svg",key:cn},{title:"\u6587 \u5b57",icon:"https://ossprod.jrdaimao.com/file/1690351715036668.svg",activeIcon:"https://ossprod.jrdaimao.com/file/1690351759741179.svg",key:sn}],un=(a={},Object(s.a)(a,cn,(function(){var e=Object(r.useContext)(bt).setLoading,t=Et(),n=Object(r.useContext)(me).canvas,a=sessionStorage.getItem("EDIT_IMAGE_LIST"),i=Object(r.useState)(!1),c=Object(u.a)(i,2),s=c[0],d=c[1],f=an().addImage,m=Object(r.useState)(a?JSON.parse(a):[]),p=Object(u.a)(m,2),h=p[0],g=p[1],b=function(){var e=Object(r.useRef)(),t=Object(r.useRef)(),n=Object(r.useState)(!1),a=Object(u.a)(n,2),o=a[0],i=a[1],c=Object(r.useContext)(bt).setLoading,s=Object(r.useRef)();Object(r.useEffect)((function(){var e=document.querySelector("#img-file-list");e&&(e.style.overflow=o?"hidden":"auto")}),[o]),Object(r.useEffect)((function(){return window.addEventListener("click",d),function(){d(),window.removeEventListener("click",d)}}),[]);var d=Object(r.useCallback)((function(t){(null===t||void 0===t?void 0:t.target)!==e.current&&s.current&&(document.body.removeChild(s.current),s.current=null,i(!1))}),[]),f=function(){var e=Object(l.a)(H().mark((function e(n){var a,r,o,i,s;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.target&&t.current){e.next=2;break}return e.abrupt("return");case 2:if(a=t.current,r=a.imgSrc,o=a.stockName,i=a._id,s=a.callback,"\u4e0b\u8f7d"===n.target.innerHTML&&Object(N.saveAs)(r,"".concat(o).concat(r.slice(r.lastIndexOf(".")))),"\u5220\u9664"!==n.target.innerHTML){e.next=17;break}return e.prev=5,c(!0),e.next=9,wt("/api_editimg/delstock",{id:i});case 9:return e.next=11,null===s||void 0===s?void 0:s();case 11:c(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),c(!1);case 17:case"end":return e.stop()}}),e,null,[[5,14]])})));return function(t){return e.apply(this,arguments)}}();return{run:function(n,a){i(!0),t.current=a,s.current&&(document.body.removeChild(s.current),s.current=null),e.current=n.target;var r=n.target.parentNode,o=r.getBoundingClientRect(),c=o.top,l=o.left,u=s.current=document.createElement("div");u.addEventListener("click",f),u.innerHTML="<div class='customMenu' style='left:".concat(l+r.offsetWidth+10,"px;top:").concat(c,"px'>\n\x3c!--    <div class='editName'>--\x3e\n\x3c!--      <span>\u67d0\u67d0\u6587\u4ef6\u540d...\u540d\u79f0.png</span>--\x3e\n\x3c!--      <img src=\"https://ossprod.jrdaimao.com/file/1690528866207938.svg\" alt=\"\"/>--\x3e\n\x3c!--    </div>--\x3e\n    <div class='buttons'>\n      <div>\u4e0b\u8f7d</div>\n      <div>\u5220\u9664</div>\n    </div>\n  </div>"),document.body.appendChild(u)}}}().run;Object(r.useEffect)((function(){y()}),[]),Object(r.useEffect)((function(){if(n)return n.on("drop",j),n.on("dragover",_),function(){n.off("drop",j),n.off("dragover",_)}}),[n]);var j=function(e){var t=e.e;t.preventDefault();var a=t.dataTransfer.getData("text/plain"),r=n.getSelectionElement().getBoundingClientRect().left,o=n.getSelectionElement().getBoundingClientRect().top,i={x:t.x-r,y:t.y-o},c=n.restorePointerVpt(i);f(a,{},(function(e){e.set({left:c.x-e.getScaledWidth()/2,top:c.y-e.getScaledHeight()/2})}))},_=function(e){e.e.preventDefault()},y=function(){var e=Object(l.a)(H().mark((function e(){var t;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wt("/api_editimg/liststock",void 0);case 3:(t=e.sent)&&sessionStorage.setItem("EDIT_IMAGE_LIST",JSON.stringify(t)),g(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),O=function(){var n=Object(l.a)(H().mark((function n(a){var r,o,i,c;return H().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!s){n.next=2;break}return n.abrupt("return");case 2:r=a.target.files,n.prev=3,d(!0),e(!0),o=0;case 7:if(!(o<r.length)){n.next=19;break}if(i=r[o],/(png|jpg|jpeg)/g.test(i.type)){n.next=11;break}return n.abrupt("continue",16);case 11:return n.next=13,kt(i);case 13:return c=n.sent,n.next=16,l={imgSrc:c.url,stockName:i.name},xt("/api_editimg/addstock",l);case 16:o++,n.next=7;break;case 19:return n.next=21,y();case 21:n.next=27;break;case 23:n.prev=23,n.t0=n.catch(3),console.log(n.t0),t.error(n.t0.message);case 27:return n.prev=27,d(!1),e(!1),n.finish(27);case 31:case"end":return n.stop()}var l}),n,null,[[3,23,27,31]])})));return function(e){return n.apply(this,arguments)}}(),w=function(e){e.dataTransfer.setData("text/plain",e.target.src)};return o.a.createElement("div",{className:qt},o.a.createElement("div",{className:Jt},o.a.createElement("span",null,s?"\u4e0a\u4f20\u4e2d...":"\u4e0a\u4f20\u6587\u4ef6"),o.a.createElement("input",{multiple:!0,disabled:s,type:"file",accept:".png,.jpg,.jpeg",onChange:O})),null!==h&&void 0!==h&&h.length?null:o.a.createElement("div",{className:Qt},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/169035729200810.png",alt:""}),o.a.createElement("p",null,"\u8fd8\u6ca1\u6709\u6587\u4ef6\u54e6~")),null!==h&&void 0!==h&&h.length?o.a.createElement("div",{className:Vt,id:"img-file-list"},h.map((function(e){return o.a.createElement("div",{key:e._id,className:Kt},o.a.createElement("img",{onDragStart:w,onClick:function(){return f(e.imgSrc)},className:$t,src:e.imgSrc,alt:""}),o.a.createElement("img",{onClick:function(t){return function(e,t){b(e,Object(v.a)(Object(v.a)({},t),{},{callback:y}))}(t,e)},className:en,src:"https://ossprod.jrdaimao.com/file/1690363754666532.svg",alt:""}))}))):null)})),Object(s.a)(a,sn,(function(){var e=an().addText;return o.a.createElement("div",{className:on.textResource},o.a.createElement("div",{className:on.addShareTextButton},o.a.createElement("span",{onClick:function(){return e(Object(v.a)(Object(v.a)({},rn[3]),{},{title:"\u6587\u672c\u6846"}))}},"\u6dfb\u52a0\u6587\u672c\u6846")),o.a.createElement("div",{className:on.textList},rn.map((function(t){return o.a.createElement("div",{onClick:function(){return e(t)},key:t.key,style:t.style,className:on.textListItem},o.a.createElement("span",null,t.title))}))))})),a),dn=cn,fn="_index-module__resourceNav__2Z57U",vn="_index-module__resourceContent__IR3Ff",mn="_index-module__resourceNavItem__1cunE",pn="_index-module__resourceNavPlace__2CAgV",hn="_index-module__resourceNavItemActive__MUADE",gn="_index-module__resourceNavItemPrevActive__1OMMf",bn="_index-module__resourceArea__1SeNE",jn="_index-module__packUp__LUVGf",_n=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(dn),c=Object(u.a)(i,2),s=c[0],l=c[1],d=ln.findIndex((function(e){return e.key===s})),f=un[s];return o.a.createElement("div",{className:bn},o.a.createElement("div",{className:fn},ln.map((function(e,t){var n=d===t,a="".concat(mn," ").concat(n?hn:"");return t===d-1&&(a+=gn),o.a.createElement("div",{onClick:function(){return function(e){l(e.key)}(e)},className:a,key:e.key},o.a.createElement("img",{src:n?e.activeIcon:e.icon,alt:""}),o.a.createElement("span",null,e.title))})),o.a.createElement("div",{className:pn})),o.a.createElement("div",{className:vn},o.a.createElement(f,null),o.a.createElement("div",{className:jn,onClick:function(){n?(document.body.style.setProperty("--dm-change-resource-content-width","240px"),a(!1)):(document.body.style.setProperty("--dm-change-resource-content-width","0"),a(!0))}},o.a.createElement("img",{src:n?"https://ossprod.jrdaimao.com/file/1690513793832702.svg":"https://ossprod.jrdaimao.com/file/1690445829374723.svg",alt:""}))))},yn="_index-module__attrWrap__1Um4N",On="_index-module__attrTab__2Zu3W",wn="_index-module__attrTabActive__3Q6Gq",xn="_index-module__attrContent__yV77-",kn={orderWrap:"_index-module__orderWrap__1OXXV",orderListTitle:"_index-module__orderListTitle__3Taww",orderList:"_index-module__orderList__2rRt5",orderListItem:"_index-module__orderListItem__1VS8z",active:"_index-module__active__saBU6",button:"_index-module__button__226hu",move:"_index-module__move__16YUk",content:"_index-module__content__3hSBb",text:"_index-module__text__1r5UD",image:"_index-module__image__yBptY",empty:"_index-module__empty__14aJw"},En=Object(I.c)((function(e){var t=Ee().changeOwnLock,n=e.item,a=Object(r.useContext)(me),i=a.selectIds,c=a.canvas,s=n.object.hasControls,l=n.object.visible,u=Object(r.useCallback)((function(){c&&(c.setActiveObject(n.object),c.renderAll())}),[n,c]),d=n.object.get("fontFamily");return o.a.createElement("div",{onClick:u,className:"".concat(kn.orderListItem," ").concat(i.includes(n.id)?kn.active:"")},o.a.createElement("div",{className:kn.button},o.a.createElement("img",{draggable:!1,onClick:function(e){e.stopPropagation(),n.object.set({visible:!l}),null===c||void 0===c||c.renderAll()},src:l?"https://ossprod.jrdaimao.com/file/1690437893570728.svg":"https://ossprod.jrdaimao.com/file/1690945206225980.svg",alt:""}),o.a.createElement("img",{draggable:!1,onClick:function(e){e.stopPropagation(),t(!s,n.object)},src:s?"https://ossprod.jrdaimao.com/file/1690437902259961.svg":"https://ossprod.jrdaimao.com/file/1690944574168632.svg",alt:""})),o.a.createElement("div",{className:kn.content},"image"===n.type?o.a.createElement("div",{className:kn.image},o.a.createElement("img",{draggable:!1,src:n.src,alt:""})):o.a.createElement("div",{className:kn.text,style:{fontFamily:d||"serif"}},n.text)),o.a.createElement(Sn,null))})),Sn=function(){return o.a.createElement("div",{className:kn.move},o.a.createElement("img",{draggable:!1,src:"https://ossprod.jrdaimao.com/file/1690437934587361.svg",alt:""}))},Cn=Object(I.b)((function(e){return e.children})),An=function(){var e=Object(r.useContext)(me).canvas,t=Qe(),n=t.up,a=t.upTop,i=t.down,c=t.downTop,s=Object(r.useState)([]),l=Object(u.a)(s,2),d=l[0],f=l[1],v=Object(r.useCallback)((function(e){var t,r=e.oldIndex,o=e.newIndex;if(r!==o){var s=null===(t=d[r])||void 0===t?void 0:t.object;if(s){if(o<r){if(0===o)return a(s);for(var l=o;l<r;l++)n(s)}else{if(o===d.length-1)return c(s);for(var u=r;u<o;u++)i(s)}f((function(e){return Object(I.a)(e,r,o)}))}}}),[d,f,n,a,i,c]);Object(r.useEffect)((function(){if(e)return e.on("after:render",p),function(){e.off("after:render",p)}}),[e]);var p=Object(r.useCallback)((function(){var t=(null===e||void 0===e?void 0:e.getObjects())||[],n=Object(m.a)(t.filter((function(e){return!(e instanceof j.fabric.GuideLine||"workspace"===e.id||"currentClipRect"===e.id)}))).reverse().map((function(e){var t,n=e.type;return{object:e,type:n,id:e.id,text:e.text,src:"image"===n?null===(t=e._element)||void 0===t?void 0:t.src:void 0}}));f(n)}),[f,e]);return o.a.createElement("div",{className:kn.orderWrap},o.a.createElement("div",{className:kn.orderListTitle},"\u56fe\u5c42"),d.length?null:o.a.createElement("div",{className:kn.orderListEmpty},o.a.createElement("div",{className:kn.empty},o.a.createElement("img",{src:"https://ossprod.jrdaimao.com/file/169035729200810.png",alt:""}),o.a.createElement("p",null,"\u6682\u65e0\u56fe\u5c42~"))),d.length?o.a.createElement(Cn,{distance:10,lockAxis:"y",onSortEnd:v},o.a.createElement("div",{className:kn.orderList},d.map((function(e,t){return o.a.createElement(En,{index:t,key:e.id,item:e})})))):null)},Nn=x.a,In=function(){var e=Object(r.useContext)(me).workSpace,t=Object(r.useState)((null===e||void 0===e?void 0:e.fill)||"rgba(255,255,255,1)"),n=Object(u.a)(t,2),a=n[0],i=n[1];return o.a.createElement("div",{className:Le},o.a.createElement("div",{className:Te},o.a.createElement("div",null,o.a.createElement(Ie,{isWorkSpace:!0,getActiveObject:function(){return null===e||void 0===e?void 0:e.workspace}})),o.a.createElement("div",null,o.a.createElement("div",{className:Re},"\u80cc\u666f\u8272"),o.a.createElement(Nn,{color:a,onChange:function(t){i(t.hex),console.log("change bg color e.hex",t.hex),null===e||void 0===e||e.setBgColor(t.hex)},className:Pe}))))},Ln=function(){var e=Object(r.useContext)(me).selectOneType,t=Object(r.useContext)(bt),n=t.attrTab,a=t.setAttrTab,i=Object(r.useMemo)((function(){var e;return null===(e=pt.find((function(e){return e.key===n})))||void 0===e?void 0:e.bg}),[pt,n]),c=ht[e];return o.a.createElement("div",{className:yn},o.a.createElement("div",{className:On,style:{backgroundImage:"url(".concat(i,")")}},pt.map((function(e){return o.a.createElement("div",{onClick:function(){return function(e){a(e.key)}(e)},key:e.key,className:n===e.key?wn:""},o.a.createElement("span",null,e.title))}))),o.a.createElement("div",{id:"attr-content",className:xn},o.a.createElement("div",{style:{display:"Attr"===n?"block":"none"}},c?o.a.createElement(c,null):o.a.createElement(In,null)),o.a.createElement("div",{style:{display:"coverage"===n?"block":"none"}},o.a.createElement(An,null))))},Tn="_styles-module__dmEditImageContainer__1PAn4",Hn="_styles-module__header__2NqZJ",Rn="_styles-module__content__2pvIH",Pn="_styles-module__canvasArea__f4hmY",zn="_styles-module__attrArea__1Dyk-",Mn=function(e){var t=Object(r.useContext)(bt),n=t.loading,a=t.loadingText,i=Object(r.useContext)(me).show;return o.a.createElement(T.a,{active:n,spinner:!0,text:a},o.a.createElement("div",{className:Tn},o.a.createElement("div",{className:Hn},o.a.createElement(Lt,{onBack:e.onBack}),i?o.a.createElement(Yt,null):null,o.a.createElement(Zt,null)),o.a.createElement("div",{className:Rn},o.a.createElement(_n,null),o.a.createElement("div",{className:Pn},o.a.createElement(Nt,{src:e.src})),o.a.createElement("div",{className:zn},o.a.createElement(Ln,null)))))},Wn=function(e){return o.a.createElement(pe,null,o.a.createElement(jt,null,o.a.createElement(Mn,{onBack:e.onBack,src:e.src}),o.a.createElement(C.Toaster,null)))},Un=(n(302),function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Wn,{src:"http://localhost:5678/static/images/9897c2e019e04304ba01293579ed1ce2~tplv-p14lwwcsbr-7.jpeg"}))});c.a.render(o.a.createElement(Un,null),document.getElementById("root"))}},[[135,1,2]]]);
//# sourceMappingURL=main.3828d331.chunk.js.map