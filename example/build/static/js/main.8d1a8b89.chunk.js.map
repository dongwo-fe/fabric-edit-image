{"version":3,"sources":["../../src/utils/utils.ts","../../src/core/initControlsRotate.ts","../../src/core/initCenterAlign.ts","../../src/utils/hotEventKeys.ts","../../src/utils/events/types.ts","../../src/utils/events/index.ts","../../src/utils/index.ts","../../src/core/initControls.ts","../../src/core/ruler/utils.ts","../../src/core/ruler/guideline.ts","../../src/core/ruler/ruler.ts","../../src/core/ruler/index.ts","../../src/core/EditorGroupText.ts","../../src/core/index.ts","../../src/core/initAligningGuidelines.ts","../../src/core/initHotKeys.ts","../../src/components/Draw/CanvasContext.tsx","../../src/components/Editor/Input/index.tsx","../../src/components/Draw/hooks/useAttr.ts","../../src/components/Draw/hooks/useLock.ts","../../src/utils/calculate.ts","../../src/components/Editor/Components/Attr/Components/Size/index.tsx","../../src/components/Editor/Components/Attr/Components/Pos/index.tsx","../../src/components/Editor/Components/Attr/Components/Trans/index.tsx","../../src/components/Editor/Components/Attr/Components/PageAlign/config.ts","../../src/components/Editor/Components/Attr/Components/PageAlign/index.tsx","../../src/components/Draw/hooks/usePageAlign.ts","../../src/components/Editor/Components/Attr/Components/CoverOrder/config.ts","../../src/components/Draw/hooks/userOrder.ts","../../src/components/Editor/Components/Attr/Components/CoverOrder/index.tsx","../../src/components/Editor/Select/index.tsx","../../src/components/Editor/InputNumber/index.tsx","../../src/components/Editor/Components/Attr/Components/Text/config.ts","../../src/components/Draw/hooks/useChangeFontFamily.ts","../../src/api/text.ts","../../src/components/Editor/Components/Attr/Components/Text/index.tsx","../../src/components/Editor/AttrArea/config.tsx","../../src/components/Editor/Components/Attr/ImageSpaceAttr/index.tsx","../../src/components/Editor/Components/Attr/TextSpaceAttr/index.tsx","../../src/components/Editor/Context/index.tsx","../../src/utils/tool.ts","../../src/api/fetch.ts","../../src/api/image.ts","../../src/components/Draw/hooks/useToast.ts","../../src/components/Draw/hooks/useClipImage.ts","../../src/core/EditorWorkspace.ts","../../src/components/Draw/hooks/useSave.ts","../../src/components/Draw/Draw.tsx","../../src/components/Draw/hooks/useEvents.ts","../../src/components/Editor/ImportFile/index.tsx","../../src/hooks/useMemoizedFn.ts","../../src/hooks/useHistoryTravel.ts","../../src/components/Draw/hooks/useHistory.ts","../../src/components/Editor/HeaderControl/index.tsx","../../src/components/Editor/SaveButton/index.tsx","../../src/components/Draw/hooks/useAddObject.ts","../../src/components/Editor/Components/Resource/TextResource/config.ts","../../src/components/Editor/ResourceArea/config.ts","../../src/components/Editor/Components/Resource/ImageResource/index.tsx","../../src/components/Editor/Components/Resource/ImageResource/dropDown.tsx","../../src/components/Editor/Components/Resource/TextResource/index.tsx","../../src/components/Editor/ResourceArea/index.tsx","../../src/components/Editor/OrderList/index.tsx","../../src/components/Editor/Components/Attr/WorkSpaceAttr/index.tsx","../../src/components/Editor/AttrArea/index.tsx","../../src/components/Editor/index.tsx","../../src/index.tsx","App.tsx","index.tsx"],"names":["throttle","fn","timer","time","args","clearTimeout","setTimeout","apply","this","uuid","replace","c","r","Math","random","toString","retainNumber","value","result","Number","rotateIcon","angle","CenterAlign","constructor","canvas","centerH","workspace","object","_centerObject","fabric","Point","getCenterPoint","x","y","center","centerV","position","name","activeObject","getActiveObject","includes","defaultWorkspace","getObjects","find","item","id","renderAll","KeyNames","Types","events","EventEmitter","isNumber","isUndef","Object","NUM_FRACTION_DIGITS","setBaseControlVisible","visible","setControlsVisibility","mt","mb","ml","mr","tl","tr","bl","br","setHighControlVisible","copy","delete","clip","rotate","topBg","drawImg","ctx","left","top","img","wSize","hSize","undefined","save","translate","util","degreesToRadians","drawImage","restore","initControls","document","createElement","renderIconEdge","styleOverride","fabricObject","src","prototype","controls","Control","cursorStyleHandler","controlsUtils","scaleCursorStyleHandler","actionHandler","scalingEqually","render","peakControl","verticalImgIcon","horizontalImgIcon","renderIcon","renderIconHoz","offsetX","scaleSkewCursorStyleHandler","scalingXOrSkewingY","getActionName","scaleOrSkewActionName","offsetY","scalingYOrSkewingX","intervalControl","rotationStyleHandler","rotationWithSnapping","actionName","cursorStyle","rotationControl","topBgEl","copyImageEl","deleteImageEl","clipImageEl","cloneObject","eventData","transform","target","emit","clone","cloned","set","sourceSrc","rawScaleX","rawScaleY","rectDiffLeft","rectDiffTop","prevWidth","prevHeight","setCoords","add","setActiveObject","deleteObject","clipRect","remove","requestRenderAll","mouseUpHandler","type","image","rectLeft","rectTop","scaleX","scaleY","index","findIndex","sourceWidth","getScaledWidth","sourceHeight","getScaledHeight","o","setSrc","crossOrigin","bringToFront","selectionRect","Rect","fill","originX","originY","stroke","opacity","width","height","hasRotatingPoint","transparentCorners","cornerColor","cornerStrokeColor","borderColor","cornerSize","padding","cornerStyle","borderDashArray","borderScaleFactor","lockMovementX","lockMovementY","hoverCursor","_element","selectionRectDown","imageDown","on","e","movementX","movementY","rectWidth","rectHeight","rect","get","rawIndex","clipImageId","textC","textdelete","initMainControl","borderOpacityWhenMoving","mergeLines","isHorizontal","axis","length","sort","a","b","mergedLines","currentLine","assign","line","max","push","darwLine","options","lineWidth","beginPath","strokeStyle","moveTo","lineTo","darwText","text","align","fontSize","fillStyle","textAlign","textBaseline","font","PI","fillText","darwRect","strokeWidth","drawMask","backgroundColor","gradient","createLinearGradient","transparentColor","Color","setAlpha","addColorStop","toRgba","CanvasRuler","_options","activeOn","eventHandler","calcObjectRect","bind","clearStatus","canvasMouseDown","canvasMouseMove","canvasMouseUp","lastAttr","status","cursor","selection","getCommonEventInfo","tempGuidelLine","absolutePointer","pointer","ruleSize","enabled","highlightColor","textColor","getContext","extend","ruler","GuideLine","createClass","Line","selectable","hasControls","hasBorders","globalCompositeOperation","initialize","points","newPoints","callSuper","isPointOnRuler","moveCursor","fire","off","getBoundingRect","absolute","calculate","hoveredRuler","fromObject","callback","xy","y1","x1","_fromObject","instance","enable","destroy","disable","clearGuideline","showGuideline","forEach","guideLine","hideGuideline","vpt","viewportTransform","draw","rulerLength","getSize","startCalibration","getZoom","opt","zoom","gap","zooms","i","getGap","unitLength","startValue","startOffset","canvasSize","ceil","textValue","textLength","textX","textY","toRgb","j","round","objectRect","skip","roundFactor","leftTextVal","rightTextVal","isSameText","maskOpt","pad","textOpt","lineSize","lineOpt","activeObjects","getActiveObjects","allRect","reduce","rects","obj","group","groupCenterX","objectOffsetFromCenterX","groupCenterY","objectOffsetFromCenterY","point","containsPoint","_setupCurrentTransform","pos","event","defaultCursor","EditorGroupText","_init","isDown","textObject","_getGroupTextObj","_bedingEditingEvent","enterEditing","getPointer","clickObj","_searchPossibleTargets","_objects","isText","ids","_unGroup","resetGroup","groupArr","filter","Group","discardActiveObject","activeObj","toActiveSelection","Editor","editorWorkspace","disabled","getSelectionContext","drawHorizontalLine","coords","drawLine","x2","y2","isInRange","value1","value2","len","verticalLines","horizontalLines","canvasObjects","activeObjectCenter","activeObjectLeft","activeObjectTop","activeObjectBoundingRect","activeObjectHeight","activeObjectWidth","horizontalInTheRange","verticalInTheRange","_currentTransform","objectCenter","objectLeft","objectTop","objectBoundingRect","objectHeight","objectWidth","setPositionByOrigin","clearContext","contextTop","error","console","log","initAligningGuidelines","disableGuidelines","enableGuidelines","hotkeys","_event","handler","key","initHotkeys","mtr","mtr2","mtr3","mtr4","toFixed","body","lowerCanvasEl","nextSibling","corner","style","initControlsRotate","centerAlign","InitCenterAlign","getWorkspace","isRectOut","targetRect","targetTop","targetHeight","targetLeft","targetWidth","setCursor","initRuler","_copyActiveSelection","clonedObj","evented","forEachObject","_copyObject","paramsActiveObeject","unGroup","activegroup","toGroup","objectsInGroup","newgroup","workspaceSendToBack","sendToBack","getJson","toJSON","dragAddItem","getSelectionElement","getBoundingClientRect","pointerVpt","restorePointerVpt","noop","Context","createContext","editor","workSpace","drawMode","selectMode","selectIds","selectOneType","selectActive","show","mainUrl","isClipImage","clipRawIndex","setClipRawIndex","setClipImageId","setIsClipImage","setMainUrl","setSelectOneType","setSelectActive","setSelectMode","setSelectIds","setDrawMode","setCanvas","setEditor","setWorkSpace","setShow","CanvasProvider","children","useState","context","React","Provider","Input","props","title","afterText","onChange","className","isValidElement","useAttr","useContext","setAttr","attr","lockAttrs","useLock","changeOwnLock","useCallback","isLock","changeInRatioLock","subtract","num1","num2","num1Digits","split","num2Digits","baseNum","pow","multiply","num1String","num2String","divide","n1","n2","floatRound","num","n","Size","showRation","isWorkSpace","setWidth","setHeight","lockRatio","setLockRatio","useEffect","getAttr","_controlsVisibility","isControlsInRatioVisible","setSize","onWidthChange","onHeightChange","onClick","changeLock","prevState","alt","Position","setRotate","setX","setY","onRotateChange","Transparent","setOpacity","setVisible","onFlipChange","transparent","customInputStyle","reverse","reverseWrap","content","onVisibleChange","alignTypeList","icon","activeIcon","PageAlign","alignFunc","usePageAlign","setPosition","alignCenter","middleCenter","right","bottom","map","coverOrderList","userOrder","changeOrder","funcKey","actives","up","upTop","down","downTop","CoverOrder","orderFunc","pageAlignStyle","changeCoverOrder","DropdownIndicator","ReactSelectStyles","singleValue","provided","color","fontWeight","menuList","background","option","lineHeight","boxSizing","container","control","paddingRight","flex","borderRadius","display","InputNumber","number","setNumber","last","useRef","current","inputRef","addEventListener","keyDownChange","removeEventListener","sub","styles","ref","textAlignList","activeSrc","textStyleList","label","GeneralTextList","Font","Map","globalFontList","useChangeFontFamily","setLoading","fontList","setFontList","fontLoaded","setFontLoaded","useFontListLast","list","Promise","resolve","res","fontlibName","url","fontlibfile","runChange","has","styleContent","innerHTML","appendChild","FontFaceObserver","load","then","fontFamily","removeChild","loadFont","objectsData","textList","Array","isArray","el","fontFamiliesAll","reject","catch","err","all","ColorPicker","SketchPicker","TextAttr","setFontSize","setColor","setFontWeight","underline","setUnderline","incline","setIncline","setAlign","fontStyle","setFontStyle","setFontFamily","isWeight","querySelector","overflow","textArea","textAreaContent","Select","placeholder","components","select","isSearchable","size","isDisabled","disabledSelect","colorContent","alignGroup","alignGroupActive","onAlignChange","styleGroup","onWeightChange","styleGroupActive","onInclineChange","onUnderlineChange","fixColorPicker","colorPicker","onChangeComplete","hex","attrTabList","bg","attrAreaComponent","ImageSpaceAttr","TextSpaceAttr","InitState","attrTab","loading","loadingText","setLoadingText","setAttrTab","EditorProvider","loadImage","Image","onload","onerror","base64ConvertFile","urlData","arr","match","fileExt","bstr","atob","u8arr","Uint8Array","charCodeAt","File","request","axios","create","baseURL","interceptors","response","use","data","code","fetch","params","post","postUploadImage","file","form","FormData","append","useToast","toast","duration","useClipImage","EditorContext","saveClipImage","scale","currentClipImageIndex","newRect","absolutePositioned","clipPath","cropped","setViewportTransform","base64","toDataURL","setZoomAuto","newImage","sendBackwards","cancelClipImage","clipImage","EditorWorkspace","workspaceEl","Error","dragMode","_initBackground","_initWorkspace","_initResizeObserve","_initDring","offsetWidth","offsetHeight","canvasData","objects","rectOptions","loadFromJSON","_initRect","fromURL","w","auto","setBgColor","setCenterFromObject","objCenter","ResizeObserver","observe","cb","getCenter","iMatrix","concat","zoomToPoint","getScale","viewPortWidth","viewPortHeight","big","zoomRatio","small","one","startDring","endDring","This","evt","altKey","_setDring","isDragging","lastPosX","clientX","lastPosY","clientY","delta","deltaY","preventDefault","stopPropagation","useSave","saveToImageLoading","setSaveToImageLoading","useLast","unloadSendBeacon","dataJson","JSON","stringify","imgSrc","blob","Blob","isPush","navigator","sendBeacon","saveHistory","saveToJson","dataUrl","fileStr","encodeURIComponent","saveAs","saveToImage","format","quality","message","Draw","useEvents","selected","onWheel","deleteObjects","unbind","onZoom","init","window","initCanvas","parse","mainImg","Canvas","fireRightClick","stopContextMenu","controlsAboveOverlay","preserveObjectStacking","workContent","ImportFile","importFile","onBack","back","useMemoizedFn","fnRef","useMemo","memoizedFn","step","targetArr","dumpIndex","_current","_before","slice","_after","useHistory","initialValue","maxLength","present","past","future","history","setHistory","initialValueRef","reset","_initial","updateValue","val","_past","maxLengthNum","splice","_forward","_backward","go","stepNum","backLength","forwardLength","setValue","forward","useHistoryTravel","historyFlagRef","clear","action","undo","redo","HeaderControl","setScale","drawModeRef","onClipImage","onKeyDown","onKeyUp","switchDragMode","switchDefaultMode","button","visibility","SaveButton","DefaultOptions","useAddObject","addImage","Date","now","addText","IText","lockScalingX","lockScalingY","ResourceTypeEnum","resourceNavList","ResourceContentComEnum","ImageResource","EDIT_IMAGE_LIST","sessionStorage","getItem","uploading","setUploading","setList","run","useDropDown","clickRef","cacheItem","shareEl","removeEl","stockName","_id","lastIndexOf","parentNode","div","queryList","onDrop","onDragover","imageUrl","dataTransfer","getData","offset","pageIndex","pageSize","setItem","onUploadFile","fileList","files","test","onDragStart","setData","multiple","accept","onClickMore","TextResource","textResource","addShareTextButton","textListItem","DefaultSelectKey","ResourceArea","collapsed","setCollapsed","activeKey","setActiveKey","activeIndex","ResourceComponent","active","resourceNavItem","onResourceNavChange","onSetCollapsed","setProperty","SortableItem","sortableElement","isVisible","clickItem","orderListItem","draggable","DragHandle","move","SortableContainer","sortableContainer","OrderList","onSortEnd","oldIndex","newIndex","oldObject","arrayMove","getList","orderWrap","orderListTitle","orderListEmpty","empty","distance","lockAxis","orderList","WorkSpaceAttr","AttrArea","AttrCom","backgroundImage","onChangeTab","LoadingOverlay","spinner","EditImage","Toaster","App","Fragment","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.8d1a8b89.chunk.js","sourcesContent":["type ReFn = (...args: any) => void\ntype ThFn = (fn: ReFn, timer: number) => ReFn\nexport const throttle: ThFn = (fn, timer) => {\n  let time: any = null\n  return (...args: any) => {\n    if (time) clearTimeout(time)\n    time = setTimeout(() => {\n      // @ts-ignore\n      fn.apply(this, args)\n    }, timer)\n  }\n}\n\nexport function uuid(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0\n    const v = c === 'x' ? r : (r & 0x3) | 0x8\n    return v.toString(16)\n  })\n}\n\nexport function retainNumber(value: string | number): string {\n  if (!value) return '0'\n  const result = ('' + value).replace(/[^0-9]/g, '')\n  return Number(result) + ''\n}\n\n\nexport function arrayMoveMutable(array: Array<any>, fromIndex: number, toIndex: number) {\n  const startIndex = fromIndex < 0 ? array.length + fromIndex : fromIndex;\n\n  if (startIndex >= 0 && startIndex < array.length) {\n    const endIndex = toIndex < 0 ? array.length + toIndex : toIndex;\n    const [item] = array.splice(fromIndex, 1);\n    array.splice(endIndex, 0, item);\n  }\n}\n\nexport function arrayMoveImmutable(array: Array<any>, fromIndex: number, toIndex: number) {\n  array = [...array];\n  arrayMoveMutable(array, fromIndex, toIndex);\n  return array;\n}\n","// @ts-nocheck\nimport { fabric } from 'fabric';\n\n// 定义旋转光标样式，根据转动角度设定光标旋转\nfunction rotateIcon(angle: number) {\n  return `url(\"data:image/svg+xml,%3Csvg height='18' width='18' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'%3E%3Cg fill='none' transform='rotate(${angle} 16 16)'%3E%3Cpath d='M22.4484 0L32 9.57891L22.4484 19.1478V13.1032C17.6121 13.8563 13.7935 17.6618 13.0479 22.4914H19.2141L9.60201 32.01L0 22.4813H6.54912C7.36524 14.1073 14.0453 7.44023 22.4484 6.61688V0Z' fill='white'/%3E%3Cpath d='M24.0605 3.89587L29.7229 9.57896L24.0605 15.252V11.3562C17.0479 11.4365 11.3753 17.0895 11.3048 24.0879H15.3048L9.60201 29.7308L3.90932 24.0879H8.0806C8.14106 15.3223 15.2645 8.22345 24.0605 8.14313V3.89587Z' fill='black'/%3E%3C/g%3E%3C/svg%3E \") 12 12,crosshair`;\n}\n\nfunction initControlsRotate(canvas: fabric.Canvas) {\n  // 添加旋转控制响应区域\n  fabric.Object.prototype.controls.mtr = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    offsetY: -10,\n    offsetX: -10,\n    rotate: 20,\n    actionName: 'rotate',\n    actionHandler: fabric.controlsUtils.rotationWithSnapping,\n    render: () => '',\n  });\n  // ↖左上\n  fabric.Object.prototype.controls.mtr2 = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    offsetY: -10,\n    offsetX: 10,\n    rotate: 20,\n    actionName: 'rotate',\n    actionHandler: fabric.controlsUtils.rotationWithSnapping,\n    render: () => '',\n  }); // ↗右上\n  fabric.Object.prototype.controls.mtr3 = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    offsetY: 10,\n    offsetX: 10,\n    rotate: 20,\n    actionName: 'rotate',\n    actionHandler: fabric.controlsUtils.rotationWithSnapping,\n    render: () => '',\n  }); // ↘右下\n  fabric.Object.prototype.controls.mtr4 = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    offsetY: 10,\n    offsetX: -10,\n    rotate: 20,\n    actionName: 'rotate',\n    actionHandler: fabric.controlsUtils.rotationWithSnapping,\n    render: () => '',\n  }); // ↙左下\n\n  // 渲染时，执行\n  canvas.on('after:render', () => {\n    const activeObj = canvas.getActiveObject();\n    const angle = activeObj?.angle?.toFixed(2);\n    if (angle !== undefined) {\n      fabric.Object.prototype.controls.mtr.cursorStyle = rotateIcon(Number(angle));\n      fabric.Object.prototype.controls.mtr2.cursorStyle = rotateIcon(Number(angle) + 90);\n      fabric.Object.prototype.controls.mtr3.cursorStyle = rotateIcon(Number(angle) + 180);\n      fabric.Object.prototype.controls.mtr4.cursorStyle = rotateIcon(Number(angle) + 270);\n    }\n  });\n\n  // 旋转时，实时更新旋转控制图标\n  canvas.on('object:rotating', (event) => {\n    const body = canvas.lowerCanvasEl.nextSibling as HTMLElement;\n    const angle = canvas.getActiveObject()?.angle?.toFixed(2);\n    if (angle === undefined) return;\n    switch (event.transform?.corner) {\n      case 'mtr':\n        body.style.cursor = rotateIcon(Number(angle));\n        break;\n      case 'mtr2':\n        body.style.cursor = rotateIcon(Number(angle) + 90);\n        break;\n      case 'mtr3':\n        body.style.cursor = rotateIcon(Number(angle) + 180);\n        break;\n      case 'mtr4':\n        body.style.cursor = rotateIcon(Number(angle) + 270);\n        break;\n      default:\n        break;\n    } // 设置四角旋转光标\n  });\n}\n\nexport default initControlsRotate;\n","// @ts-nocheck\nimport { fabric } from 'fabric';\n\nclass CenterAlign {\n  canvas: fabric.Canvas;\n  constructor(canvas: fabric.Canvas) {\n    this.canvas = canvas;\n  }\n\n  centerH(workspace: fabric.Rect, object: fabric.Object) {\n    return this.canvas._centerObject(\n      object,\n      new fabric.Point(workspace.getCenterPoint().x, object.getCenterPoint().y)\n    );\n  }\n\n  center(workspace: fabric.Rect, object: fabric.Object) {\n    const center = workspace.getCenterPoint();\n    return this.canvas._centerObject(object, center);\n  }\n\n  centerV(workspace: fabric.Rect, object: fabric.Object) {\n    return this.canvas._centerObject(\n      object,\n      new fabric.Point(object.getCenterPoint().x, workspace.getCenterPoint().y)\n    );\n  }\n\n  position(name: 'centerH' | 'center' | 'centerV') {\n    const anignType = ['centerH', 'center', 'centerV'];\n    const activeObject = this.canvas.getActiveObject();\n    if (anignType.includes(name) && activeObject) {\n      const defaultWorkspace = this.canvas.getObjects().find((item) => item.id === 'workspace');\n      if (defaultWorkspace) {\n        this[name](defaultWorkspace, activeObject);\n      }\n      this.canvas.renderAll();\n    }\n  }\n}\n\nexport default CenterAlign;\n","export const KeyNames = {\n  lrdu: 'left,right,down,up', // 上下左右移动\n  shiftMove: 'shift+left,shift+right,shift+down,shift+up',\n  delete: 'delete,backspace',// 删除\n  ctrlz: 'ctrl+z,command+z', // 撤销\n  ctrlshiftz: 'ctrl+shift+z,command+shift+z', // 重做\n  enter: 'enter',\n  esc: 'esc',\n  zoom:'command+*,command+*,ctrl+*,ctrl+*'\n};\n","export const Types = {\n  /**\n   * 比例修改\n   */\n  CHANGE_SCALE: 'changeScale',\n  /**\n   * 监听画布修改啊，这个事件用来做数据存储的，主要是增删改会调用\n   * TODO 如果新增了增删改的操作记得调用这个方法\n   */\n  CANVAS_CHANGE: 'canvasChange',\n  /**\n   * 剪裁图片\n   */\n  CLIP_IMAGE: 'clipImage',\n\n  SHOW_LOADING: 'show_loading'\n}\n","import EventEmitter from 'events'\nimport { Types } from './types';\n\n\nexport const events = new EventEmitter()\nexport { Types }\n","export const isObject = (value: unknown): value is Record<any, any> =>\n  value !== null && typeof value === 'object';\nexport const isFunction = (value: unknown): value is (...args: any) => any =>\n  typeof value === 'function';\nexport const isString = (value: unknown): value is string => typeof value === 'string';\nexport const isBoolean = (value: unknown): value is boolean => typeof value === 'boolean';\nexport const isNumber = (value: unknown): value is number => typeof value === 'number';\nexport const isUndef = (value: unknown): value is undefined => typeof value === 'undefined';\nexport const isUrl = (value: unknown): value is string => value && isString(value) && value.startsWith('http')\n","// @ts-nocheck\nimport { fabric } from 'fabric';\nimport { events, Types } from '../utils/events';\nimport { uuid } from '../utils/utils';\nimport { isNumber, isUndef } from '../utils';\nimport { scaleX, scaleY } from 'fontfaceobserver';\n// 竖线\nconst verticalImg = 'https://ossprod.jrdaimao.com/file/1691055918106919.svg'\n// 圆点\nconst edgeImg = 'https://ossprod.jrdaimao.com/file/1691055938230666.svg'\n// 旋转\nconst rotateImg = 'https://ossprod.jrdaimao.com/file/1691574701262500.svg'\n// 横线\nconst horizontalImg = 'https://ossprod.jrdaimao.com/file/1691055964267980.svg'\n// 复制\nconst copyImg = 'https://ossprod.jrdaimao.com/file/1691660518949720.svg'\n// 删除\nconst deleteImg = 'https://ossprod.jrdaimao.com/file/1691662370382182.svg'\n// 剪裁\nconst clipImg = 'https://ossprod.jrdaimao.com/file/1691718842537240.svg'\n// bg\nconst topBgImg = 'https://ossprod.jrdaimao.com/file/1691978616647204.svg'\n/**\n * 实际场景: 在进行某个对象缩放的时候，由于fabric.js默认精度使用的是toFixed(2)。\n * 此处为了缩放的精度更准确一些，因此将NUM_FRACTION_DIGITS默认值改为4，即toFixed(4).\n */\nfabric.Object.NUM_FRACTION_DIGITS = 4;\n\n// 隐藏八个角缩放按钮\nexport const setBaseControlVisible = (object, visible) => {\n  if (!object) return\n  object.setControlsVisibility({\n    mt: visible,\n    mb: visible,\n    ml: visible,\n    mr: visible,\n    tl: visible,\n    tr: visible,\n    bl: visible,\n    br: visible\n  })\n}\n// 隐藏自定义高级操作按钮\nexport const setHighControlVisible = (object, visible) => {\n  if (!object) return\n  object.setControlsVisibility({\n    copy: visible,\n    delete: visible,\n    clip: visible,\n    rotate: visible,\n    topBg: visible\n  })\n}\n\nfunction drawImg(\n  ctx: CanvasRenderingContext2D,\n  left: number,\n  top: number,\n  img: HTMLImageElement,\n  wSize: number,\n  hSize: number,\n  angle: number | undefined\n) {\n  if (angle === undefined) return;\n  ctx.save();\n  ctx.translate(left, top);\n  ctx.rotate(fabric.util.degreesToRadians(angle));\n  ctx.drawImage(img, -wSize / 2, -hSize / 2, wSize, hSize);\n  ctx.restore();\n}\n\n// 中间横杠\nfunction intervalControl() {\n  const verticalImgIcon = document.createElement('img');\n  verticalImgIcon.src = verticalImg;\n\n  const horizontalImgIcon = document.createElement('img');\n  horizontalImgIcon.src = horizontalImg;\n\n  function renderIcon(\n    ctx: CanvasRenderingContext2D,\n    left: number,\n    top: number,\n    styleOverride: any,\n    fabricObject: fabric.Object\n  ) {\n    drawImg(ctx, left, top, verticalImgIcon, 20, 25, fabricObject.angle);\n  }\n\n  function renderIconHoz(\n    ctx: CanvasRenderingContext2D,\n    left: number,\n    top: number,\n    styleOverride: any,\n    fabricObject: fabric.Object\n  ) {\n    drawImg(ctx, left, top, horizontalImgIcon, 25, 20, fabricObject.angle);\n  }\n\n  // 中间横杠\n  fabric.Object.prototype.controls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    offsetX: -1,\n    cursorStyleHandler: fabric.controlsUtils.scaleSkewCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingXOrSkewingY,\n    getActionName: fabric.controlsUtils.scaleOrSkewActionName,\n    render: renderIcon,\n  });\n\n  fabric.Object.prototype.controls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    offsetX: 1,\n    cursorStyleHandler: fabric.controlsUtils.scaleSkewCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingXOrSkewingY,\n    getActionName: fabric.controlsUtils.scaleOrSkewActionName,\n    render: renderIcon,\n  });\n\n  fabric.Object.prototype.controls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    offsetY: 1,\n    cursorStyleHandler: fabric.controlsUtils.scaleSkewCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingYOrSkewingX,\n    getActionName: fabric.controlsUtils.scaleOrSkewActionName,\n    render: renderIconHoz,\n  });\n\n  fabric.Object.prototype.controls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    offsetY: -1,\n    cursorStyleHandler: fabric.controlsUtils.scaleSkewCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingYOrSkewingX,\n    getActionName: fabric.controlsUtils.scaleOrSkewActionName,\n    render: renderIconHoz,\n  });\n}\n\n// 顶点\nfunction peakControl() {\n  const img = document.createElement('img');\n  img.src = edgeImg;\n\n  function renderIconEdge(\n    ctx: CanvasRenderingContext2D,\n    left: number,\n    top: number,\n    styleOverride: any,\n    fabricObject: fabric.Object\n  ) {\n    drawImg(ctx, left, top, img, 25, 25, fabricObject.angle);\n  }\n\n  // 四角图标\n  fabric.Object.prototype.controls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.scaleCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingEqually,\n    render: renderIconEdge,\n  });\n  fabric.Object.prototype.controls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: fabric.controlsUtils.scaleCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingEqually,\n    render: renderIconEdge,\n  });\n  fabric.Object.prototype.controls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.scaleCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingEqually,\n    render: renderIconEdge,\n  });\n  fabric.Object.prototype.controls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: fabric.controlsUtils.scaleCursorStyleHandler,\n    actionHandler: fabric.controlsUtils.scalingEqually,\n    render: renderIconEdge,\n  });\n}\n\n// 旋转\nfunction rotationControl() {\n  const img = document.createElement('img');\n  img.src = rotateImg;\n\n  function renderIconRotate(\n    ctx: CanvasRenderingContext2D,\n    left: number,\n    top: number,\n    styleOverride: any,\n    fabricObject: fabric.Object\n  ) {\n    drawImg(ctx, left, top, img, 60, 60, fabricObject.angle);\n  }\n\n  // 旋转图标\n  fabric.Object.prototype.controls.rotate = new fabric.Control({\n    y: 0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    actionHandler: fabric.controlsUtils.rotationWithSnapping,\n    offsetY: 25,\n    actionName: 'rotate',\n    cursorStyle: 'pointer',\n    render: renderIconRotate,\n  });\n\n}\n\n// 自定义操作\nfunction initMainControl() {\n  const topBgEl = document.createElement('img')\n  topBgEl.src = topBgImg\n  const copyImageEl = document.createElement('img')\n  copyImageEl.src = copyImg\n  const deleteImageEl = document.createElement('img')\n  deleteImageEl.src = deleteImg\n  const clipImageEl = document.createElement('img')\n  clipImageEl.src = clipImg\n\n  function cloneObject(eventData, transform) {\n    const target = transform.target;\n    if (!target) return\n    const canvas = target.canvas;\n    events.emit(Types.SHOW_LOADING, true)\n    target.clone(function (cloned) {\n      cloned.set({\n        id: uuid(),\n        left: target.left + 20,\n        top: target.top + 20,\n        sourceSrc: target.sourceSrc,\n        rawScaleX: target.rawScaleX,\n        rawScaleY: target.rawScaleY,\n        rectDiffLeft: target.rectDiffLeft,\n        rectDiffTop: target.rectDiffTop,\n        prevWidth: target.prevWidth,\n        prevHeight: target.prevHeight\n      })\n      cloned.setCoords()\n      canvas.add(cloned)\n      canvas.setActiveObject(cloned)\n      canvas.renderAll()\n      events.emit(Types.SHOW_LOADING, false)\n    });\n  }\n\n  function deleteObject(eventData, transform) {\n    const target = transform.target;\n    if (!target) return\n    const canvas = target.canvas;\n    const clipRect = canvas.getObjects().find(item => item.id === 'currentClipRect')\n    if (clipRect) {\n      canvas.remove(clipRect)\n    }\n    canvas.remove(target);\n    canvas.requestRenderAll();\n  }\n\n  function clipObject(eventData, transform) {\n    const image = transform.target;\n    if (image.type !== 'image') return\n    const canvas = image.canvas;\n    const rectLeft = image.left // 矩形的位置X\n    const rectTop = image.top // 矩形的位置Y\n    const sourceSrc = image.sourceSrc // 原图的src，做回显的时候需要用\n    const rawScaleX = image.rawScaleX || image.scaleX // 原图的缩放比例X\n    const rawScaleY = image.rawScaleY || image.scaleY // 原图的缩放比例Y\n    const rectDiffLeft = image.rectDiffLeft // 图片距离rect裁剪框的偏差X\n    const rectDiffTop = image.rectDiffTop // 图片距离rect裁剪框的偏差Y\n    const index = canvas.getObjects().findIndex(item => item.id === image.id); // 获取到裁剪之前的层级\n    const sourceWidth = image.getScaledWidth() // 获取图片的宽，这就是裁剪框的宽\n    const sourceHeight = image.getScaledHeight() // 获取图片的高，这就是裁剪框的高\n    image.clone((o) => image.set({cloneObject: o})) // 克隆一个object，取消裁剪的时候会用到\n    if (sourceSrc) {\n      // 如果有sourceSrc代表之前裁剪过，这里那原图的src进行返显\n      image.setSrc(sourceSrc, () => {\n        canvas.renderAll()\n      }, {crossOrigin: 'anonymous'})\n      /**\n       * 设置原图的位置和原图的缩放比\n       * 缩放比：这个是在外面操作的时候计算好的，直接赋值就行\n       * 位置：\n       */\n      image.set({\n        id: 'clipRawImage',\n        scaleX: rawScaleX,\n        scaleY: rawScaleY,\n        left: !isUndef(rectDiffLeft) ? image.left - (rectDiffLeft * image.scaleX) : image.left,\n        top: !isUndef(rectDiffTop) ? image.top - (rectDiffTop * image.scaleY) : image.top,\n      })\n    }\n    image.bringToFront() // 将这个图片的层级移动到顶层\n    setHighControlVisible(image, false) // 正在裁剪中的图片，把他的一些功能干掉\n    // 创建一个矩形，让他在图片的上面\n    const selectionRect = new fabric.Rect({\n      left: rectLeft,\n      top: rectTop,\n      fill: \"rgba(0,0,0,0.3)\",\n      originX: \"left\",\n      originY: \"top\",\n      stroke: \"black\",\n      opacity: 1,\n      width: sourceWidth,\n      height: sourceHeight,\n      hasRotatingPoint: false,\n      transparentCorners: false,\n      cornerColor: \"white\",\n      cornerStrokeColor: \"black\",\n      borderColor: \"black\",\n      cornerSize: 12,\n      padding: 0,\n      cornerStyle: \"circle\",\n      borderDashArray: [5, 5],\n      borderScaleFactor: 1.3,\n      id: 'currentClipRect',\n      lockMovementX: true,\n      lockMovementY: true,\n      hoverCursor: 'default'\n    });\n    // 存一下原图的src，因为后面裁剪后生成的图片就是base64了\n    image.set({sourceSrc: image.sourceSrc || image._element.src})\n\n    let selectionRectDown = false\n    let imageDown = false\n    // 监听鼠标按下事件\n    selectionRect.on('mousedown', ({}) => selectionRectDown = true)\n    // 监听鼠标缩放事件\n    selectionRect.on('scaling', () => selectionRectDown = false)\n    // 控制rect的拖动区域\n    selectionRect.on('mousemove', ({e}) => {\n      if (!selectionRectDown) return\n      setBaseControlVisible(selectionRect, false)\n      image.set({\n        left: image.left + e.movementX,\n        top: image.top + e.movementY\n      });\n      if (image.left > selectionRect.left) {\n        image.set({left: selectionRect.left})\n      }\n      const rectWidth = selectionRect.getScaledWidth()\n      if (image.left + image.getScaledWidth() <= selectionRect.left + rectWidth) {\n        image.set({left: selectionRect.left + rectWidth - image.getScaledWidth()})\n      }\n      if (image.top > selectionRect.top) {\n        image.set({top: selectionRect.top})\n      }\n      const rectHeight = selectionRect.getScaledHeight()\n      if (image.top + image.getScaledHeight() <= selectionRect.top + rectHeight) {\n        image.set({top: selectionRect.top + rectHeight - image.getScaledHeight()})\n      }\n      canvas.renderAll()\n    })\n    // 监听鼠标抬起事件\n    selectionRect.on('mouseup', () => {\n      selectionRectDown = false\n      setBaseControlVisible(selectionRect, true)\n      canvas.renderAll()\n    })\n    // 监听rect八个角缩放的事件\n    selectionRect.on('scaling', (e) => {\n      const rect = e.transform.target\n      if (rect.left < image.left) {\n        rect.set({left: image.left})\n      }\n      if (rect.top < image.top) {\n        rect.set({top: image.top})\n      }\n      if (rect.left + rect.getScaledWidth() > image.left + image.getScaledWidth()) {\n        rect.set({left: image.left + image.getScaledWidth() - rect.getScaledWidth()})\n      }\n      if (rect.top + rect.getScaledHeight() > image.top + image.getScaledHeight()) {\n        rect.set({top: image.top + image.getScaledHeight() - rect.getScaledHeight()})\n      }\n      if (image.getScaledWidth() / rect.getScaledWidth() < 1) {\n        rect.set({\n          scaleX: image.getScaledWidth() / selectionRect.getScaledWidth() * rect.get('scaleX'),\n          left: image.left,\n        })\n      }\n      if (image.getScaledHeight() / rect.getScaledHeight() < 1) {\n        rect.set({\n          scaleY: image.getScaledHeight() / selectionRect.getScaledHeight() * rect.get('scaleY'),\n          top: image.top\n        })\n      }\n      canvas.renderAll()\n    });\n    // 控制图片的拖动区域\n    image.on('moving', (e) => {\n      const image = e.transform.target\n      if (image.left > selectionRect.left) {\n        image.set({left: selectionRect.left})\n      }\n      if (image.top > selectionRect.top) {\n        image.set({top: selectionRect.top})\n      }\n      const rectWidth = selectionRect.getScaledWidth()\n      if (image.left < selectionRect.left + rectWidth - image.getScaledWidth()) {\n        image.set({left: selectionRect.left + rectWidth - image.getScaledWidth()})\n      }\n      const rectHeight = selectionRect.getScaledHeight()\n      if (image.top < selectionRect.top + rectHeight - image.getScaledHeight()) {\n        image.set({top: selectionRect.top + rectHeight - image.getScaledHeight()})\n      }\n      canvas.renderAll()\n    })\n    // 监听图片八个角缩放事件\n    image.on('scaling', (e) => {\n      const image = e.transform.target\n      if (image.left > selectionRect.left) {\n        image.set({left: selectionRect.left})\n      }\n      if (image.top > selectionRect.top) {\n        image.set({top: selectionRect.top})\n      }\n      if (selectionRect.getScaledWidth() / image.getScaledWidth() > 1) {\n        image.set({scaleX: selectionRect.getScaledWidth() * image.get('scaleX') / image.getScaledWidth()})\n      }\n      if (selectionRect.getScaledHeight() / image.getScaledHeight() > 1) {\n        image.set({scaleY: selectionRect.getScaledHeight() * image.get('scaleY') / image.getScaledHeight()})\n      }\n      canvas.renderAll()\n    });\n    image.on('mousedown', () => imageDown = true)\n    image.on('mousemove', () => {\n      if (imageDown) {\n        setBaseControlVisible(image, false)\n        canvas.renderAll()\n      }\n    })\n    image.on('mouseup', () => {\n      imageDown = false\n      setBaseControlVisible(image, true)\n      canvas.renderAll()\n    })\n    // 矩形不要操作按钮，将它们隐藏\n    setHighControlVisible(selectionRect, false)\n    canvas.add(selectionRect);\n    canvas.setActiveObject(selectionRect)\n    canvas.renderAll();\n    // 告诉HeaderControl我要开始裁剪了\n    events.emit(Types.CLIP_IMAGE, {\n      visible: true, // 展示裁剪确定、取消按钮\n      rawIndex: index, // 裁剪之前的层级index\n      clipImageId: image.id, // 正在被裁剪的图片的id\n    })\n  }\n\n  fabric.Object.prototype.controls.topBg = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: () => {\n    },\n    offsetY: -25,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'image') {\n        drawImg(ctx, left, top, topBgEl, 136, 68, fabricObject.angle);\n      }\n      if (fabricObject.type === 'i-text') {\n        drawImg(ctx, left, top, topBgEl, 90, 68, fabricObject.angle);\n      }\n    },\n  });\n  // 复制\n  fabric.Object.prototype.controls.copy = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: cloneObject,\n    offsetY: -25,\n    offsetX: -30,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'image') {\n        drawImg(ctx, left, top, copyImageEl, 30, 30, fabricObject.angle);\n      }\n    },\n  });\n  // 删除\n  fabric.Object.prototype.controls.delete = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: deleteObject,\n    offsetY: -25,\n    offsetX: 30,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'image') {\n        drawImg(ctx, left, top, deleteImageEl, 30, 30, fabricObject.angle);\n      }\n    },\n  });\n  // 剪裁\n  fabric.Object.prototype.controls.clip = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: clipObject,\n    offsetY: -25,\n    offsetX: 0,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'image') {\n        drawImg(ctx, left, top, clipImageEl, 30, 30, fabricObject.angle);\n      }\n    },\n  });\n  // 复制\n  fabric.Object.prototype.controls.textC = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: cloneObject,\n    offsetY: -25,\n    offsetX: -15,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'i-text') {\n        drawImg(ctx, left, top, copyImageEl, 30, 30, fabricObject.angle);\n      }\n    },\n  });\n  // 删除\n  fabric.Object.prototype.controls.textdelete = new fabric.Control({\n    y: -0.5,\n    cursorStyleHandler: fabric.controlsUtils.rotationStyleHandler,\n    mouseUpHandler: deleteObject,\n    offsetY: -25,\n    offsetX: 15,\n    cursorStyle: 'pointer',\n    render: (ctx, left, top, styleOverride, fabricObject) => {\n      if (fabricObject.type === 'i-text') {\n        drawImg(ctx, left, top, deleteImageEl, 30, 30, fabricObject.angle);\n      }\n    },\n  });\n}\n\nfunction initControls(canvas: fabric.Canvas) {\n  // 顶点图标\n  peakControl();\n  // 中间横杠图标\n  intervalControl();\n  // 旋转图标\n  rotationControl();\n  // 初始化自定义操作\n  initMainControl();\n\n  // 选中样式\n  fabric.Object.prototype.set({\n    transparentCorners: false,\n    borderColor: '#51B9F9',\n    cornerColor: '#FFF',\n    borderScaleFactor: 2.5,\n    cornerStyle: 'circle',\n    cornerStrokeColor: '#0E98FC',\n    borderOpacityWhenMoving: 1,\n  });\n  // textbox保持一致\n  // fabric.Textbox.prototype.controls = fabric.Object.prototype.controls;\n}\n\nexport default initControls;\n","import type { Rect } from './ruler';\nimport { fabric } from 'fabric';\n\n/**\n * 计算尺子间距\n * @param zoom 缩放比例\n * @returns 返回计算出的尺子间距\n */\nconst getGap = (zoom: number) => {\n  const zooms = [0.02, 0.03, 0.05, 0.1, 0.2, 0.5, 1, 2, 5, 10, 18];\n  const gaps = [5000, 2500, 1000, 500, 250, 100, 50, 25, 10, 5, 2];\n\n  let i = 0;\n  while (i < zooms.length && zooms[i] < zoom) {\n    i++;\n  }\n\n  return gaps[i - 1] || 5000;\n};\n\n/**\n * 线段合并\n * @param rect Rect数组\n * @param isHorizontal\n * @returns 合并后的Rect数组\n */\nconst mergeLines = (rect: Rect[], isHorizontal: boolean) => {\n  const axis = isHorizontal ? 'left' : 'top';\n  const length = isHorizontal ? 'width' : 'height';\n  // 先按照 axis 的大小排序\n  rect.sort((a, b) => a[axis] - b[axis]);\n  const mergedLines = [];\n  let currentLine = Object.assign({}, rect[0]);\n  for (const item of rect) {\n    const line = Object.assign({}, item);\n    if (currentLine[axis] + currentLine[length] >= line[axis]) {\n      // 当前线段和下一个线段相交，合并宽度\n      currentLine[length] =\n        Math.max(currentLine[axis] + currentLine[length], line[axis] + line[length]) -\n        currentLine[axis];\n    } else {\n      // 当前线段和下一个线段不相交，将当前线段加入结果数组中，并更新当前线段为下一个线段\n      mergedLines.push(currentLine);\n      currentLine = Object.assign({}, line);\n    }\n  }\n  // 加入数组\n  mergedLines.push(currentLine);\n  return mergedLines;\n};\n\nconst darwLine = (\n  ctx: CanvasRenderingContext2D,\n  options: {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n    stroke?: string | CanvasGradient | CanvasPattern;\n    lineWidth?: number;\n  }\n) => {\n  ctx.save();\n  const { left, top, width, height, stroke, lineWidth } = options;\n  ctx.beginPath();\n  stroke && (ctx.strokeStyle = stroke);\n  ctx.lineWidth = lineWidth || 1;\n  ctx.moveTo(left, top);\n  ctx.lineTo(left + width, top + height);\n  ctx.stroke();\n  ctx.restore();\n};\n\nconst darwText = (\n  ctx: CanvasRenderingContext2D,\n  options: {\n    left: number;\n    top: number;\n    text: string;\n    fill?: string | CanvasGradient | CanvasPattern;\n    align?: CanvasTextAlign;\n    angle?: number;\n    fontSize?: number;\n  }\n) => {\n  ctx.save();\n  const { left, top, text, fill, align, angle, fontSize } = options;\n  fill && (ctx.fillStyle = fill);\n  ctx.textAlign = align || 'left';\n  ctx.textBaseline = 'top';\n  ctx.font = `${fontSize || 10}px sans-serif`;\n  if (angle) {\n    ctx.translate(left, top);\n    ctx.rotate((Math.PI / 180) * angle);\n    ctx.translate(-left, -top);\n  }\n  ctx.fillText(text, left, top);\n  ctx.restore();\n};\n\nconst darwRect = (\n  ctx: CanvasRenderingContext2D,\n  options: {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n    fill?: string | CanvasGradient | CanvasPattern;\n    stroke?: string;\n    strokeWidth?: number;\n  }\n) => {\n  ctx.save();\n  const { left, top, width, height, fill, stroke, strokeWidth } = options;\n  ctx.beginPath();\n  fill && (ctx.fillStyle = fill);\n  ctx.rect(left, top, width, height);\n  ctx.fill();\n  if (stroke) {\n    ctx.strokeStyle = stroke;\n    ctx.lineWidth = strokeWidth || 1;\n    ctx.stroke();\n  }\n  ctx.restore();\n};\n\nconst drawMask = (\n  ctx: CanvasRenderingContext2D,\n  options: {\n    isHorizontal: boolean;\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n    backgroundColor: string;\n  }\n) => {\n  ctx.save();\n  const { isHorizontal, left, top, width, height, backgroundColor } = options;\n  // 创建一个线性渐变对象\n  const gradient = isHorizontal\n    ? ctx.createLinearGradient(left, height / 2, left + width, height / 2)\n    : ctx.createLinearGradient(width / 2, top, width / 2, height + top);\n  const transparentColor = new fabric.Color(backgroundColor);\n  transparentColor.setAlpha(0);\n  gradient.addColorStop(0, transparentColor.toRgba());\n  gradient.addColorStop(0.33, backgroundColor);\n  gradient.addColorStop(0.67, backgroundColor);\n  gradient.addColorStop(1, transparentColor.toRgba());\n  darwRect(ctx, {\n    left,\n    top,\n    width,\n    height,\n    fill: gradient,\n  });\n  ctx.restore();\n};\n\nexport { getGap, mergeLines, darwRect, darwText, darwLine, drawMask };\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n// @ts-nocheck\nimport { fabric } from 'fabric';\n\nexport function setupGuideLine() {\n  if (fabric.GuideLine) {\n    return;\n  }\n\n  fabric.GuideLine = fabric.util.createClass(fabric.Line, {\n    type: 'GuideLine',\n    selectable: false,\n    hasControls: false,\n    hasBorders: false,\n    stroke: '#4bec13',\n    originX: 'center',\n    originY: 'center',\n    padding: 4, // 填充，让辅助线选择范围更大，方便选中\n    globalCompositeOperation: 'difference',\n    axis: 'horizontal',\n    // excludeFromExport: true,\n\n    initialize(points, options) {\n      const isHorizontal = options.axis === 'horizontal';\n      // 指针\n      this.hoverCursor = isHorizontal ? 'ns-resize' : 'ew-resize';\n      // 设置新的点\n      const newPoints = isHorizontal\n        ? [-999999, points, 999999, points]\n        : [points, -999999, points, 999999];\n      // 锁定移动\n      options[isHorizontal ? 'lockMovementX' : 'lockMovementY'] = true;\n      // 调用父类初始化\n      this.callSuper('initialize', newPoints, options);\n\n      // 绑定事件\n      this.on('mousedown:before', (e) => {\n        if (this.activeOn === 'down') {\n          // 设置selectable:false后激活对象才能进行移动\n          this.canvas.setActiveObject(this, e.e);\n        }\n      });\n\n      this.on('moving', (e) => {\n        if (this.canvas.ruler.options.enabled && this.isPointOnRuler(e.e)) {\n          this.moveCursor = 'not-allowed';\n        } else {\n          this.moveCursor = this.isHorizontal() ? 'ns-resize' : 'ew-resize';\n        }\n        this.canvas.fire('guideline:moving', {\n          target: this,\n          e: e.e,\n        });\n      });\n\n      this.on('mouseup', (e) => {\n        // 移动到标尺上，移除辅助线\n        if (this.canvas.ruler.options.enabled && this.isPointOnRuler(e.e)) {\n          // console.log('移除辅助线', this);\n          this.canvas.remove(this);\n          return;\n        }\n        this.moveCursor = this.isHorizontal() ? 'ns-resize' : 'ew-resize';\n        this.canvas.fire('guideline:mouseup', {\n          target: this,\n          e: e.e,\n        });\n      });\n\n      this.on('removed', () => {\n        this.off('removed');\n        this.off('mousedown:before');\n        this.off('moving');\n        this.off('mouseup');\n      });\n    },\n\n    getBoundingRect(absolute, calculate) {\n      this.bringToFront();\n\n      const isHorizontal = this.isHorizontal();\n      const rect = this.callSuper('getBoundingRect', absolute, calculate);\n      rect[isHorizontal ? 'top' : 'left'] += rect[isHorizontal ? 'height' : 'width'] / 2;\n      rect[isHorizontal ? 'height' : 'width'] = 0;\n      return rect;\n    },\n\n    isPointOnRuler(e) {\n      const isHorizontal = this.isHorizontal();\n      const hoveredRuler = this.canvas.ruler.isPointOnRuler(new fabric.Point(e.offsetX, e.offsetY));\n      if (\n        (isHorizontal && hoveredRuler === 'horizontal') ||\n        (!isHorizontal && hoveredRuler === 'vertical')\n      ) {\n        return hoveredRuler;\n      }\n      return false;\n    },\n\n    isHorizontal() {\n      return this.height === 0;\n    },\n  } as fabric.IGuideLineClassOptions);\n\n  fabric.GuideLine.fromObject = function (object, callback) {\n    const clone = fabric.util.object.clone as (object: any, deep: boolean) => any;\n\n    function _callback(instance: any) {\n      delete instance.xy;\n      callback && callback(instance);\n    }\n\n    const options = clone(object, true);\n    const isHorizontal = options.height === 0;\n\n    options.xy = isHorizontal ? options.y1 : options.x1;\n    options.axis = isHorizontal ? 'horizontal' : 'vertical';\n\n    fabric.Object._fromObject(options.type, options, _callback, 'xy');\n  };\n}\n\nexport default fabric.GuideLine;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n// @ts-nocheck\nimport { Canvas, Point, IEvent } from 'fabric/fabric-impl';\nimport { fabric } from 'fabric';\nimport { getGap, mergeLines, darwRect, darwText, darwLine, drawMask } from './utils';\nimport { throttle } from '../../utils/utils';\nimport { setupGuideLine } from './guideline';\n\n/**\n * 配置\n */\nexport interface RulerOptions {\n  /**\n   * Canvas\n   */\n  canvas: Canvas;\n\n  /**\n   * 标尺宽高\n   * @default 20\n   */\n  ruleSize?: number;\n\n  /**\n   * 字体大小\n   * @default 10\n   */\n  fontSize?: number;\n\n  /**\n   * 是否开启标尺\n   * @default false\n   */\n  enabled?: boolean;\n\n  /**\n   * 背景颜色\n   */\n  backgroundColor?: string;\n\n  /**\n   * 文字颜色\n   */\n  textColor?: string;\n\n  /**\n   * 边框颜色\n   */\n  borderColor?: string;\n\n  /**\n   * 高亮颜色\n   */\n  highlightColor?: string;\n}\n\nexport type Rect = { left: number; top: number; width: number; height: number };\n\nexport type HighlightRect = {\n  skip?: 'x' | 'y';\n} & Rect;\n\nclass CanvasRuler {\n  protected ctx: CanvasRenderingContext2D;\n\n  /**\n   * 配置\n   */\n  public options: Required<RulerOptions>;\n\n  /**\n   * 标尺起始点\n   */\n  public startCalibration: undefined | Point;\n\n  private activeOn: 'down' | 'up' = 'up';\n\n  /**\n   * 选取对象矩形坐标\n   */\n  private objectRect:\n    | undefined\n    | {\n        x: HighlightRect[];\n        y: HighlightRect[];\n      };\n\n  /**\n   * 事件句柄缓存\n   */\n  private eventHandler: Record<string, (...args: any) => void> = {\n    // calcCalibration: this.calcCalibration.bind(this),\n    calcObjectRect: throttle(this.calcObjectRect.bind(this), 15),\n    clearStatus: this.clearStatus.bind(this),\n    canvasMouseDown: this.canvasMouseDown.bind(this),\n    canvasMouseMove: throttle(this.canvasMouseMove.bind(this), 15),\n    canvasMouseUp: this.canvasMouseUp.bind(this),\n    render: (e: any) => {\n      // 避免多次渲染\n      if (!e.ctx) return;\n      this.render();\n    },\n  };\n\n  private lastAttr: {\n    status: 'out' | 'horizontal' | 'vertical';\n    cursor: string | undefined;\n    selection: boolean | undefined;\n  } = {\n    status: 'out',\n    cursor: undefined,\n    selection: undefined,\n  };\n\n  private tempGuidelLine: fabric.GuideLine | undefined;\n\n  constructor(_options: RulerOptions) {\n    // 合并默认配置\n    this.options = Object.assign(\n      {\n        ruleSize: 20,\n        fontSize: 10,\n        enabled: false,\n        backgroundColor: '#fff',\n        borderColor: '#ddd',\n        highlightColor: '#007fff',\n        textColor: '#888',\n      },\n      _options\n    );\n\n    this.ctx = this.options.canvas.getContext();\n\n    fabric.util.object.extend(this.options.canvas, {\n      ruler: this,\n    });\n\n    setupGuideLine();\n\n    if (this.options.enabled) {\n      this.enable();\n    }\n  }\n\n  // 销毁\n  public destroy() {\n    this.disable();\n  }\n\n  /**\n   * 移除全部辅助线\n   */\n  public clearGuideline() {\n    this.options.canvas.remove(...this.options.canvas.getObjects(fabric.GuideLine.prototype.type));\n  }\n\n  /**\n   * 显示全部辅助线\n   */\n  public showGuideline() {\n    this.options.canvas.getObjects(fabric.GuideLine.prototype.type).forEach((guideLine) => {\n      guideLine.set('visible', true);\n    });\n    this.options.canvas.renderAll();\n  }\n\n  /**\n   * 隐藏全部辅助线\n   */\n  public hideGuideline() {\n    this.options.canvas.getObjects(fabric.GuideLine.prototype.type).forEach((guideLine) => {\n      guideLine.set('visible', false);\n    });\n    this.options.canvas.renderAll();\n  }\n\n  /**\n   * 启用\n   */\n  public enable() {\n    this.options.enabled = true;\n\n    // 绑定事件\n    this.options.canvas.on('after:render', this.eventHandler.calcObjectRect);\n    this.options.canvas.on('after:render', this.eventHandler.render);\n    this.options.canvas.on('mouse:down', this.eventHandler.canvasMouseDown);\n    this.options.canvas.on('mouse:move', this.eventHandler.canvasMouseMove);\n    this.options.canvas.on('mouse:up', this.eventHandler.canvasMouseUp);\n    this.options.canvas.on('selection:cleared', this.eventHandler.clearStatus);\n\n    // 显示辅助线\n    this.showGuideline();\n\n    // 绘制一次\n    this.render();\n  }\n\n  /**\n   * 禁用\n   */\n  public disable() {\n    // 解除事件\n    this.options.canvas.off('after:render', this.eventHandler.calcObjectRect);\n    this.options.canvas.off('after:render', this.eventHandler.render);\n    this.options.canvas.off('mouse:down', this.eventHandler.canvasMouseDown);\n    this.options.canvas.off('mouse:move', this.eventHandler.canvasMouseMove);\n    this.options.canvas.off('mouse:up', this.eventHandler.canvasMouseUp);\n    this.options.canvas.off('selection:cleared', this.eventHandler.clearStatus);\n\n    // 隐藏辅助线\n    this.hideGuideline();\n\n    this.options.enabled = false;\n  }\n\n  /**\n   * 绘制\n   */\n  public render() {\n    // if (!this.options.enabled) return;\n    const vpt = this.options.canvas.viewportTransform;\n    if (!vpt) return;\n    // 绘制尺子\n    this.draw({\n      isHorizontal: true,\n      rulerLength: this.getSize().width,\n      // startCalibration: -(vpt[4] / vpt[0]),\n      startCalibration: this.startCalibration?.x ? this.startCalibration.x : -(vpt[4] / vpt[0]),\n    });\n    this.draw({\n      isHorizontal: false,\n      rulerLength: this.getSize().height,\n      // startCalibration: -(vpt[5] / vpt[3]),\n      startCalibration: this.startCalibration?.y ? this.startCalibration.y : -(vpt[5] / vpt[3]),\n    });\n    // 绘制左上角的遮罩\n    drawMask(this.ctx, {\n      isHorizontal: true,\n      left: -10,\n      top: -10,\n      width: this.options.ruleSize * 2 + 10,\n      height: this.options.ruleSize + 10,\n      backgroundColor: this.options.backgroundColor,\n    });\n    drawMask(this.ctx, {\n      isHorizontal: false,\n      left: -10,\n      top: -10,\n      width: this.options.ruleSize + 10,\n      height: this.options.ruleSize * 2 + 10,\n      backgroundColor: this.options.backgroundColor,\n    });\n  }\n\n  /**\n   * 获取画板尺寸\n   */\n  private getSize() {\n    return {\n      width: this.options.canvas.width || 0,\n      height: this.options.canvas.height || 0,\n    };\n  }\n\n  private getZoom() {\n    return this.options.canvas.getZoom();\n  }\n\n  private draw(opt: { isHorizontal: boolean; rulerLength: number; startCalibration: number }) {\n    const { isHorizontal, rulerLength, startCalibration } = opt;\n    const zoom = this.getZoom();\n\n    const gap = getGap(zoom);\n    const unitLength = rulerLength / zoom;\n    const startValue = Math[startCalibration > 0 ? 'floor' : 'ceil'](startCalibration / gap) * gap;\n    const startOffset = startValue - startCalibration;\n\n    // 标尺背景\n    const canvasSize = this.getSize();\n    darwRect(this.ctx, {\n      left: 0,\n      top: 0,\n      width: isHorizontal ? canvasSize.width : this.options.ruleSize,\n      height: isHorizontal ? this.options.ruleSize : canvasSize.height,\n      fill: this.options.backgroundColor,\n      stroke: this.options.borderColor,\n    });\n\n    // 颜色\n    const textColor = new fabric.Color(this.options.textColor);\n    // 标尺文字显示\n    for (let i = 0; i + startOffset <= Math.ceil(unitLength); i += gap) {\n      const position = (startOffset + i) * zoom;\n      const textValue = startValue + i + '';\n      const textLength = (10 * textValue.length) / 4;\n      const textX = isHorizontal\n        ? position - textLength - 1\n        : this.options.ruleSize / 2 - this.options.fontSize / 2 - 4;\n      const textY = isHorizontal\n        ? this.options.ruleSize / 2 - this.options.fontSize / 2 - 4\n        : position + textLength;\n      darwText(this.ctx, {\n        text: textValue,\n        left: textX,\n        top: textY,\n        fill: textColor.toRgb(),\n        angle: isHorizontal ? 0 : -90,\n      });\n    }\n\n    // 标尺刻度线显示\n    for (let j = 0; j + startOffset <= Math.ceil(unitLength); j += gap) {\n      const position = Math.round((startOffset + j) * zoom);\n      const left = isHorizontal ? position : this.options.ruleSize - 8;\n      const top = isHorizontal ? this.options.ruleSize - 8 : position;\n      const width = isHorizontal ? 0 : 8;\n      const height = isHorizontal ? 8 : 0;\n      darwLine(this.ctx, {\n        left,\n        top,\n        width,\n        height,\n        stroke: textColor.toRgb(),\n      });\n    }\n\n    // 标尺蓝色遮罩\n    if (this.objectRect) {\n      const axis = isHorizontal ? 'x' : 'y';\n      this.objectRect[axis].forEach((rect) => {\n        // 跳过指定矩形\n        if (rect.skip === axis) {\n          return;\n        }\n\n        // 获取数字的值\n        const roundFactor = (x: number) => Math.round(x / zoom + startCalibration) + '';\n        const leftTextVal = roundFactor(isHorizontal ? rect.left : rect.top);\n        const rightTextVal = roundFactor(\n          isHorizontal ? rect.left + rect.width : rect.top + rect.height\n        );\n\n        const isSameText = leftTextVal === rightTextVal;\n\n        // 背景遮罩\n        const maskOpt = {\n          isHorizontal,\n          width: isHorizontal ? 160 : this.options.ruleSize - 8,\n          height: isHorizontal ? this.options.ruleSize - 8 : 160,\n          backgroundColor: this.options.backgroundColor,\n        };\n        drawMask(this.ctx, {\n          ...maskOpt,\n          left: isHorizontal ? rect.left - 80 : 0,\n          top: isHorizontal ? 0 : rect.top - 80,\n        });\n        if (!isSameText) {\n          drawMask(this.ctx, {\n            ...maskOpt,\n            left: isHorizontal ? rect.width + rect.left - 80 : 0,\n            top: isHorizontal ? 0 : rect.height + rect.top - 80,\n          });\n        }\n\n        // 颜色\n        const highlightColor = new fabric.Color(this.options.highlightColor);\n\n        // 高亮遮罩\n        highlightColor.setAlpha(0.5);\n        darwRect(this.ctx, {\n          left: isHorizontal ? rect.left : this.options.ruleSize - 8,\n          top: isHorizontal ? this.options.ruleSize - 8 : rect.top,\n          width: isHorizontal ? rect.width : 8,\n          height: isHorizontal ? 8 : rect.height,\n          fill: highlightColor.toRgba(),\n        });\n\n        // 两边的数字\n        const pad = this.options.ruleSize / 2 - this.options.fontSize / 2 - 4;\n\n        const textOpt = {\n          fill: highlightColor.toRgba(),\n          angle: isHorizontal ? 0 : -90,\n        };\n\n        darwText(this.ctx, {\n          ...textOpt,\n          text: leftTextVal,\n          left: isHorizontal ? rect.left - 2 : pad,\n          top: isHorizontal ? pad : rect.top - 2,\n          align: isSameText ? 'center' : isHorizontal ? 'right' : 'left',\n        });\n\n        if (!isSameText) {\n          darwText(this.ctx, {\n            ...textOpt,\n            text: rightTextVal,\n            left: isHorizontal ? rect.left + rect.width + 2 : pad,\n            top: isHorizontal ? pad : rect.top + rect.height + 2,\n            align: isHorizontal ? 'left' : 'right',\n          });\n        }\n\n        // 两边的线\n        const lineSize = isSameText ? 8 : 14;\n\n        highlightColor.setAlpha(1);\n\n        const lineOpt = {\n          width: isHorizontal ? 0 : lineSize,\n          height: isHorizontal ? lineSize : 0,\n          stroke: highlightColor.toRgba(),\n        };\n\n        darwLine(this.ctx, {\n          ...lineOpt,\n          left: isHorizontal ? rect.left : this.options.ruleSize - lineSize,\n          top: isHorizontal ? this.options.ruleSize - lineSize : rect.top,\n        });\n\n        if (!isSameText) {\n          darwLine(this.ctx, {\n            ...lineOpt,\n            left: isHorizontal ? rect.left + rect.width : this.options.ruleSize - lineSize,\n            top: isHorizontal ? this.options.ruleSize - lineSize : rect.top + rect.height,\n          });\n        }\n      });\n    }\n    // draw end\n  }\n\n  /**\n   * 计算起始点\n   */\n  // private calcCalibration() {\n  //   if (this.startCalibration) return;\n  //   // console.log('calcCalibration');\n  //   const workspace = this.options.canvas.getObjects().find((item: any) => {\n  //     return item.id === 'workspace';\n  //   });\n  //   if (!workspace) return;\n  //   const rect = workspace.getBoundingRect(false);\n  //   this.startCalibration = new fabric.Point(-rect.left, -rect.top).divide(this.getZoom());\n  // }\n\n  private calcObjectRect() {\n    const activeObjects = this.options.canvas.getActiveObjects();\n    if (activeObjects.length === 0) return;\n    const allRect = activeObjects.reduce((rects, obj) => {\n      const rect: HighlightRect = obj.getBoundingRect(false, true);\n      // 如果是分组单独计算坐标\n      if (obj.group) {\n        const group = {\n          top: 0,\n          left: 0,\n          width: 0,\n          height: 0,\n          scaleX: 1,\n          scaleY: 1,\n          ...obj.group,\n        };\n        // 计算矩形坐标\n        rect.width *= group.scaleX;\n        rect.height *= group.scaleY;\n        const groupCenterX = group.width / 2 + group.left;\n        const objectOffsetFromCenterX = (group.width / 2 + (obj.left || 0)) * (1 - group.scaleX);\n        rect.left += (groupCenterX - objectOffsetFromCenterX) * this.getZoom();\n        const groupCenterY = group.height / 2 + group.top;\n        const objectOffsetFromCenterY = (group.height / 2 + (obj.top || 0)) * (1 - group.scaleY);\n        rect.top += (groupCenterY - objectOffsetFromCenterY) * this.getZoom();\n      }\n      if (obj instanceof fabric.GuideLine) {\n        rect.skip = obj.isHorizontal() ? 'x' : 'y';\n      }\n      rects.push(rect);\n      return rects;\n    }, [] as HighlightRect[]);\n    if (allRect.length === 0) return;\n    this.objectRect = {\n      x: mergeLines(allRect, true),\n      y: mergeLines(allRect, false),\n    };\n  }\n\n  /**\n   * 清除起始点和矩形坐标\n   */\n  private clearStatus() {\n    // this.startCalibration = undefined;\n    this.objectRect = undefined;\n  }\n\n  /**\n    判断鼠标是否在标尺上\n   * @param point\n   * @returns \"vertical\" | \"horizontal\" | false\n   */\n  public isPointOnRuler(point: Point) {\n    if (\n      new fabric.Rect({\n        left: 0,\n        top: 0,\n        width: this.options.ruleSize,\n        height: this.options.canvas.height,\n      }).containsPoint(point)\n    ) {\n      return 'vertical';\n    } else if (\n      new fabric.Rect({\n        left: 0,\n        top: 0,\n        width: this.options.canvas.width,\n        height: this.options.ruleSize,\n      }).containsPoint(point)\n    ) {\n      return 'horizontal';\n    }\n    return false;\n  }\n\n  private canvasMouseDown(e: IEvent<MouseEvent>) {\n    if (!e.pointer || !e.absolutePointer) return;\n    const hoveredRuler = this.isPointOnRuler(e.pointer);\n    if (hoveredRuler && this.activeOn === 'up') {\n      // 备份属性\n      this.lastAttr.selection = this.options.canvas.selection;\n      this.options.canvas.selection = false;\n      this.activeOn = 'down';\n\n      this.tempGuidelLine = new fabric.GuideLine(\n        hoveredRuler === 'horizontal' ? e.absolutePointer.y : e.absolutePointer.x,\n        {\n          axis: hoveredRuler,\n          visible: false,\n        }\n      );\n\n      this.options.canvas.add(this.tempGuidelLine);\n      this.options.canvas.setActiveObject(this.tempGuidelLine);\n\n      this.options.canvas._setupCurrentTransform(e.e, this.tempGuidelLine, true);\n\n      this.tempGuidelLine.fire('down', this.getCommonEventInfo(e));\n    }\n  }\n\n  private getCommonEventInfo = (e: IEvent<MouseEvent>) => {\n    if (!this.tempGuidelLine || !e.absolutePointer) return;\n    return {\n      e: e.e,\n      transform: this.tempGuidelLine.get('transform'),\n      pointer: {\n        x: e.absolutePointer.x,\n        y: e.absolutePointer.y,\n      },\n      target: this.tempGuidelLine,\n    };\n  };\n\n  private canvasMouseMove(e: IEvent<MouseEvent>) {\n    if (!e.pointer) return;\n\n    if (this.tempGuidelLine && e.absolutePointer) {\n      const pos: Partial<fabric.IGuideLineOptions> = {};\n      if (this.tempGuidelLine.axis === 'horizontal') {\n        pos.top = e.absolutePointer.y;\n      } else {\n        pos.left = e.absolutePointer.x;\n      }\n      this.tempGuidelLine.set({ ...pos, visible: true });\n\n      this.options.canvas.requestRenderAll();\n\n      const event = this.getCommonEventInfo(e);\n      this.options.canvas.fire('object:moving', event);\n      this.tempGuidelLine.fire('moving', event);\n    }\n\n    const hoveredRuler = this.isPointOnRuler(e.pointer);\n    if (!hoveredRuler) {\n      // 鼠标从里面出去\n      if (this.lastAttr.status !== 'out') {\n        // 更改鼠标指针\n        this.options.canvas.defaultCursor = this.lastAttr.cursor;\n        this.lastAttr.status = 'out';\n      }\n      return;\n    }\n    // const activeObjects = this.options.canvas.getActiveObjects();\n    // if (activeObjects.length === 1 && activeObjects[0] instanceof fabric.GuideLine) {\n    //   return;\n    // }\n    // 鼠标从外边进入 或 在另一侧标尺\n    if (this.lastAttr.status === 'out' || hoveredRuler !== this.lastAttr.status) {\n      // 更改鼠标指针\n      this.lastAttr.cursor = this.options.canvas.defaultCursor;\n      this.options.canvas.defaultCursor = hoveredRuler === 'horizontal' ? 'ns-resize' : 'ew-resize';\n      this.lastAttr.status = hoveredRuler;\n    }\n  }\n\n  private canvasMouseUp(e: IEvent<MouseEvent>) {\n    if (this.activeOn !== 'down') return;\n\n    // 还原属性\n    this.options.canvas.selection = this.lastAttr.selection;\n    this.activeOn = 'up';\n\n    this.tempGuidelLine?.fire('up', this.getCommonEventInfo(e));\n\n    this.tempGuidelLine = undefined;\n  }\n}\n\nexport default CanvasRuler;\n","// @ts-nocheck\nimport type { Canvas } from 'fabric/fabric-impl';\nimport { fabric } from 'fabric';\nimport CanvasRuler, { RulerOptions } from './ruler';\n\nfunction initRuler(canvas: Canvas, options?: RulerOptions) {\n  const ruler = new CanvasRuler({\n    canvas,\n    ...options,\n  });\n\n  // 辅助线移动到画板外删除\n  let workspace: fabric.Object | undefined = undefined;\n\n  /**\n   * 获取workspace\n   */\n  const getWorkspace = () => {\n    workspace = canvas.getObjects().find((item) => item.id === 'workspace');\n  };\n\n  /**\n   * 判断target是否在object矩形外\n   * @param object\n   * @param target\n   * @returns\n   */\n  const isRectOut = (object: fabric.Object, target: fabric.GuideLine): boolean => {\n    const { top, height, left, width } = object;\n\n    if (top === undefined || height === undefined || left === undefined || width === undefined) {\n      return false;\n    }\n\n    const targetRect = target.getBoundingRect(true, true);\n    const {\n      top: targetTop,\n      height: targetHeight,\n      left: targetLeft,\n      width: targetWidth,\n    } = targetRect;\n\n    if (\n      target.isHorizontal() &&\n      (top > targetTop + 1 || top + height < targetTop + targetHeight - 1)\n    ) {\n      return true;\n    } else if (\n      !target.isHorizontal() &&\n      (left > targetLeft + 1 || left + width < targetLeft + targetWidth - 1)\n    ) {\n      return true;\n    }\n\n    return false;\n  };\n\n  canvas.on('guideline:moving', (e) => {\n    if (!workspace) {\n      getWorkspace();\n      return;\n    }\n    const { target } = e;\n    if (isRectOut(workspace, target)) {\n      target.moveCursor = 'not-allowed';\n    }\n  });\n\n  canvas.on('guideline:mouseup', (e) => {\n    if (!workspace) {\n      getWorkspace();\n      return;\n    }\n    const { target } = e;\n    if (isRectOut(workspace, target)) {\n      canvas.remove(target);\n      canvas.setCursor(canvas.defaultCursor || '');\n    }\n  });\n  return ruler;\n}\n\nexport default initRuler;\n","// @ts-nocheck\nimport { fabric } from 'fabric';\nimport { uuid } from '../utils/utils';\n\nclass EditorGroupText {\n  canvas: fabric.Canvas;\n  isDown: boolean;\n  constructor(canvas: fabric.Canvas) {\n    this.canvas = canvas;\n    this._init();\n    this.isDown = false;\n  }\n\n  // 组内文本输入\n  _init() {\n    this.canvas.on('mouse:down', (opt) => {\n      this.isDown = true;\n      if (opt.target && opt.target.type === 'group') {\n        const textObject = this._getGroupTextObj(opt) as fabric.IText;\n        if (textObject) {\n          this._bedingEditingEvent(textObject, opt);\n          this.canvas.setActiveObject(textObject);\n          textObject.enterEditing();\n        } else {\n          this.canvas.setActiveObject(opt.target);\n        }\n      }\n    });\n\n    this.canvas.on('mouse:up', () => {\n      this.isDown = false;\n    });\n\n    this.canvas.on('mouse:move', (opt) => {\n      if (this.isDown && opt.target && opt.target.type === 'group') {\n        const textObject = this._getGroupTextObj(opt);\n        if (textObject) {\n          // todo bug 文字编辑结束后，点击组内其他元素可单独拖动\n        }\n      }\n    });\n  }\n\n  // 获取点击区域内的组内文字元素\n  _getGroupTextObj(opt: fabric.IEvent<MouseEvent>) {\n    const pointer = this.canvas.getPointer(opt.e, true);\n    const clickObj = this.canvas._searchPossibleTargets(opt.target?._objects, pointer);\n    if (clickObj && this.isText(clickObj)) {\n      return clickObj;\n    }\n    return false;\n  }\n\n  // 绑定编辑取消事件\n  _bedingEditingEvent(textObject: fabric.IText, opt: fabric.IEvent<MouseEvent>) {\n    if (!opt.target) return;\n    const left = opt.target.left;\n    const top = opt.target.top;\n    const ids = this._unGroup() || [];\n\n    const resetGroup = () => {\n      const groupArr = this.canvas.getObjects().filter((item) => item.id && ids.includes(item.id));\n      // 删除元素\n      groupArr.forEach((item) => this.canvas.remove(item));\n\n      // 生成新组\n      const group = new fabric.Group([...groupArr]);\n      group.set('left', left);\n      group.set('top', top);\n      group.set('id', uuid());\n      textObject.off('editing:exited', resetGroup);\n      this.canvas.add(group);\n      this.canvas.discardActiveObject().renderAll();\n    };\n    // 绑定取消事件\n    textObject.on('editing:exited', resetGroup);\n  }\n\n  // 拆分组合并返回ID\n  _unGroup() {\n    const ids: string[] = [];\n    const activeObj = this.canvas.getActiveObject() as fabric.Group;\n    if (!activeObj) return;\n    activeObj.getObjects().forEach((item) => {\n      const id = uuid();\n      ids.push(id);\n      item.set('id', id);\n    });\n    activeObj.toActiveSelection();\n    return ids;\n  }\n\n  isText(obj: fabric.Object) {\n    return obj.type && ['i-text', 'text', 'textbox'].includes(obj.type);\n  }\n}\n\nexport default EditorGroupText;\n","// @ts-nocheck\nimport EventEmitter from 'events';\nimport { uuid } from '../utils/utils';\n\n// 对齐辅助线\nimport initAligningGuidelines from './initAligningGuidelines';\nimport initControlsRotate from './initControlsRotate';\nimport InitCenterAlign from './initCenterAlign';\nimport initHotkeys from './initHotKeys';\nimport initControls from './initControls';\nimport initRuler from './ruler';\nimport EditorGroupText from './EditorGroupText';\nimport type CanvasRuler from './ruler/ruler';\nimport type EditorWorkspace from './EditorWorkspace';\n\nimport type { fabric } from 'fabric';\n\nclass Editor extends EventEmitter {\n  canvas: fabric.Canvas;\n  editorWorkspace: EditorWorkspace | null;\n  centerAlign: InitCenterAlign;\n  ruler: CanvasRuler;\n  disableGuidelines: () => void\n  enableGuidelines: () => void\n\n  constructor(canvas: fabric.Canvas) {\n    super();\n    this.canvas = canvas;\n    this.editorWorkspace = null;\n    const {disable, enable} = initAligningGuidelines(canvas);\n    this.disableGuidelines = disable\n    this.enableGuidelines = enable\n    initHotkeys(canvas, this);\n    initControls(canvas);\n    initControlsRotate(canvas);\n    new EditorGroupText(canvas);\n    this.centerAlign = new InitCenterAlign(canvas);\n    this.ruler = initRuler(canvas);\n  }\n\n  // 多选对象复制\n  _copyActiveSelection(activeObject: fabric.Object) {\n    // 间距设置\n    const grid = 10;\n    const canvas = this.canvas;\n    activeObject?.clone((cloned: fabric.Object) => {\n      // 再次进行克隆，处理选择多个对象的情况\n      cloned.clone((clonedObj: fabric.ActiveSelection) => {\n        canvas.discardActiveObject();\n        if (clonedObj.left === undefined || clonedObj.top === undefined) return;\n        // 将克隆的画布重新赋值\n        clonedObj.canvas = canvas;\n        // 设置位置信息\n        clonedObj.set({\n          left: clonedObj.left + grid,\n          top: clonedObj.top + grid,\n          evented: true,\n          id: uuid(),\n        });\n        clonedObj.forEachObject((obj: fabric.Object) => {\n          obj.id = uuid();\n          canvas.add(obj);\n        });\n        // 解决不可选择问题\n        clonedObj.setCoords();\n        canvas.setActiveObject(clonedObj);\n        canvas.requestRenderAll();\n      });\n    });\n  }\n\n  // 单个对象复制\n  _copyObject(activeObject: fabric.Object) {\n    // 间距设置\n    const grid = 10;\n    const canvas = this.canvas;\n    activeObject?.clone((cloned: fabric.Object) => {\n      if (cloned.left === undefined || cloned.top === undefined) return;\n      canvas.discardActiveObject();\n      // 设置位置信息\n      cloned.set({\n        left: cloned.left + grid,\n        top: cloned.top + grid,\n        evented: true,\n        id: uuid(),\n      });\n      canvas.add(cloned);\n      canvas.setActiveObject(cloned);\n      canvas.requestRenderAll();\n    });\n  }\n\n  // 复制元素\n  clone(paramsActiveObeject: fabric.ActiveSelection | fabric.Object) {\n    const activeObject = paramsActiveObeject || this.canvas.getActiveObject();\n    if (!activeObject) return;\n    if (activeObject?.type === 'activeSelection') {\n      this._copyActiveSelection(activeObject);\n    } else {\n      this._copyObject(activeObject);\n    }\n  }\n\n  // 拆分组\n  unGroup() {\n    const activeObject = this.canvas.getActiveObject() as fabric.Group;\n    if (!activeObject) return;\n    // 先获取当前选中的对象，然后打散\n    activeObject.toActiveSelection();\n    activeObject.getObjects().forEach((item: fabric.Object) => {\n      item.set('id', uuid());\n    });\n    this.canvas.discardActiveObject().renderAll();\n  }\n\n  group() {\n    // 组合元素\n    const activeObj = this.canvas.getActiveObject() as fabric.ActiveSelection;\n    if (!activeObj) return;\n    const activegroup = activeObj.toGroup();\n    const objectsInGroup = activegroup.getObjects();\n    activegroup.clone((newgroup: fabric.Group) => {\n      newgroup.set('id', uuid());\n      this.canvas.remove(activegroup);\n      objectsInGroup.forEach((object) => {\n        this.canvas.remove(object);\n      });\n      this.canvas.add(newgroup);\n      this.canvas.setActiveObject(newgroup);\n    });\n  }\n\n  getWorkspace() {\n    return this.canvas.getObjects().find((item) => item.id === 'workspace');\n  }\n\n  workspaceSendToBack() {\n    const workspace = this.getWorkspace();\n    workspace && workspace.sendToBack();\n  }\n\n  getJson() {\n    return this.canvas.toJSON(\n      ['id', 'gradientAngle', 'selectable', 'hasControls', 'sourceSrc', 'rawScaleX',\n        'rawScaleY', 'rectDiffLeft', 'rectDiffTop', 'prevWidth', 'prevHeight', 'cloneObject'\n      ]);\n  }\n\n  /**\n   * @description: 拖拽添加到画布\n   * @param {Event} event\n   * @param {Object} item\n   */\n  dragAddItem(event: DragEvent, item: fabric.Object) {\n    const {left, top} = this.canvas.getSelectionElement().getBoundingClientRect();\n    if (event.x < left || event.y < top || item.width === undefined) return;\n\n    const point = {\n      x: event.x - left,\n      y: event.y - top,\n    };\n    const pointerVpt = this.canvas.restorePointerVpt(point);\n    item.left = pointerVpt.x - item.width / 2;\n    item.top = pointerVpt.y;\n    this.canvas.add(item);\n    this.canvas.requestRenderAll();\n  }\n}\n\nexport default Editor;\n","// @ts-nocheck\nimport { fabric } from 'fabric';\n\ndeclare interface VerticalLine {\n  x: number;\n  y1: number;\n  y2: number;\n}\n\ndeclare interface HorizontalLine {\n  x1: number;\n  x2: number;\n  y: number;\n}\n\nfunction initAligningGuidelines(canvas: fabric.Canvas) {\n  let disabled = false\n  const ctx = canvas.getSelectionContext();\n  const aligningLineOffset = 5;\n  const aligningLineMargin = 4;\n  const aligningLineWidth = 1;\n  const aligningLineColor = 'rgb(0,255,0)';\n  let viewportTransform: number[] | undefined;\n  let zoom = 1;\n\n  function drawVerticalLine(coords: VerticalLine) {\n    drawLine(\n      coords.x + 0.5,\n      coords.y1 > coords.y2 ? coords.y2 : coords.y1,\n      coords.x + 0.5,\n      coords.y2 > coords.y1 ? coords.y2 : coords.y1\n    );\n  }\n\n  function drawHorizontalLine(coords: HorizontalLine) {\n    drawLine(\n      coords.x1 > coords.x2 ? coords.x2 : coords.x1,\n      coords.y + 0.5,\n      coords.x2 > coords.x1 ? coords.x2 : coords.x1,\n      coords.y + 0.5\n    );\n  }\n\n  function drawLine(x1: number, y1: number, x2: number, y2: number) {\n    if (viewportTransform == null || disabled) return;\n\n    ctx.save();\n    ctx.lineWidth = aligningLineWidth;\n    ctx.strokeStyle = aligningLineColor;\n    ctx.beginPath();\n    ctx.moveTo(x1 * zoom + viewportTransform[4], y1 * zoom + viewportTransform[5]);\n    ctx.lineTo(x2 * zoom + viewportTransform[4], y2 * zoom + viewportTransform[5]);\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  function isInRange(value1: number, value2: number) {\n    value1 = Math.round(value1);\n    value2 = Math.round(value2);\n    for (let i = value1 - aligningLineMargin, len = value1 + aligningLineMargin; i <= len; i++) {\n      if (i === value2) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  const verticalLines: VerticalLine[] = [];\n  const horizontalLines: HorizontalLine[] = [];\n\n  canvas.on('mouse:down', () => {\n    viewportTransform = canvas.viewportTransform;\n    zoom = canvas.getZoom();\n  });\n\n  canvas.on('object:moving', (e) => {\n    if (viewportTransform === undefined || e.target === undefined) return;\n\n    const activeObject = e.target;\n    const canvasObjects = canvas.getObjects();\n    const activeObjectCenter = activeObject.getCenterPoint();\n    const activeObjectLeft = activeObjectCenter.x;\n    const activeObjectTop = activeObjectCenter.y;\n    const activeObjectBoundingRect = activeObject.getBoundingRect();\n    const activeObjectHeight = activeObjectBoundingRect.height / viewportTransform[3];\n    const activeObjectWidth = activeObjectBoundingRect.width / viewportTransform[0];\n    let horizontalInTheRange = false;\n    let verticalInTheRange = false;\n    const transform = canvas._currentTransform;\n\n    if (!transform) return;\n\n    // It should be trivial to DRY this up by encapsulating (repeating) creation of x1, x2, y1, and y2 into functions,\n    // but we're not doing it here for perf. reasons -- as this a function that's invoked on every mouse move\n\n    for (let i = canvasObjects.length; i--;) {\n      // eslint-disable-next-line no-continue\n      if (canvasObjects[i] === activeObject) continue;\n\n      // 排除辅助线\n      if (\n        activeObject instanceof fabric.GuideLine &&\n        canvasObjects[i] instanceof fabric.GuideLine\n      ) {\n        continue;\n      }\n\n      const objectCenter = canvasObjects[i].getCenterPoint();\n      const objectLeft = objectCenter.x;\n      const objectTop = objectCenter.y;\n      const objectBoundingRect = canvasObjects[i].getBoundingRect();\n      const objectHeight = objectBoundingRect.height / viewportTransform[3];\n      const objectWidth = objectBoundingRect.width / viewportTransform[0];\n\n      // snap by the horizontal center line\n      if (isInRange(objectLeft, activeObjectLeft)) {\n        verticalInTheRange = true;\n        verticalLines.push({\n          x: objectLeft,\n          y1:\n            objectTop < activeObjectTop\n              ? objectTop - objectHeight / 2 - aligningLineOffset\n              : objectTop + objectHeight / 2 + aligningLineOffset,\n          y2:\n            activeObjectTop > objectTop\n              ? activeObjectTop + activeObjectHeight / 2 + aligningLineOffset\n              : activeObjectTop - activeObjectHeight / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(objectLeft, activeObjectTop),\n          'center',\n          'center'\n        );\n      }\n\n      // snap by the left edge\n      if (isInRange(objectLeft - objectWidth / 2, activeObjectLeft - activeObjectWidth / 2)) {\n        verticalInTheRange = true;\n        verticalLines.push({\n          x: objectLeft - objectWidth / 2,\n          y1:\n            objectTop < activeObjectTop\n              ? objectTop - objectHeight / 2 - aligningLineOffset\n              : objectTop + objectHeight / 2 + aligningLineOffset,\n          y2:\n            activeObjectTop > objectTop\n              ? activeObjectTop + activeObjectHeight / 2 + aligningLineOffset\n              : activeObjectTop - activeObjectHeight / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(objectLeft - objectWidth / 2 + activeObjectWidth / 2, activeObjectTop),\n          'center',\n          'center'\n        );\n      }\n\n      // snap by the right edge\n      if (isInRange(objectLeft + objectWidth / 2, activeObjectLeft + activeObjectWidth / 2)) {\n        verticalInTheRange = true;\n        verticalLines.push({\n          x: objectLeft + objectWidth / 2,\n          y1:\n            objectTop < activeObjectTop\n              ? objectTop - objectHeight / 2 - aligningLineOffset\n              : objectTop + objectHeight / 2 + aligningLineOffset,\n          y2:\n            activeObjectTop > objectTop\n              ? activeObjectTop + activeObjectHeight / 2 + aligningLineOffset\n              : activeObjectTop - activeObjectHeight / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(objectLeft + objectWidth / 2 - activeObjectWidth / 2, activeObjectTop),\n          'center',\n          'center'\n        );\n      }\n\n      // snap by the vertical center line\n      if (isInRange(objectTop, activeObjectTop)) {\n        horizontalInTheRange = true;\n        horizontalLines.push({\n          y: objectTop,\n          x1:\n            objectLeft < activeObjectLeft\n              ? objectLeft - objectWidth / 2 - aligningLineOffset\n              : objectLeft + objectWidth / 2 + aligningLineOffset,\n          x2:\n            activeObjectLeft > objectLeft\n              ? activeObjectLeft + activeObjectWidth / 2 + aligningLineOffset\n              : activeObjectLeft - activeObjectWidth / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(activeObjectLeft, objectTop),\n          'center',\n          'center'\n        );\n      }\n\n      // snap by the top edge\n      if (isInRange(objectTop - objectHeight / 2, activeObjectTop - activeObjectHeight / 2)) {\n        horizontalInTheRange = true;\n        horizontalLines.push({\n          y: objectTop - objectHeight / 2,\n          x1:\n            objectLeft < activeObjectLeft\n              ? objectLeft - objectWidth / 2 - aligningLineOffset\n              : objectLeft + objectWidth / 2 + aligningLineOffset,\n          x2:\n            activeObjectLeft > objectLeft\n              ? activeObjectLeft + activeObjectWidth / 2 + aligningLineOffset\n              : activeObjectLeft - activeObjectWidth / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(activeObjectLeft, objectTop - objectHeight / 2 + activeObjectHeight / 2),\n          'center',\n          'center'\n        );\n      }\n\n      // snap by the bottom edge\n      if (isInRange(objectTop + objectHeight / 2, activeObjectTop + activeObjectHeight / 2)) {\n        horizontalInTheRange = true;\n        horizontalLines.push({\n          y: objectTop + objectHeight / 2,\n          x1:\n            objectLeft < activeObjectLeft\n              ? objectLeft - objectWidth / 2 - aligningLineOffset\n              : objectLeft + objectWidth / 2 + aligningLineOffset,\n          x2:\n            activeObjectLeft > objectLeft\n              ? activeObjectLeft + activeObjectWidth / 2 + aligningLineOffset\n              : activeObjectLeft - activeObjectWidth / 2 - aligningLineOffset,\n        });\n        activeObject.setPositionByOrigin(\n          new fabric.Point(activeObjectLeft, objectTop + objectHeight / 2 - activeObjectHeight / 2),\n          'center',\n          'center'\n        );\n      }\n    }\n\n    if (!horizontalInTheRange) {\n      horizontalLines.length = 0;\n    }\n\n    if (!verticalInTheRange) {\n      verticalLines.length = 0;\n    }\n  });\n\n  canvas.on('before:render', () => {\n    // fix 保存图片时报错\n    try {\n      canvas.clearContext(canvas.contextTop);\n    } catch (error) {\n      console.log(error);\n    }\n  });\n\n  canvas.on('after:render', () => {\n    for (let i = verticalLines.length; i--;) {\n      drawVerticalLine(verticalLines[i]);\n    }\n    for (let j = horizontalLines.length; j--;) {\n      drawHorizontalLine(horizontalLines[j]);\n    }\n\n    // noinspection NestedAssignmentJS\n    verticalLines.length = 0;\n    horizontalLines.length = 0;\n  });\n\n  canvas.on('mouse:up', () => {\n    verticalLines.length = 0;\n    horizontalLines.length = 0;\n    canvas.renderAll();\n  });\n\n  return {\n    disable: () => disabled = true,\n    enable: () => disabled = false\n  }\n}\n\nexport default initAligningGuidelines;\n","import hotkeys from 'hotkeys-js';\nimport type { fabric } from 'fabric';\nimport { KeyNames } from '../utils/hotEventKeys';\n\n\nfunction initHotkeys(canvas: fabric.Canvas) {\n\n  // 移动快捷键\n  hotkeys(KeyNames.lrdu, (_event, handler) => {\n    const activeObject = canvas.getActiveObject();\n    if (!activeObject) return;\n    switch (handler.key) {\n      case 'left':\n        if (activeObject.left === undefined) return;\n        activeObject.set('left', activeObject.left - 1);\n        break;\n      case 'right':\n        if (activeObject.left === undefined) return;\n        activeObject.set('left', activeObject.left + 1);\n        break;\n      case 'down':\n        if (activeObject.top === undefined) return;\n        activeObject.set('top', activeObject.top + 1);\n        break;\n      case 'up':\n        if (activeObject.top === undefined) return;\n        activeObject.set('top', activeObject.top - 1);\n        break;\n      default:\n    }\n    canvas.renderAll();\n  });\n\n  // 移动快捷键\n  hotkeys(KeyNames.shiftMove, (_event, handler) => {\n    const activeObject = canvas.getActiveObject();\n    if (!activeObject) return;\n    switch (handler.key) {\n      case 'shift+left':\n        if (activeObject.left === undefined) return;\n        activeObject.set('left', activeObject.left - 10);\n        break;\n      case 'shift+right':\n        if (activeObject.left === undefined) return;\n        activeObject.set('left', activeObject.left + 10);\n        break;\n      case 'shift+down':\n        if (activeObject.top === undefined) return;\n        activeObject.set('top', activeObject.top + 10);\n        break;\n      case 'shift+up':\n        if (activeObject.top === undefined) return;\n        activeObject.set('top', activeObject.top - 10);\n        break;\n      default:\n    }\n    canvas.renderAll();\n  });\n\n}\n\nexport default initHotkeys;\nexport { hotkeys };\n","import React, { FC, createContext, useState } from 'react'\nimport { fabric } from 'fabric'\nimport Editor from '../../core';\nimport EditorWorkspace from '../../core/EditorWorkspace';\n\nconst noop = () => {\n}\n\ninterface CanvasContext {\n  canvas: fabric.Canvas | null\n  editor: Editor | null\n  workSpace: EditorWorkspace | null\n  drawMode: string,\n  setDrawMode: (value: string) => void\n  setCanvas: (canvas: fabric.Canvas) => void\n  setEditor: (value: Editor) => void\n  setWorkSpace: (value: EditorWorkspace) => void\n  selectMode: string\n  setSelectMode: (value: string) => void\n  selectIds: Array<string>\n  setSelectIds: (value: Array<string>) => void\n  selectOneType: string\n  setSelectOneType: (value: string) => void\n  selectActive: Array<string>\n  setSelectActive: (value: Array<string>) => void\n  show: boolean\n  setShow: (value: boolean) => void\n  mainUrl: string | undefined\n  setMainUrl: (value: string | undefined) => void\n  isClipImage: boolean\n  setIsClipImage: (value: boolean) => void\n  clipRawIndex: any\n  setClipRawIndex: (value: any) => void\n  clipImageId: any\n  setClipImageId: (value: any) => void\n\n}\n\nexport const Context = createContext<CanvasContext>({\n  editor: null, // canvas编辑器实例\n  canvas: null, // fabric canvas实例\n  workSpace: null, // 白色画布实例\n  drawMode: '', // default 默认模式 move拖拽模式\n  selectMode: '',\n  selectIds: [],\n  selectOneType: '',\n  selectActive: [],\n  show: false,\n  mainUrl: '',\n  isClipImage: false,\n  clipRawIndex: null,\n  clipImageId: null,\n  setClipRawIndex: noop,\n  setClipImageId: noop,\n  setIsClipImage: noop,\n  setMainUrl: noop,\n  setSelectOneType: noop,\n  setSelectActive: noop,\n  setSelectMode: noop,\n  setSelectIds: noop,\n  setDrawMode: noop,\n  setCanvas: noop,\n  setEditor: noop,\n  setWorkSpace: noop,\n  setShow: noop\n})\n\nexport const CanvasProvider: FC = ({children}) => {\n  const [canvas, setCanvas] = useState<fabric.Canvas | null>(null)\n  const [editor, setEditor] = useState<Editor | null>(null)\n  const [workSpace, setWorkSpace] = useState<EditorWorkspace | null>(null)\n  const [drawMode, setDrawMode] = useState<string>('default')\n  const [selectMode, setSelectMode] = useState('')\n  const [selectIds, setSelectIds] = useState([])\n  const [selectOneType, setSelectOneType] = useState('')\n  const [selectActive, setSelectActive] = useState([])\n  const [show, setShow] = useState(false)\n  const [mainUrl, setMainUrl] = useState('')\n  const [isClipImage, setIsClipImage] = useState(false)\n  const [clipImageId, setClipImageId] = useState(null)\n  const [clipRawIndex, setClipRawIndex] = useState(null)\n  const context = {\n    canvas,\n    editor,\n    workSpace,\n    drawMode,\n    selectMode,\n    setSelectMode,\n    selectIds,\n    setSelectIds,\n    selectOneType,\n    setSelectOneType,\n    selectActive,\n    setSelectActive,\n    setDrawMode,\n    setWorkSpace,\n    setCanvas,\n    setEditor,\n    show,\n    setShow,\n    mainUrl,\n    setMainUrl,\n    isClipImage,\n    setIsClipImage,\n    clipImageId,\n    setClipImageId,\n    clipRawIndex,\n    setClipRawIndex\n  }\n\n  // @ts-ignore\n  return <Context.Provider value={context}>{children}</Context.Provider>\n}\n","import React from 'react'\nimport style from './index.module.scss'\n\ninterface InputProps {\n  title: string\n  afterText?: string | React.ReactElement\n  value: string | number\n  onChange: (e: { target: { value: string } }) => void\n}\n\nconst Input: React.FC<InputProps> = (props) => {\n  const {title, afterText, value, onChange} = props;\n  return (\n    <div className={style.customInput}>\n      <div className={style.title}>{title}</div>\n      <div className={style.inputWrap}>\n        <input onChange={onChange} value={value} type=\"text\"/>\n        {afterText ?\n          React.isValidElement(afterText) ?\n            afterText :\n            <span>{afterText}</span> : ''}\n      </div>\n    </div>\n  )\n}\n\nexport default Input\n","import { useContext } from 'react';\nimport { Context } from '../CanvasContext';\n\nconst useAttr = () => {\n  const {canvas} = useContext(Context)\n  /**\n   * 获取已选中的元素\n   */\n  const getActiveObject = () => {\n    if (!canvas) return\n    const activeObject = canvas?.getActiveObject()\n    if (!activeObject) return\n    return activeObject\n  }\n  /**\n   * 设置属性\n   * @param attr\n   */\n  const setAttr = (attr: any) => {\n    if (!canvas) return\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    activeObject.set(attr)\n    canvas.renderAll()\n  }\n  return {\n    getActiveObject,\n    setAttr\n  }\n}\n\nexport default useAttr\n","import useAttr from './useAttr';\nimport { useCallback, useContext } from 'react';\nimport { Context } from '../CanvasContext';\nimport { fabric } from 'fabric';\n\nconst lockAttrs = [\n  'lockMovementX',\n  'lockMovementY',\n  'lockRotation',\n  'lockScalingX',\n  'lockScalingY',\n];\n\n/**\n * 检测fabric对象是否隐藏了X Y缩放\n * @param object\n */\nexport const isControlsInRatioVisible = (object: fabric.Object) => {\n  const controls = object._controlsVisibility\n  return !!(controls && !controls.mb && !controls.ml && !controls.mr && !controls.mt)\n}\n\nconst useLock = () => {\n  const {canvas} = useContext(Context)\n  const {getActiveObject} = useAttr()\n\n  /**\n   * 锁定全部操作 或 解锁全部操作\n   */\n  const changeOwnLock = useCallback((isLock: boolean, object?: fabric.Object) => {\n    let activeObject: null | undefined | fabric.Object = null\n    if (object) {\n      activeObject = object\n    } else {\n      activeObject = getActiveObject()\n    }\n    if (!activeObject) return\n    activeObject.hasControls = isLock\n    lockAttrs.forEach((key) => {\n      (activeObject as fabric.Object)[key] = !isLock\n    });\n    activeObject.selectable = isLock\n    canvas?.renderAll()\n  }, [canvas, getActiveObject])\n\n  /**\n   * 按比例锁定 或 解锁\n   */\n  const changeInRatioLock = useCallback((isLock: boolean, object?: fabric.Object) => {\n    let activeObject: null | undefined | fabric.Object = null\n    if (object) {\n      activeObject = object\n    } else {\n      activeObject = getActiveObject()\n    }\n    if (!activeObject) return\n    activeObject.setControlsVisibility({\n      mt: isLock, // 控制上中点的缩放控件可见性\n      mb: isLock, // 控制下中点的缩放控件可见性\n      ml: isLock, // 控制左中点的缩放控件可见性\n      mr: isLock, // 控制右中点的缩放控件可见性\n    })\n    canvas?.renderAll()\n  }, [canvas, getActiveObject])\n  return {\n    changeOwnLock,\n    changeInRatioLock\n  }\n}\n\nexport default useLock\n","/**\n * 加减乘除\n * 为了实现常用数字加减乘除的精准运算，下列封装了函数，主要思路是，先将小数点右移，\n * 将算式两边的数变成整数再进行运算，得到运算结果后，再将小数点左移回去。\n */\n\nexport function add(num1: number, num2: number) {\n  const num1Digits = (num1.toString().split('.')[1] || '').length\n  const num2Digits = (num2.toString().split('.')[1] || '').length\n  const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits))\n  return (multiply(num1, baseNum) + multiply(num2, baseNum)) / baseNum\n}\n\nexport function subtract(num1: number, num2: number) {\n  const num1Digits = (num1.toString().split('.')[1] || '').length\n  const num2Digits = (num2.toString().split('.')[1] || '').length\n  const baseNum = Math.pow(10, Math.max(num1Digits, num2Digits))\n  return (multiply(num1, baseNum) - multiply(num2, baseNum)) / baseNum\n}\n\nexport function multiply(num1: number, num2: number) {\n  const num1String = num1.toString()\n  const num2String = num2.toString()\n  const num1Digits = (num1String.split('.')[1] || '').length\n  const num2Digits = (num2String.split('.')[1] || '').length\n  const baseNum = Math.pow(10, num1Digits + num2Digits)\n  return Number(num1String.replace('.', '')) * Number(num2String.replace('.', '')) / baseNum\n}\n\nexport function divide(num1: number, num2: number) {\n  const num1String = num1.toString()\n  const num2String = num2.toString()\n  const num1Digits = (num1String.split('.')[1] || '').length\n  const num2Digits = (num2String.split('.')[1] || '').length\n  const baseNum = Math.pow(10, num1Digits + num2Digits)\n  const n1 = multiply(num1, baseNum)\n  const n2 = multiply(num2, baseNum)\n  return Number(n1) / Number(n2)\n}\n\nexport function floatRound(num: number, len = 0) {\n  const n = divide(Math.round(multiply(num, Math.pow(10, len))), Math.pow(10, len))\n  return n.toFixed(len)\n}\n\n","// @ts-nocheck\nimport React, { useContext, useEffect, useState } from 'react'\nimport style from './index.module.scss'\nimport Input from '../../../../Input'\nimport { retainNumber } from '../../../../../../utils/utils'\nimport { fabric } from 'fabric';\nimport { Context } from '../../../../../Draw'\nimport useLock, { isControlsInRatioVisible } from '../../../../../Draw/hooks/useLock'\nimport { floatRound } from '../../../../../../utils/calculate';\n\n\ninterface SizeProps {\n  getActiveObject?: () => fabric.Object\n  isWorkSpace?: boolean\n  showRation?: boolean\n}\n\nconst Size: React.FC<SizeProps> = ({getActiveObject, showRation, isWorkSpace}) => {\n  const {canvas, workSpace} = useContext(Context)\n  const {changeInRatioLock} = useLock()\n  const [width, setWidth] = useState('')\n  const [height, setHeight] = useState('')\n  const [lockRatio, setLockRatio] = useState(false)\n\n  useEffect(() => {\n    getAttr()\n  }, [canvas, getActiveObject])\n\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on('object:modified', getAttr)\n    return () => {\n      canvas.off('object:modified', getAttr)\n    }\n  }, [canvas])\n\n  const getAttr = () => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    setWidth(floatRound(activeObject.width))\n    setHeight(floatRound(activeObject.height))\n    setLockRatio(isControlsInRatioVisible(activeObject))\n  }\n  /**\n   * 修改宽\n   * @param value\n   */\n  const onWidthChange = (value) => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    value = retainNumber(value)\n    if (isWorkSpace) {\n      workSpace?.setSize(value, height)\n      setWidth(value)\n      return;\n    }\n    activeObject.set({width: +value})\n    canvas?.renderAll()\n    setWidth(value)\n  }\n  /**\n   * 修改高\n   * @param value\n   */\n  const onHeightChange = (value) => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    value = retainNumber(value)\n    if (isWorkSpace) {\n      workSpace?.setSize(width, value)\n      setHeight(value)\n      return;\n    }\n    activeObject.set({height: +value})\n    canvas?.renderAll()\n    setHeight(value)\n  }\n\n  const changeLock = () => {\n    changeInRatioLock(lockRatio)\n    setLockRatio(prevState => !prevState)\n  }\n  return (\n    <div className={style.size}>\n      <Input\n        afterText='像素'\n        title='宽度'\n        value={width}\n        onChange={e => onWidthChange(e.target.value)}\n      />\n      <Input\n        afterText='像素'\n        title='高度'\n        value={height}\n        onChange={e => onHeightChange(e.target.value)}\n      />\n      {\n        showRation ? <div className={style.ratio}>\n          <div className={style.title}>比例</div>\n          <div className={style.content} onClick={changeLock}>\n            <img\n              src={lockRatio ?\n                \"https://ossprod.jrdaimao.com/file/1690955813239228.svg\" :\n                \"https://ossprod.jrdaimao.com/file/1690425288688481.svg\"}\n              alt=\"\"\n            />\n          </div>\n        </div> : <div className={style.ratio}></div>\n      }\n    </div>\n  )\n}\n\nexport default Size\n","import React, { useContext, useEffect, useState } from 'react'\nimport style from './index.module.scss'\nimport Input from '../../../../Input'\nimport useAttr from '../../../../../Draw/hooks/useAttr';\nimport { Context } from '../../../../../Draw';\nimport { retainNumber } from '../../../../../../utils/utils';\nimport { floatRound } from '../../../../../../utils/calculate';\n\nconst Position = () => {\n  const {canvas} = useContext(Context)\n  const {getActiveObject, setAttr} = useAttr()\n  const [rotate, setRotate] = useState<string | number>('0')\n  const [x, setX] = useState<string | number>(0)\n  const [y, setY] = useState<string | number>(0)\n\n  useEffect(() => {\n    getAttr()\n  }, [canvas])\n\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on('object:modified', getAttr)\n    return () => {\n      canvas.off('object:modified', getAttr)\n    }\n  }, [canvas])\n  const getAttr = () => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    setX(floatRound(activeObject.left || 0))\n    setY(floatRound(activeObject.top || 0))\n    setRotate(floatRound(activeObject.angle || 0))\n  }\n  /**\n   * 修改旋转角度\n   * @param value\n   */\n  const onRotateChange = (value: string) => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    activeObject.rotate(+value)\n    canvas?.renderAll()\n    setRotate(value)\n  }\n  /**\n   * 修改X坐标\n   * @param value\n   */\n  const onPositionXChange = (value: string) => {\n    value = retainNumber(value)\n    setAttr({left: +value})\n    setX(value)\n  }\n  /**\n   * 修改Y坐标\n   * @param value\n   */\n  const onPositionYChange = (value: string) => {\n    value = retainNumber(value)\n    setAttr({top: +value})\n    setY(value)\n  }\n  return (\n    <div className={style.position}>\n      <Input\n        afterText='像素'\n        value={x}\n        onChange={e => onPositionXChange(e.target.value)}\n        title='X'\n      />\n      <Input\n        afterText='像素'\n        value={y}\n        onChange={e => onPositionYChange(e.target.value)}\n        title='Y'\n      />\n      <div className={style.rotate}>\n        <div className={style.title}>旋转</div>\n        <div className={style.content}>\n          <input value={rotate} onChange={e => onRotateChange(retainNumber(e.target.value))} type=\"text\"/>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Position\n","// @ts-nocheck\nimport React, { useContext, useEffect, useState } from 'react'\nimport customInputStyle from '../../../../Input/index.module.scss'\nimport style from './index.module.scss'\nimport useAttr from '../../../../../Draw/hooks/useAttr'\nimport { Context } from '../../../../../Draw'\nimport { retainNumber } from '../../../../../../utils/utils';\nimport { divide, multiply } from '../../../../../../utils/calculate';\n\nconst Transparent = () => {\n  const {canvas} = useContext(Context)\n  const {getActiveObject, setAttr} = useAttr()\n  const [opacity, setOpacity] = useState(0)\n  const [visible, setVisible] = useState(false)\n  useEffect(() => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    setOpacity(multiply(activeObject.opacity, 100))\n    setVisible(activeObject.visible || false)\n  }, [getActiveObject])\n  /**\n   * 透明度修改\n   * @param value\n   */\n  const onOpacityChange = (value: string) => {\n    if (value > 100) {\n      value = 100\n    }\n    value = retainNumber(value)\n    setAttr({opacity: divide(value, 100)})\n    setOpacity(+value)\n  }\n  /**\n   * 翻转\n   * @param value\n   */\n  const onFlipChange = (value: string) => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    // @ts-ignore\n    activeObject.set(`flip${value}`, !activeObject[`flip${value}`]).setCoords();\n    canvas?.renderAll()\n  }\n  /**\n   * 可见性修改\n   */\n  const onVisibleChange = () => {\n    setAttr({visible: !visible})\n    setVisible(prevState => !prevState)\n  }\n  return (\n    <div className={style.transparent}>\n      <div className={customInputStyle.customInput}>\n        <div className={customInputStyle.title}>不透明度</div>\n        <div className={customInputStyle.inputWrap}>\n          <input\n            style={{width: 48}}\n            onChange={e => onOpacityChange(e.target.value)}\n            value={opacity}\n            type=\"text\"\n          />\n          <span>%</span>\n        </div>\n      </div>\n      <div className={style.reverse}>\n        <div className={style.title}>翻转</div>\n        <div className={style.reverseWrap}>\n          <div onClick={() => onFlipChange('X')}>\n            <img src=\"https://ossprod.jrdaimao.com/file/1690428298144872.svg\" alt=\"\"/>\n          </div>\n          <div onClick={() => onFlipChange('Y')}>\n            <img src=\"https://ossprod.jrdaimao.com/file/1690428330458222.svg\" alt=\"\"/>\n          </div>\n        </div>\n      </div>\n      <div className={style.visible}>\n        <div className={style.title}>可见性</div>\n        <div className={style.content} onClick={onVisibleChange}>\n          {\n            visible ?\n              <img src=\"https://ossprod.jrdaimao.com/file/1690428533888278.svg\" alt=\"\"/> :\n              <img src=\"https://ossprod.jrdaimao.com/file/1690883271867109.svg\" alt=\"\"/>\n          }\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Transparent\n","export interface AlignTypeListItem {\n  icon: string\n  activeIcon: string\n  title: string\n  key: string\n}\n\n\nexport const alignTypeList: Array<AlignTypeListItem> = [\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690799178088909.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690802921403421.svg',\n    title: '左对齐',\n    key: 'left'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690429259779371.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690799287561375.svg',\n    title: '顶对齐',\n    key: 'top'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690429281715912.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690799296804215.svg',\n    title: '左右居中对齐',\n    key: 'alignCenter'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690429302732969.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/169079930793443.svg',\n    title: '上下居中对齐',\n    key: 'middleCenter'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690429331770745.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690799316293458.svg',\n    title: '右对齐',\n    key: 'right'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/169042936033629.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690799325119567.svg',\n    title: '底对齐',\n    key: 'bottom'\n  }\n]\n","import React from 'react'\nimport usePageAlign from '../../../../../Draw/hooks/usePageAlign'\nimport { alignTypeList, AlignTypeListItem } from './config'\nimport style from './index.module.scss'\n\nconst PageAlign = () => {\n  const alignFunc = usePageAlign()\n  const onClick = (item: AlignTypeListItem) => {\n    alignFunc[item.key]?.()\n  }\n  return (\n    <div className={style.pageAlign}>\n      <div className={style.title}>页面对齐</div>\n      <div className={style.shareShapeList}>\n        {\n          alignTypeList.map(item => {\n            return <div\n              onClick={() => onClick(item)}\n              key={item.key}\n              className={style.shareShapeListItem}\n            >\n              <img src={item.icon} alt=\"\"/>\n              <img src={item.activeIcon} alt=\"\"/>\n              <span>{item.title}</span>\n            </div>\n          })\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default PageAlign\n","import { useCallback, useContext } from 'react'\nimport { Context } from '../CanvasContext'\nimport { isUndef } from '../../../utils';\n\ntype Pos = { left?: number, top?: number }\n\nconst usePageAlign = () => {\n  const {canvas, workSpace} = useContext(Context)\n  const setPosition = useCallback((value: Pos, target?: any) => {\n    if (!canvas) return\n    let activeObject: any\n    if (target) {\n      activeObject = target\n    } else {\n      activeObject = canvas.getActiveObject()\n    }\n    if (!activeObject) return console.log('no allow activeObject')\n    const {left, top} = value\n    const pos: Pos = {}\n    if (!isUndef(left)) pos.left = left\n    if (!isUndef(top)) pos.top = top\n    activeObject.set(pos)\n    canvas.renderAll()\n  }, [canvas, workSpace])\n  /**\n   * 左对齐\n   */\n  const left = () => {\n    setPosition({left: 0})\n  }\n  /**\n   * 顶对齐\n   */\n  const top = () => {\n    setPosition({top: 0})\n  }\n  /**\n   * 左右居中对齐\n   */\n  const alignCenter = () => {\n    if (!canvas || !workSpace) return\n    const activeObject = canvas.getActiveObject() as any\n    if (!activeObject) return\n    const width = workSpace?.width || 0\n    setPosition({left: (width - activeObject.width * activeObject.scaleX) / 2})\n  }\n  /**\n   * 上下居中对齐\n   */\n  const middleCenter = () => {\n    if (!canvas || !workSpace) return\n    const activeObject = canvas.getActiveObject() as any\n    if (!activeObject) return\n    const height = workSpace?.height || 0\n    setPosition({top: (height - activeObject.height * activeObject.scaleY) / 2})\n  }\n  /**\n   * 右对齐\n   */\n  const right = () => {\n    if (!canvas || !workSpace) return\n    const activeObject = canvas.getActiveObject() as any\n    if (!activeObject) return\n    const width = workSpace?.width || 0\n    setPosition({left: width - activeObject.width * activeObject.scaleX})\n  }\n  /**\n   * 底对齐\n   */\n  const bottom = () => {\n    if (!canvas || !workSpace) return\n    const activeObject = canvas.getActiveObject() as any\n    if (!activeObject) return\n    const height = workSpace?.height || 0\n    setPosition({top: height - activeObject.height * activeObject.scaleY})\n  }\n  return {\n    left, top, alignCenter, middleCenter, right, bottom\n  }\n}\n\nexport default usePageAlign\n","export interface CoverOrderListItem {\n  icon: string\n  activeIcon: string\n  title: string\n  key: string\n}\n\nexport const coverOrderList: Array<CoverOrderListItem> = [\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690802981178203.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690430789758861.svg',\n    title: '上移一层',\n    key: 'up'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690430798470387.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690803025753461.svg',\n    title: '移到顶层',\n    key: 'upTop'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690430807961422.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690803032757409.svg',\n    title: '下移一层',\n    key: 'down'\n  },\n  {\n    icon: 'https://ossprod.jrdaimao.com/file/1690430815475268.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690803040084442.svg',\n    title: '移到底层',\n    key: 'downTop'\n  }\n]\n","import { useCallback, useContext } from 'react'\nimport { Context } from '../CanvasContext'\nimport { fabric } from 'fabric';\n\n/**\n * 修改层级顺序\n */\nconst userOrder = () => {\n  const {canvas, editor} = useContext(Context)\n\n  const changeOrder = useCallback((funcKey: string, object: fabric.Object) => {\n    if (!canvas) return\n    let activeObject: any\n    if (object) {\n      activeObject = object\n    } else {\n      const actives = canvas.getActiveObjects();\n      if (actives && actives.length === 1) {\n        activeObject = canvas.getActiveObjects()[0];\n      }\n    }\n    if (!activeObject) return\n    activeObject && activeObject[funcKey]?.();\n    canvas.renderAll();\n    editor?.workspaceSendToBack()\n  }, [canvas, editor])\n  // 上\n  const up = useCallback((object: fabric.Object) => {\n    changeOrder('bringForward', object)\n  }, [canvas, editor])\n\n  // 上到顶\n  const upTop = useCallback((object: fabric.Object) => {\n    changeOrder('bringToFront', object)\n  }, [canvas, editor])\n\n  // 下\n  const down = useCallback((object: fabric.Object) => {\n    changeOrder('sendBackwards', object)\n  }, [canvas, editor])\n\n  // 下到底\n  const downTop = useCallback((object: fabric.Object) => {\n    changeOrder('sendToBack', object)\n  }, [canvas, editor])\n  return {\n    up, upTop, down, downTop\n  }\n}\n\nexport default userOrder\n","import React from 'react'\nimport pageAlignStyle from '../PageAlign/index.module.scss'\nimport { coverOrderList, CoverOrderListItem } from './config'\nimport userOrder from '../../../../../Draw/hooks/userOrder'\nimport style from './index.module.scss'\n\nconst CoverOrder = () => {\n  const orderFunc = userOrder()\n  const changeCoverOrder = (item: CoverOrderListItem) => {\n    orderFunc[item.key]?.()\n  }\n  return (\n    <div className={style.coverOrder}>\n      <div className={style.coverOrderTitle}>图层顺序</div>\n      <div className={pageAlignStyle.shareShapeList}>\n        {\n          coverOrderList.map(item => {\n            return <div\n              onClick={() => changeCoverOrder(item)}\n              key={item.key}\n              className={pageAlignStyle.shareShapeListItem}\n            >\n              <img src={item.icon} alt=\"\"/>\n              <img src={item.activeIcon} alt=\"\"/>\n              <span>{item.title}</span>\n            </div>\n          })\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default CoverOrder\n","import React from 'react';\n\nexport const DropdownIndicator = () => {\n  return (\n    <img src=\"https://ossprod.jrdaimao.com/file/1690959702767983.svg\" alt=\"\"/>\n  );\n};\n\nexport const ReactSelectStyles: any = {\n  singleValue: (provided: any) => ({\n    ...provided,\n    color: '#ADADB3',\n    fontWeight: 600,\n  }),\n  menuList: (provided: any) => ({\n    ...provided,\n    background: '#1C1D29',\n  }),\n  option: (provided: any) => ({\n    ...provided,\n    background: '#1C1D29',\n    color: '#ADADB3',\n    height: '32px',\n    lineHeight: '32px',\n    padding: '0px 11px',\n    boxSizing: 'border-box',\n    cursor: 'pointer',\n    '&:hover': {\n      color: '#fff',\n      background: '#2C375E'\n    }\n  }),\n  container: (provided: any) => ({\n    ...provided,\n    width: '100%'\n  }),\n  control: () => ({\n    width: '100%',\n    cursor: 'pointer',\n    paddingRight: 8,\n    boxSizing: 'border-box',\n    flex: 1,\n    height: 28,\n    borderRadius: 4,\n    background: '#232634',\n    color: '#ADADB3',\n    fontSize: 14,\n    fontWeight: 600,\n    display: 'flex'\n  }),\n}\n","// @ts-nocheck\nimport React, { useEffect, useRef, useState } from 'react'\nimport styles from './index.module.scss'\nimport { retainNumber } from '../../../utils/utils';\n\ninterface InputNumberProps {\n  value: string | number\n  onChange: (value: string | number) => void\n}\n\nconst InputNumber: React.FC<InputNumberProps> = ({value, onChange: callback}) => {\n  const [number, setNumber] = useState(value)\n  const last = useRef()\n  last.current = number\n  const inputRef = useRef()\n\n  useEffect(() => {\n    setNumber(value)\n  }, [value])\n\n  useEffect(() => {\n    inputRef.current?.addEventListener('keydown', keyDownChange)\n    return () => {\n      inputRef.current?.removeEventListener('keydown', keyDownChange)\n    }\n  }, [value, callback])\n\n  const keyDownChange = (e) => {\n    if (e.key === 'ArrowUp') {\n      add()\n    } else if (e.key === 'ArrowDown') {\n      sub()\n    }\n  }\n  const onNumberChange = (e: { target: { value: string }, preventDefault: () => {} }) => {\n    const value = retainNumber(e.target.value)\n    setNumber(value)\n    callback(value)\n  }\n  const add = () => {\n    const n = +last.current + 1\n    setNumber(n)\n    callback(n)\n  }\n  const sub = () => {\n    if (last.current <= 12) return\n    const n = +last.current - 1\n    setNumber(n)\n    callback(n)\n  }\n  return (\n    <div className={styles.inputNumber}>\n      <input ref={inputRef} value={number} onChange={onNumberChange}/>\n      <span className={styles.control}>\n        <span onClick={add}>\n          <img src=\"https://ossprod.jrdaimao.com/file/1690962892247333.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/1691034645816626.svg\" alt=\"\"/>\n        </span>\n        <span onClick={sub}>\n          <img src=\"https://ossprod.jrdaimao.com/file/1690962924824666.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/1691035025689960.svg\" alt=\"\"/>\n        </span>\n      </span>\n    </div>\n  )\n}\n\nexport default InputNumber\n","export interface TextAlignItem {\n  src: string\n  activeSrc: string\n  key: string\n}\n\nexport const textAlignList: Array<TextAlignItem> = [\n  {\n    src: 'https://ossprod.jrdaimao.com/file/1690963862052534.svg',\n    activeSrc: 'https://ossprod.jrdaimao.com/file/1690963932538814.svg',\n    key: 'left'\n  },\n  {\n    src: 'https://ossprod.jrdaimao.com/file/1690963869720196.svg',\n    activeSrc: 'https://ossprod.jrdaimao.com/file/1690963940992258.svg',\n    key: 'center'\n  },\n  {\n    src: 'https://ossprod.jrdaimao.com/file/1690963877465292.svg',\n    activeSrc: 'https://ossprod.jrdaimao.com/file/1690963948610334.svg',\n    key: 'right'\n  },\n  {\n    src: 'https://ossprod.jrdaimao.com/file/1690963884592828.svg',\n    activeSrc: 'https://ossprod.jrdaimao.com/file/1690963958787177.svg',\n    key: 'justify'\n  }\n]\nexport const textStyleList = [\n  {\n    label: '常规',\n    value: 'normal'\n  },\n  {\n    label: '粗体',\n    value: 600\n  },\n  // {\n  //   label: '细体',\n  //   value: 400\n  // }\n]\n","// @ts-nocheck\nimport { useCallback, useContext, useEffect, useRef, useState } from 'react'\nimport { getFontManage } from '../../../api/text'\nimport useAttr from './useAttr'\nimport FontFaceObserver from 'fontfaceobserver'\nimport { Context } from '../../Editor/Context';\n\n\n// 通用字体，不需要加载字体包\nconst GeneralTextList = ['serif']\n// 缓存已经加载过的字体包名称，有重复的引用无需再次架子啊\nconst Font = new Map()\n// 缓存字体列表\nlet globalFontList = null\n\n/**\n * 过滤出非通用字体\n * @param list\n */\nexport const filterToText = (list: any) => {\n  if (!Array.isArray(list)) return []\n  return list.filter((item: any) => item.type === 'i-text' && !GeneralTextList.includes(item.fontFamily))\n}\n\n\nconst useChangeFontFamily = () => {\n  const {setAttr} = useAttr()\n  const {setLoading} = useContext(Context)\n  const [fontList, setFontList] = useState([])\n  const [fontLoaded, setFontLoaded] = useState(false)\n  const useFontListLast = useRef()\n  useFontListLast.current = fontList\n\n\n  useEffect(() => {\n    // 缓存处理下，不用每次加载\n    (async () => {\n      let list = []\n      if (globalFontList) {\n        list = globalFontList\n      } else {\n        const res = await getFontManage()\n        list = res.map(item => {\n          return {\n            value: item.key,\n            label: item.fontlibName,\n            url: item.fontlibfile\n          }\n        })\n      }\n      setFontLoaded(true)\n      globalFontList = list\n      setFontList(list)\n    })()\n  }, [])\n  /**\n   * 字体修改\n   */\n  const runChange = useCallback((item) => {\n    // 已经加载过不需要重新加载 直接设置字体\n    if (Font.has(item.name)) {\n      setAttr({fontFamily: item.name})\n      return\n    }\n    setLoading(true)\n    const styleContent = `\n     @font-face {\n      font-family: ${item.name};\n      src: url('${item.src}');\n     }`\n    const style = document.createElement('style')\n    style.innerHTML = styleContent\n    document.body.appendChild(style)\n    const font = new FontFaceObserver(item.name);\n    return font.load(item.name, 2000000).then(function () {\n      Font.set(item.name, true)\n      setLoading(false)\n      console.log('Font is available');\n      setAttr({fontFamily: item.name})\n    }, function (e) {\n      setLoading(false)\n      document.body.removeChild(style)\n      console.log('Font is not available', e);\n    });\n  }, [setAttr])\n  /**\n   * 加载多个字体\n   */\n  const loadFont = useCallback((objectsData) => {\n    if (!objectsData) return Promise.resolve()\n    // 拿到需要加载字体包的字体\n    const textList = filterToText(objectsData)\n    let style = ''\n    textList.forEach(item => {\n      useFontListLast.current.forEach(r => {\n        if (item.fontFamily === r.value && !Font.has(r.value)) {\n          style += `@font-face {font-family: ${r.value};src: url('${r.url}');}`\n        }\n      })\n    })\n    if (style === '') return Promise.resolve()\n    // 组装一下font-face，放到body中\n    const el = document.createElement('style')\n    el.innerHTML = style\n    document.body.appendChild(el)\n    // 加载多个字体\n    const fontFamiliesAll = textList.map((item) => {\n      return new Promise((resolve, reject) => {\n        const font = new FontFaceObserver(item.fontFamily);\n        font.load(item.fontFamily, 2000000).then(() => {\n          Font.set(item.fontFamily, true)\n          resolve()\n        }).catch(err => {\n          reject()\n          console.log('loadFont', err)\n        })\n      })\n    });\n    return Promise.all(fontFamiliesAll);\n  }, [fontList, fontLoaded])\n\n\n  return {\n    fontList,\n    runChange,\n    loadFont,\n    fontLoaded\n  }\n}\n\nexport default useChangeFontFamily\n","export const getFontManage = () => {\n  return Promise.resolve([\n    {\n      \"id\": 1,\n      \"fontlibName\": \"雨落南泥行楷\",\n      \"key\": \"ylnnxk\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1684482933910660.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1684482969861534.jpg\",\n      \"operator\": \"\",\n      \"createdAt\": \"2023-05-19T07:56:12.000Z\",\n      \"updatedAt\": \"2023-05-19T07:56:12.000Z\"\n    },\n    {\n      \"id\": 2,\n      \"fontlibName\": \"汉仪孙尚香繁体\",\n      \"key\": \"hyssxft\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/168448426103890.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1684484313329597.jpg\",\n      \"operator\": \"\",\n      \"createdAt\": \"2023-05-19T08:18:35.000Z\",\n      \"updatedAt\": \"2023-05-19T08:18:35.000Z\"\n    },\n    {\n      \"id\": 3,\n      \"fontlibName\": \"DINBLACK\",\n      \"key\": \"dinblack\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1684926716437711.otf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1684926724428125.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-24T11:12:15.000Z\",\n      \"updatedAt\": \"2023-05-24T11:12:15.000Z\"\n    },\n    {\n      \"id\": 4,\n      \"fontlibName\": \"Bebas-Regular\",\n      \"key\": \"bebasRegular\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1684932496362386.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1684932519267667.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-24T12:48:43.000Z\",\n      \"updatedAt\": \"2023-05-24T12:48:43.000Z\"\n    },\n    {\n      \"id\": 6,\n      \"fontlibName\": \"汉仪小松激浪体\",\n      \"key\": \"hyxsjl\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1685001304598186.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1685001311019992.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-25T07:55:34.000Z\",\n      \"updatedAt\": \"2023-05-30T08:58:25.000Z\"\n    },\n    {\n      \"id\": 13,\n      \"fontlibName\": \"叶子\",\n      \"key\": \"yezi\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/168543899068477.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1685438995766786.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-30T09:30:14.000Z\",\n      \"updatedAt\": \"2023-05-30T09:30:14.000Z\"\n    },\n    {\n      \"id\": 14,\n      \"fontlibName\": \"Aa马克\",\n      \"key\": \"aamk\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1685439688863813.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1685439704617823.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-30T09:41:46.000Z\",\n      \"updatedAt\": \"2023-05-30T09:41:46.000Z\"\n    },\n    {\n      \"id\": 15,\n      \"fontlibName\": \"Egosta\",\n      \"key\": \"egosta\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1685439871684955.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1685439875954916.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-30T09:44:45.000Z\",\n      \"updatedAt\": \"2023-05-30T09:44:45.000Z\"\n    },\n    {\n      \"id\": 16,\n      \"fontlibName\": \"汉仪永字七巧板\",\n      \"key\": \"hyyzqqb\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1685440650813535.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1685440825332319.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-05-30T10:00:28.000Z\",\n      \"updatedAt\": \"2023-05-30T10:00:28.000Z\"\n    },\n    {\n      \"id\": 17,\n      \"fontlibName\": \"阿里妈妈数黑体\",\n      \"key\": \"alimamasht\",\n      \"fontlibfile\": \"https://osstest.jrdaimao.com/file/1688626758184870.ttf\",\n      \"fontImgUrl\": \"https://osstest.jrdaimao.com/file/1688626774033978.jpg\",\n      \"operator\": \"管理员\",\n      \"createdAt\": \"2023-07-06T06:59:37.000Z\",\n      \"updatedAt\": \"2023-07-06T06:59:37.000Z\"\n    }\n  ])\n}\n","// @ts-nocheck\nimport React, { useEffect, useState } from 'react'\nimport style from './index.module.scss'\nimport Select from 'react-select'\nimport { ReactSelectStyles, DropdownIndicator } from '../../../../Select'\nimport InputNumber from '../../../../InputNumber'\nimport { textAlignList, textStyleList } from './config'\nimport useAttr from '../../../../../Draw/hooks/useAttr'\nimport { SketchPicker } from 'react-color'\nimport useChangeFontFamily from '../../../../../Draw/hooks/useChangeFontFamily'\n\nconst ColorPicker: any = SketchPicker\n\n\nconst TextAttr = () => {\n  const {getActiveObject, setAttr} = useAttr()\n  const {fontList, runChange} = useChangeFontFamily()\n  const [fontSize, setFontSize] = useState('12')\n  const [color, setColor] = useState('#000000')\n  const [visible, setVisible] = useState(false)\n  const [fontWeight, setFontWeight] = useState(false)\n  const [underline, setUnderline] = useState(false)\n  const [incline, setIncline] = useState(false)\n  const [align, setAlign] = useState('')\n  const [fontStyle, setFontStyle] = useState<any>(null)\n  const [fontFamily, setFontFamily] = useState(null)\n\n  useEffect(() => {\n    // 回显一些属性\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    setFontSize(activeObject.get('fontSize'))\n    setColor(activeObject.get('fill'))\n    setUnderline(activeObject.get('underline'))\n    setAlign(activeObject.get('textAlign'))\n    setIncline(activeObject.get('fontStyle') === 'italic')\n    const fontWeight = activeObject.get('fontWeight')\n    const isWeight = fontWeight === 'bold' || fontWeight > 500\n\n    setFontWeight(isWeight)\n    setFontStyle(isWeight ? textStyleList[1] : textStyleList[0])\n  }, [getActiveObject, fontList])\n\n  useEffect(() => {\n    const activeObject = getActiveObject()\n    if (!activeObject) return\n    const fontFamily = activeObject.get('fontFamily')\n    setFontFamily(fontList.find(item => item.value === fontFamily))\n  }, [getActiveObject, fontList])\n\n  useEffect(() => {\n    const el = document.querySelector('#attr-content')\n    if (!el) return\n    if (visible) {\n      el.style.overflow = 'inherit'\n    } else {\n      el.style.overflow = 'auto'\n    }\n    return () => {\n      el.style.overflow = 'auto'\n    }\n  }, [visible])\n  /**\n   * 修改字体大小\n   * @param e\n   */\n  const onFontSizeChange = e => {\n    setAttr({fontSize: +e})\n    setFontSize(e)\n  }\n\n  /**\n   * 颜色\n   * @param e\n   */\n  const onChangeComplete = e => {\n    setAttr({fill: e.hex})\n    setColor(e.hex)\n  }\n  /**\n   * 加粗\n   */\n  const onWeightChange = () => {\n    if (fontWeight) {\n      setAttr({fontWeight: 'normal'})\n    } else {\n      setAttr({fontWeight: 'bold'})\n    }\n    setFontWeight(prevState => !prevState)\n  }\n\n  /**\n   * 下划线\n   */\n  const onUnderlineChange = () => {\n    setAttr({underline: !underline})\n    setUnderline(prevState => !prevState)\n  }\n\n  /**\n   * 对齐方式\n   * @param item\n   */\n  const onAlignChange = item => {\n    setAttr({textAlign: item.key})\n    setAlign(item.key)\n  }\n\n  /**\n   * 倾斜\n   */\n  const onInclineChange = () => {\n    if (incline) {\n      setAttr({fontStyle: 'normal'})\n    } else {\n      setAttr({fontStyle: 'italic'})\n    }\n    setIncline(prevState => !prevState)\n  }\n  const onFontStyleChange = item => {\n    setFontStyle(item)\n    setAttr({fontWeight: item.value})\n  }\n  /**\n   * 修改字体\n   * @param item\n   */\n  const onChangeFontFamily = item => {\n    runChange({\n      src: item.url,\n      name: item.value\n    })\n  }\n\n  return (\n    <div className={style.textArea}>\n      <div className={style.title}>文字</div>\n      <div className={style.textAreaContent}>\n        <div className={style.fontFamily}>\n          <Select\n            placeholder='请选择字体'\n            onChange={onChangeFontFamily}\n            components={{DropdownIndicator}}\n            className={style.select}\n            styles={ReactSelectStyles}\n            isSearchable={false}\n            options={fontList}\n            value={fontFamily}\n          />\n          <div className={style.size}>\n            <InputNumber\n              value={fontSize}\n              onChange={onFontSizeChange}\n            />\n          </div>\n        </div>\n        <div className={style.color}>\n          <Select\n            isDisabled\n            onChange={onFontStyleChange}\n            value={fontStyle}\n            components={{DropdownIndicator}}\n            className={`${style.select} ${style.disabledSelect}`}\n            styles={ReactSelectStyles}\n            isSearchable={false}\n            options={textStyleList}\n          />\n          <div className={style.colorContent} onClick={() => setVisible(prevState => !prevState)}>\n            <div style={{background: color}}></div>\n            <span>{color}</span>\n          </div>\n        </div>\n        <div className={style.style}>\n          <div className={style.alignGroup}>\n            {\n              textAlignList.map(item => {\n                return <div\n                  className={item.key === align ? style.alignGroupActive : ''}\n                  onClick={() => onAlignChange(item)}\n                  key={item.key}\n                >\n                  <img src={item.src} alt=\"\"/>\n                  <img src={item.activeSrc} alt=\"\"/>\n                </div>\n              })\n            }\n          </div>\n          <div className={style.styleGroup}>\n            <div onClick={onWeightChange}>\n              <div className={fontWeight ? style.styleGroupActive : ''}>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690964441564257.svg\" alt=\"\"/>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690964450733564.svg\" alt=\"\"/>\n              </div>\n            </div>\n            <div onClick={onInclineChange}>\n              <div className={incline ? style.styleGroupActive : ''}>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690971550502930.svg\" alt=\"\"/>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690971566471578.svg\" alt=\"\"/>\n              </div>\n            </div>\n            {/*行间距，字间距，做不完了，下回再说*/}\n            {/*<div style={{cursor: 'not-allowed'}}>*/}\n            {/*  <div>*/}\n            {/*    <img src=\"https://ossprod.jrdaimao.com/file/1690964468758155.svg\" alt=\"\"/>*/}\n            {/*    <img src=\"https://ossprod.jrdaimao.com/file/1690964475042947.svg\" alt=\"\"/>*/}\n            {/*  </div>*/}\n            {/*</div>*/}\n            <div onClick={onUnderlineChange}>\n              <div className={underline ? style.styleGroupActive : ''}>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690964614214969.svg\" alt=\"\"/>\n                <img src=\"https://ossprod.jrdaimao.com/file/1690964622200366.svg\" alt=\"\"/>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      {\n        visible ? <div className={style.fixColorPicker}>\n          <ColorPicker\n            className={style.colorPicker}\n            onChangeComplete={onChangeComplete}\n            color={color}\n          />\n        </div> : null\n      }\n    </div>\n  )\n}\n\nexport default TextAttr\n","import ImageSpaceAttr from '../Components/Attr/ImageSpaceAttr'\nimport TextSpaceAttr from '../Components/Attr/TextSpaceAttr';\n\nexport interface AttrTabListItem {\n  title: string\n  key: string\n  bg: string\n}\n\nexport const attrTabList: Array<AttrTabListItem> = [\n  {\n    title: '属性',\n    key: 'Attr',\n    bg: 'https://ossprod.jrdaimao.com/file/1690510922616482.svg'\n  },\n  {\n    title: '图层',\n    key: 'coverage',\n    bg: 'https://ossprod.jrdaimao.com/file/1690511949701720.svg'\n  }\n]\nexport const attrAreaComponent = {\n  'image': ImageSpaceAttr,\n  'i-text': TextSpaceAttr\n}\nexport const DefaultKey = 'Attr'\n","// @ts-nocheck\nimport React, { useEffect, useState } from 'react';\nimport Size from '../Components/Size'\nimport style from '../WorkSpaceAttr/index.module.scss'\nimport Position from '../Components/Pos'\nimport Transparent from '../Components/Trans'\nimport PageAlign from '../Components/PageAlign'\nimport CoverOrder from '../Components/CoverOrder'\nimport useAttr from '../../../../Draw/hooks/useAttr';\n\n\nconst ImageSpaceAttr = () => {\n  const {getActiveObject} = useAttr()\n  return (\n    <div className={style.workSpaceAttr}>\n      <div className={style.base}>\n        <div>\n          {/* 设置元素的大小、锁定比例 */}\n          <Size\n            getActiveObject={getActiveObject}\n            showRation={true}\n          />\n        </div>\n        <div>\n          {/* 设置元素的位置、旋转角度 */}\n          <Position/>\n        </div>\n        <div>\n          <Transparent/>\n        </div>\n      </div>\n      <div className={style.division}></div>\n      {/* 页面对齐 */}\n      <PageAlign/>\n      <div className={style.division}></div>\n      {/*图层顺序 */}\n      <CoverOrder/>\n    </div>\n  );\n};\n\nexport default ImageSpaceAttr;\n","// @ts-nocheck\nimport React from 'react';\nimport Size from '../Components/Size'\nimport style from '../WorkSpaceAttr/index.module.scss'\nimport Position from '../Components/Pos'\nimport Transparent from '../Components/Trans'\nimport PageAlign from '../Components/PageAlign'\nimport CoverOrder from '../Components/CoverOrder'\nimport useAttr from '../../../../Draw/hooks/useAttr'\nimport TextAttr from '../Components/Text';\n\nconst TextSpaceAttr = () => {\n  const {getActiveObject} = useAttr()\n  return (\n    <div className={style.workSpaceAttr}>\n      <div className={style.base}>\n        <div>\n          {/* 设置元素的大小、锁定比例 */}\n          <Size getActiveObject={getActiveObject} showRation/>\n        </div>\n        <div>\n          {/* 设置元素的位置、旋转角度 */}\n          <Position/>\n        </div>\n        <div>\n          <Transparent/>\n        </div>\n      </div>\n      <div className={style.division}/>\n      <TextAttr/>\n      <div className={style.division}/>\n      {/* 页面对齐 */}\n      <PageAlign/>\n      <div className={style.division}/>\n      {/*图层顺序 */}\n      <CoverOrder/>\n    </div>\n  );\n};\n\nexport default TextSpaceAttr;\n","import React, { createContext, useState } from 'react'\nimport { DefaultKey } from '../AttrArea/config'\n\ninterface EditorContext {\n  attrTab: string\n  setAttrTab: (value: string) => void\n  loading: boolean\n  setLoading: (value: boolean) => void\n  loadingText: string\n  setLoadingText: (value: string) => void\n\n}\n\nconst InitState: EditorContext = {\n  attrTab: DefaultKey,\n  loading: false,\n  loadingText: '',\n  setLoading: () => {\n  },\n  setLoadingText: () => {\n  },\n  setAttrTab: () => {\n  }\n}\n\nexport const Context = createContext<EditorContext>(InitState)\n\nexport const EditorProvider: React.FC = ({children}) => {\n  const [attrTab, setAttrTab] = useState(DefaultKey);\n  const [loading, setLoading] = useState(false)\n  const [loadingText, setLoadingText] = useState('加载中')\n  const value: EditorContext = {\n    attrTab,\n    loading,\n    loadingText,\n    setLoading,\n    setLoadingText,\n    setAttrTab\n  }\n  return <Context.Provider value={value}>\n    {children}\n  </Context.Provider>\n}\n\n","// @ts-nocheck\n/**\n * 预加载图片单张\n * @param src\n */\nimport { uuid } from './utils';\n\nexport const loadImage = (src: string) => {\n  if (!src) return Promise.resolve()\n  return new Promise((resolve, reject) => {\n    const img = new Image\n    img.onload = () => {\n      resolve()\n    }\n    img.onerror = (err) => {\n      reject(err)\n    }\n    img.src = src\n  })\n}\n\n/**\n * 预加载图片多张\n * @param list\n */\nexport const loadImageList = (list: Array<string>) => {\n  return Promise.all(list.map(src => loadImage(src)))\n}\n\n/**\n * base64转file\n * @param {string} urlData base64格式图片\n * @returns\n */\nexport function base64ConvertFile(urlData: string) {\n  const arr = urlData.split(',')\n  // @ts-ignore\n  const type = arr[0].match(/:(.*?);/)[1]\n  const fileExt = type.split('/')[1]\n  const bstr = atob(arr[1])\n  let n = bstr.length\n  const u8arr = new Uint8Array(n)\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new File([u8arr], `${uuid()}.` + fileExt, {\n    type: type\n  });\n}\n","import axios from 'axios';\n\nconst request = axios.create({\n  baseURL: ''\n})\n\n\nrequest.interceptors.response.use((response) => {\n  if (response.data.code === '200') {\n    return response.data.data;\n  }\n  return response;\n}, error => {\n  console.log(error);\n})\n\nexport const fetch = {\n  get: (url: string, params: any) => {\n    return request.get(url, {params});\n  },\n  post: (url: string, data: any) => {\n    return request.post(url, data)\n  }\n}\n","import { fetch } from './fetch'\n\nexport const getImageList = (data: any) => {\n  return fetch.get('/api_editimg/liststock', data);\n}\n\n// 上传图片\nexport const postUploadImage = (file: any) => {\n  const form = new FormData();\n  form.append('file', file);\n  return fetch.post('/api_image/upload', form);\n}\n\n// add images\nexport const addImageApi = (data: any) => {\n  return fetch.post('/api_editimg/addstock', data);\n}\n\n// save\nexport const saveHistory = (data: any) => {\n  return fetch.post('/api_editimg/save', data);\n}\n\n// delete\nexport const delstock = (data: any) => {\n  return fetch.get('/api_editimg/delstock', data);\n}\n\nexport const getDetail = (data: any) => {\n  return fetch.get('/api_editimg/detail', data);\n}\n\n","import { useCallback } from 'react';\nimport toast from 'react-hot-toast';\n\nconst useToast = () => {\n  const error = useCallback((text: string) => {\n    toast(text,\n      {\n        duration: 1500,\n        // icon: 'err',\n        style: {\n          borderRadius: '10px',\n          background: '#333',\n          color: '#fff',\n        },\n      }\n    );\n  }, [])\n\n  return {\n    error\n  }\n}\nexport default useToast\n","// @ts-nocheck\nimport { fabric } from 'fabric';\nimport { useCallback, useContext } from 'react';\nimport { Context } from '../CanvasContext';\nimport { Context as EditorContext } from '../../Editor/Context';\nimport { base64ConvertFile } from '../../../utils/tool'\nimport { postUploadImage } from '../../../api/image';\nimport useToast from './useToast';\nimport { uuid } from '../../../utils/utils';\n\nconst useClipImage = () => {\n  const {workSpace, canvas, clipImageId, clipRawIndex, setIsClipImage} = useContext(Context)\n  const {setLoading} = useContext(EditorContext)\n  const toast = useToast()\n  /**\n   * 保存裁剪\n   */\n  const saveClipImage = useCallback(async () => {\n    if (!canvas || !workSpace) return\n    const scale = canvas.getZoom()\n    try {\n      let image = null // 被裁剪的图片\n      let rect = null // 裁剪rect\n      let currentClipImageIndex = null // 当前下标\n      canvas.getObjects().forEach((item, index) => {\n        // 获取到裁剪rect\n        if (item.id === 'currentClipRect') {\n          rect = item\n        }\n        // 获取到被裁剪的图片和被裁剪的图片的index\n        if (item.id === clipImageId) {\n          image = item\n          currentClipImageIndex = index\n        }\n      })\n      if (!image || !rect) return\n      setLoading(true)\n      // 创建一个新的rect并保持和裁剪rect位置一致\n      const newRect = new fabric.Rect({\n        left: rect.left,\n        top: rect.top,\n        width: rect.getScaledWidth(),\n        height: rect.getScaledHeight(),\n        absolutePositioned: true,\n      });\n      // 设置图片clipPath（裁剪功能）\n      image.clipPath = newRect;\n\n      // 生成一个image\n      const cropped = new Image();\n      cropped.crossOrigin = 'anonymous'\n      // 把旧的rect删除\n      canvas.remove(rect);\n      // 恢复画布缩放比例\n      canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\n      // 裁剪图片，位置是newRect的位置\n      const base64 = canvas.toDataURL({\n        left: newRect.left,\n        top: newRect.top,\n        width: newRect.width,\n        height: newRect.height,\n      });\n      const file = base64ConvertFile(base64)\n      const res = await postUploadImage(file)\n      cropped.src = res.url\n      // cropped.src = base64\n      // 裁剪完成收回复画布缩放比例\n      workSpace?.setZoomAuto(scale)\n      // 等待裁剪的图片加载完成\n      cropped.onload = function () {\n        // 将原图片删除\n        canvas.remove(image)\n        // 创建新的图片\n        const newImage = new fabric.Image(cropped, {crossOrigin: 'anonymous'});\n        // 这个原图的src很重要，重新编辑的时候会用到\n        // 设置新图片的位置和newRect位置保持一致\n        newImage.set({\n          id: image.id,\n          left: newRect.left,\n          top: newRect.top,\n          rawScaleX: image.scaleX,\n          rawScaleY: image.scaleY,\n          sourceSrc: image.sourceSrc,\n          rectDiffLeft: newRect.left - image.left,\n          rectDiffTop: newRect.top - image.top,\n          prevWidth: newRect.getScaledWidth(),\n          prevHeight: newRect.getScaledHeight()\n        })\n        canvas.add(newImage);\n        if (currentClipImageIndex !== clipRawIndex) {\n          // 如果被裁剪的图片层级发生了变化那么需要恢复image之前的层级\n          while (currentClipImageIndex !== clipRawIndex) {\n            newImage.sendBackwards()\n            currentClipImageIndex--\n          }\n        }\n        canvas.renderAll();\n        // 完成裁剪\n        setIsClipImage(false)\n        setLoading(false)\n      };\n    } catch (err) {\n      setLoading(false)\n      workSpace?.setZoomAuto(scale)\n      cancelClipImage()\n      toast.error('裁剪失败，请稍后重试~')\n      console.log(err)\n    }\n  }, [canvas, workSpace, clipImageId, clipRawIndex])\n  /**\n   * 取消裁剪\n   */\n  const cancelClipImage = useCallback(() => {\n    if (!canvas) return\n    let rect = null // 裁剪rect\n    let clipImage = null // 被裁剪的图片\n    let currentClipImageIndex = null // 被裁剪的图片的index\n    canvas.getObjects().forEach((item, index) => {\n      // 获取到裁剪rect\n      if (item.id === 'currentClipRect') {\n        rect = item\n      }\n      // 获取到被裁剪的图片和被裁剪的图片的index\n      if (item.id === clipImageId) {\n        clipImage = item\n        currentClipImageIndex = index\n      }\n    })\n    if (!clipImage) return\n    // 如果点击取消，那么判断有rect就把rect删除\n    if (rect) canvas.remove(rect)\n    canvas.remove(clipImage)\n    const cloneObject = clipImage.get('cloneObject')\n    if (!clipImage) return\n    cloneObject.set({\n      id: uuid(),\n      sourceSrc: clipImage.sourceSrc,\n      rawScaleX: clipImage.scaleX,\n      rawScaleY: clipImage.scaleY,\n      rectDiffLeft: clipImage.rectDiffLeft,\n      rectDiffTop: clipImage.rectDiffTop,\n    })\n    canvas.add(cloneObject)\n    if (cloneObject && currentClipImageIndex !== clipRawIndex) {\n      // 如果被裁剪的图片层级发生了变化那么需要恢复image之前的层级\n      while (currentClipImageIndex !== clipRawIndex) {\n        cloneObject.sendBackwards()\n        currentClipImageIndex--\n      }\n    }\n    // 完成裁剪，恢复状态\n    setIsClipImage(false)\n    canvas.renderAll()\n  }, [canvas, workSpace, clipImageId, clipRawIndex])\n\n  return {\n    saveClipImage,\n    cancelClipImage\n  }\n}\n\nexport default useClipImage\n","// @ts-nocheck\nimport { fabric } from 'fabric';\nimport { throttle, uuid } from '../utils/utils';\nimport { events, Types } from '../utils/events';\nimport { isNumber } from '../utils';\nimport { canvas } from 'file-saver';\nimport { divide, subtract } from '../utils/calculate';\n\nconst DefaultWidth = 1024\nconst DefaultHeight = 1024\n\ndeclare type EditorWorkspaceOption = {\n  src: string | undefined\n  callback?: () => void\n  canvasData: any\n};\ndeclare type ExtCanvas = fabric.Canvas & {\n  isDragging: boolean;\n  lastPosX: number;\n  lastPosY: number;\n};\nexport const DefaultWorkSpaceColor = 'rgba(255,255,255,1)'\n\nclass EditorWorkspace {\n  canvas: fabric.Canvas;\n  workspaceEl: HTMLElement;\n  workspace: fabric.Rect | null;\n  option: EditorWorkspaceOption;\n  dragMode: boolean;\n  fill: string;\n  width: number | undefined\n  height: number | undefined\n  scale: number\n\n  constructor(canvas: fabric.Canvas, option: EditorWorkspaceOption) {\n    this.canvas = canvas;\n    const workspaceEl = document.querySelector('#workspace') as HTMLElement;\n    if (!workspaceEl) {\n      throw new Error('element #workspace is missing, plz check!');\n    }\n    this.workspaceEl = workspaceEl;\n    this.workspace = null;\n    this.option = option;\n    this.dragMode = false;\n    this.fill = DefaultWorkSpaceColor\n    this._initBackground();\n    this._initWorkspace();\n    this._initResizeObserve();\n    this._initDring();\n  }\n\n  // 初始化背景\n  _initBackground() {\n    this.canvas.setWidth(this.workspaceEl.offsetWidth);\n    this.canvas.setHeight(this.workspaceEl.offsetHeight);\n  }\n\n  // 初始化画布\n  _initWorkspace() {\n    const {src, canvasData, callback} = this.option\n    // 如果canvasData有数据的话这里要走反显逻辑\n    if (canvasData && canvasData.objects.length) {\n      const rectOptions = canvasData.objects.find(item => item.type === 'rect')\n      this.width = rectOptions.width\n      this.height = this.height = rectOptions.height\n      this.fill = rectOptions.fill\n      this.canvas.loadFromJSON(canvasData, () => {\n        const workspace = this.canvas.getObjects().find((item) => item.id === 'workspace')\n        workspace.set('selectable', false)\n        workspace.set('hasControls', false)\n        this.setSize(workspace.width as number, workspace.height as number)\n        this.canvas.renderAll()\n        callback()\n      })\n      return;\n    }\n    if (!src) {\n      // 如果没有传入图片url，用默认宽高生成背景\n      this.width = DefaultWidth\n      this.height = DefaultHeight\n      this._initRect()\n      return\n    }\n\n    fabric.Image.fromURL(src, img => {\n      img.set({\n        type: 'image',\n        left: 0.5,\n        top: 0.5,\n        id: 'mainImg'\n      })\n      this.width = img.width || DefaultWidth\n      this.height = img.height || DefaultHeight\n      this._initRect(img)\n    }, {crossOrigin: 'anonymous'})\n  }\n\n  _initRect(img?: fabric.Object) {\n    const workspace = new fabric.Rect({\n      fill: this.fill,\n      width: this.width,\n      height: this.height,\n      id: 'workspace',\n    });\n    workspace.w = this\n    workspace.set('selectable', false);\n    workspace.set('hasControls', false);\n    workspace.hoverCursor = 'default';\n    this.canvas.add(workspace);\n    if (img && img.width && img.height) {\n      // 如果图片加载失败，不添加到画布中\n      this.canvas.add(img)\n    }\n    this.canvas.renderAll();\n    this.workspace = workspace;\n    this.option.callback?.();\n    this.auto();\n  }\n\n  setBgColor(color: string) {\n    this.fill = color;\n    this.workspace?.set({fill: color});\n    this.canvas.renderAll();\n  }\n\n  /**\n   * 设置画布中心到指定对象中心点上\n   * @param {Object} obj 指定的对象\n   */\n  setCenterFromObject(obj: fabric.Rect) {\n    const {canvas} = this;\n    const objCenter = obj.getCenterPoint();\n    const viewportTransform = canvas.viewportTransform;\n    if (canvas.width === undefined || canvas.height === undefined || !viewportTransform) return;\n    viewportTransform[4] = canvas.width / 2 - objCenter.x * viewportTransform[0];\n    viewportTransform[5] = canvas.height / 2 - objCenter.y * viewportTransform[3];\n    canvas.setViewportTransform(viewportTransform);\n    canvas.renderAll();\n  }\n\n  // 初始化监听器\n  _initResizeObserve() {\n    const resizeObserver = new ResizeObserver(\n      throttle(() => {\n        this.auto();\n      }, 50)\n    );\n    resizeObserver.observe(this.workspaceEl);\n  }\n\n  setSize(width: number, height: number) {\n    this._initBackground();\n    this.width = isNumber(width) ? width : +width;\n    this.height = isNumber(height) ? height : +height;\n    // 重新设置workspace\n    this.workspace = this.canvas\n      .getObjects()\n      .find((item) => item.id === 'workspace') as fabric.Rect;\n    this.workspace.set('width', this.width);\n    this.workspace.set('height', this.height);\n    this.auto();\n  }\n\n  setZoomAuto(scale: number, cb?: (left?: number, top?: number) => void) {\n    const {workspaceEl} = this;\n    const width = workspaceEl.offsetWidth;\n    const height = workspaceEl.offsetHeight;\n    this.canvas.setWidth(width);\n    this.canvas.setHeight(height);\n    const center = this.canvas.getCenter();\n    this.canvas.setViewportTransform(fabric.iMatrix.concat());\n    this.canvas.zoomToPoint(new fabric.Point(center.left, center.top), scale);\n    if (!this.workspace) return;\n    this.setCenterFromObject(this.workspace);\n\n    // 超出画布不展示\n    this.workspace.clone((cloned: fabric.Rect) => {\n      this.canvas.clipPath = cloned;\n      this.canvas.requestRenderAll();\n    });\n    if (cb) cb(this.workspace.left, this.workspace.top);\n  }\n\n  getScale() {\n    const viewPortWidth = this.workspaceEl.offsetWidth;\n    const viewPortHeight = this.workspaceEl.offsetHeight;\n    const width = this.width || 0\n    const height = this.height || 0\n    if (!width || !height) return 0\n    // 按照宽度\n    if (viewPortWidth / viewPortHeight < width / height) {\n      return subtract(divide(viewPortWidth, width), 0.08)\n    } // 按照宽度缩放\n    return subtract(divide(viewPortHeight, height), 0.08)\n  }\n\n  // 放大\n  big(value: number) {\n    let zoomRatio = this.canvas.getZoom();\n    zoomRatio += value || 0.05;\n    if (zoomRatio >= 3) {\n      zoomRatio = 3\n    }\n    events.emit(Types.CHANGE_SCALE, zoomRatio)\n    const center = this.canvas.getCenter();\n    this.canvas.zoomToPoint(new fabric.Point(center.left, center.top), zoomRatio);\n  }\n\n  // 缩小\n  small(value: number) {\n    let zoomRatio = this.canvas.getZoom();\n    zoomRatio -= value || 0.05;\n    if (zoomRatio <= 0.1) {\n      zoomRatio = 0.1\n    }\n    events.emit(Types.CHANGE_SCALE, zoomRatio)\n    const center = this.canvas.getCenter();\n    this.canvas.zoomToPoint(\n      new fabric.Point(center.left, center.top),\n      zoomRatio < 0 ? 0.01 : zoomRatio\n    );\n  }\n\n  // 自动缩放\n  auto() {\n    const scale = this.getScale();\n    if (scale) {\n      this.scale = scale\n      events.emit(Types.CHANGE_SCALE, scale)\n      this.setZoomAuto(scale);\n    }\n  }\n\n  // 1:1 放大\n  one() {\n    this.setZoomAuto(0.8 - 0.08);\n    this.canvas.requestRenderAll();\n  }\n\n  // 开始拖拽\n  startDring() {\n    this.dragMode = true;\n    this.canvas.defaultCursor = 'grab';\n  }\n\n  endDring() {\n    this.dragMode = false;\n    this.canvas.defaultCursor = 'default';\n  }\n\n  // 拖拽模式\n  _initDring() {\n    const This = this;\n    this.canvas.on('mouse:down', function (this: ExtCanvas, opt) {\n      const evt = opt.e;\n      if (evt.altKey || This.dragMode) {\n        This.canvas.defaultCursor = 'grabbing';\n        This.canvas.discardActiveObject();\n        This._setDring();\n        this.selection = false;\n        this.isDragging = true;\n        this.lastPosX = evt.clientX;\n        this.lastPosY = evt.clientY;\n        this.requestRenderAll();\n      }\n    });\n\n    this.canvas.on('mouse:move', function (this: ExtCanvas, opt) {\n      if (this.isDragging) {\n        This.canvas.discardActiveObject();\n        This.canvas.defaultCursor = 'grabbing';\n        const {e} = opt;\n        if (!this.viewportTransform) return;\n        const vpt = this.viewportTransform;\n        vpt[4] += e.clientX - this.lastPosX;\n        vpt[5] += e.clientY - this.lastPosY;\n        this.lastPosX = e.clientX;\n        this.lastPosY = e.clientY;\n        this.requestRenderAll();\n      }\n    });\n\n    this.canvas.on('mouse:up', function (this: ExtCanvas) {\n      if (!this.viewportTransform) return;\n      this.setViewportTransform(this.viewportTransform);\n      this.isDragging = false;\n      this.selection = true;\n      this.getObjects().forEach((obj) => {\n        if (obj.id !== 'workspace' && obj.hasControls) {\n          obj.selectable = true;\n        }\n      });\n      this.requestRenderAll();\n      This.canvas.defaultCursor = 'default';\n    });\n\n    this.canvas.on('mouse:wheel', function (this: fabric.Canvas, opt) {\n      const delta = opt.e.deltaY;\n      let zoom = this.getZoom();\n      zoom *= 0.999 ** delta;\n      if (zoom > 20) zoom = 20;\n      if (zoom < 0.01) zoom = 0.01;\n      const center = this.getCenter();\n      this.zoomToPoint(new fabric.Point(center.left, center.top), zoom);\n      opt.e.preventDefault();\n      opt.e.stopPropagation();\n    });\n  }\n\n  _setDring() {\n    this.canvas.selection = false;\n    this.canvas.defaultCursor = 'grab';\n    this.canvas.getObjects().forEach((obj) => {\n      obj.selectable = false;\n    });\n    this.canvas.renderAll();\n    this.canvas.requestRenderAll();\n  }\n}\n\nexport default EditorWorkspace;\n","import { useCallback, useContext, useRef, useState } from 'react';\nimport { Context } from '../CanvasContext';\nimport { saveAs } from 'file-saver';\nimport { uuid } from '../../../utils/utils';\nimport { saveHistory as saveHistoryApi } from '../../../api/image';\nimport useClipImage from './useClipImage';\nimport useToast from './useToast';\n\nconst useSave = () => {\n  const toast = useToast()\n  const {editor, canvas, workSpace, mainUrl, isClipImage, clipImageId, clipRawIndex} = useContext(Context)\n  const {cancelClipImage} = useClipImage()\n  const [saveToImageLoading, setSaveToImageLoading] = useState(false)\n  const useLast = useRef<any>({})\n  useLast.current = {\n    editor,\n    mainUrl,\n  }\n  /**\n   * send beacon\n   */\n  const unloadSendBeacon = useCallback(() => {\n    const {editor, mainUrl} = useLast.current\n    if (!editor || !mainUrl) return\n    const dataJson = editor.getJson()\n    // 把裁剪蒙层过滤出去\n    dataJson.objects = dataJson.objects.filter((item: any) => item.id !== 'currentClipRect')\n    const data = JSON.stringify({\n      data: dataJson ? JSON.stringify(dataJson) : '',\n      imgSrc: mainUrl\n    })\n    const blob = new Blob([data], {type: 'application/json'})\n    const isPush = navigator.sendBeacon('/api_editimg/save', blob)\n    console.log('navigator.sendBeacon event', isPush)\n  }, [editor, mainUrl])\n  /**\n   * 保存历史修改记录\n   */\n  const saveHistory = useCallback(() => {\n    if (!editor || !mainUrl) return\n    const dataJson = editor.getJson()\n    return saveHistoryApi({\n      data: dataJson ? JSON.stringify(dataJson) : '',\n      imgSrc: mainUrl\n    })\n  }, [editor, mainUrl])\n  /**\n   * 保存为json\n   */\n  const saveToJson = useCallback(() => {\n    if (!editor) return\n    saveHistory()\n    const dataUrl = editor.getJson();\n    const fileStr = `data:text/json;charset=utf-8,${encodeURIComponent(\n      JSON.stringify(dataUrl, null, '\\t')\n    )}`;\n    saveAs(fileStr, `${uuid()}.json`)\n  }, [editor])\n\n  /**\n   * 保存为图片\n   */\n  const saveToImage = useCallback(async () => {\n    if (saveToImageLoading) return\n    if (!canvas || !editor) return;\n    // 如果正在编辑图片\n    if (isClipImage) {\n      cancelClipImage()\n    }\n    try {\n      setSaveToImageLoading(true)\n      await saveHistory()\n      const workspace = canvas?.getObjects().find((item) => item.id === 'workspace');\n      editor.ruler.hideGuideline();\n      if (!workspace) return;\n      const {left, top, width, height} = workspace;\n      const option = {\n        format: 'png',\n        quality: 1,\n        left,\n        top,\n        width,\n        height,\n      };\n      const scale = canvas.getZoom()\n      canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);\n      const dataUrl = canvas.toDataURL(option);\n      saveAs(dataUrl, `${uuid()}.png`);\n      workSpace?.setZoomAuto(scale)\n      // 恢复之前的缩放比例\n      editor.ruler.showGuideline();\n      setSaveToImageLoading(false)\n    } catch (err) {\n      console.log('onSaveToImage err', err)\n      workSpace?.auto()\n      toast.error(err.message)\n      setSaveToImageLoading(false)\n    }\n  }, [canvas, editor, workSpace, isClipImage, clipImageId, clipRawIndex])\n\n  return {\n    saveToJson,\n    saveHistory,\n    unloadSendBeacon,\n    saveToImage\n  }\n}\n\nexport default useSave\n","import React, { useEffect, useContext } from 'react'\nimport styles from './styles.module.css'\nimport { fabric } from 'fabric'\nimport Editor from '../../core';\nimport { Context } from './CanvasContext'\nimport { Context as EditorContext } from '../Editor/Context'\nimport useEvents from './hooks/useEvents';\nimport EditorWorkspace from '../../core/EditorWorkspace';\nimport { getDetail } from '../../api/image';\nimport { loadImage } from '../../utils/tool';\nimport useSave from './hooks/useSave';\nimport useChangeFontFamily from './hooks/useChangeFontFamily';\n\n\nconst Draw: React.FC<{ src?: string }> = (props) => {\n  const {setCanvas, setEditor, setWorkSpace, setShow, setMainUrl} = useContext(Context)\n  const {setLoading} = useContext(EditorContext)\n  const {loadFont, fontLoaded} = useChangeFontFamily()\n  const {unloadSendBeacon} = useSave()\n  useEvents()\n\n  useEffect(() => {\n    if (!fontLoaded) return\n    init()\n    setMainUrl(props.src)\n  }, [fontLoaded])\n\n  useEffect(() => {\n    window.addEventListener('beforeunload', () => {\n      unloadSendBeacon()\n    })\n  }, [])\n\n  const init = async () => {\n    // 没有src不去请求，直接生成背景\n    if (!props.src) {\n      return initCanvas()\n    }\n    // 获取接口的历史数据\n    try {\n      const res: any = await getDetail({imgSrc: props.src})\n      initCanvas(JSON.parse(res))\n    } catch (err) {\n      initCanvas()\n    }\n  }\n  /**\n   * 初始化canvas\n   * @param canvasData\n   */\n  const initCanvas = async (canvasData?: any) => {\n    let mainImg = null;\n    if (canvasData && canvasData.objects) {\n      // 先从缓存中获取主图src\n      mainImg = canvasData.objects.find((item: any) => item.id === 'mainImg')?.src\n    } else {\n      // 缓存中取不到就去看props里是否有\n      mainImg = props.src\n    }\n    // 主图和字体包会很大，这里做个loading\n    try {\n      setLoading(true)\n      await loadFont(canvasData?.objects)\n      await loadImage(mainImg)\n      setLoading(false)\n    } catch (err) {\n      console.log(`initCanvas error`, err)\n      setLoading(false)\n    }\n\n    const canvas = new fabric.Canvas('fabric-canvas', {\n      fireRightClick: true, // 启用右键，button的数字为3\n      stopContextMenu: true, // 禁止默认右键菜单\n      controlsAboveOverlay: true, // 超出clipPath后仍然展示控制条\n      preserveObjectStacking: true\n    })\n    const workSpace = new EditorWorkspace(canvas, {\n      src: props.src,\n      callback: () => setShow(true),\n      canvasData,\n    })\n    const editor = new Editor(canvas)\n    setWorkSpace(workSpace)\n    setCanvas(canvas)\n    setEditor(editor)\n  }\n\n  return (\n    <div className={styles.workContent} id='workspace'>\n      <canvas className={styles.canvas} id='fabric-canvas'/>\n    </div>\n  )\n}\n\nexport default Draw\n","// @ts-nocheck\nimport { useCallback, useContext, useEffect } from 'react';\nimport { Context } from '../CanvasContext';\nimport { Context as EditorContext } from '../../Editor/Context'\nimport { fabric } from 'fabric';\nimport { KeyNames } from '../../../utils/hotEventKeys';\nimport { hotkeys } from '../../../core/initHotKeys'\nimport useClipImage from './useClipImage';\nimport { isUndef } from '../../../utils';\nimport { events, Types } from '../../../utils/events';\n\nconst useEvents = () => {\n  const {\n    canvas, editor, workSpace, setSelectMode, setSelectIds, setSelectOneType,\n    clipImageId, setIsClipImage, clipRawIndex,\n    isClipImage\n  } = useContext(Context)\n  const {setLoading} = useContext(EditorContext)\n  const {cancelClipImage} = useClipImage()\n  useEffect(() => {\n    events.on(Types.SHOW_LOADING, setLoading)\n    return () => {\n      events.off(Types.SHOW_LOADING, setLoading)\n    }\n  }, [])\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on({\n      'selection:created': selected,\n      'selection:updated': selected,\n      'selection:cleared': selected,\n      'mouse:wheel': onWheel\n    })\n    return () => {\n      canvas.off({\n        'selection:created': selected,\n        'selection:updated': selected,\n        'selection:cleared': selected,\n        'mouse:wheel': onWheel\n      })\n    }\n  }, [canvas, editor])\n  useEffect(() => {\n    hotkeys(KeyNames.delete, deleteObjects);\n    return () => {\n      hotkeys.unbind(KeyNames.delete, deleteObjects);\n    }\n  }, [canvas, isClipImage, clipImageId])\n  useEffect(() => {\n    hotkeys(KeyNames.zoom, onZoom)\n    return () => {\n      hotkeys.unbind(KeyNames.zoom, onZoom)\n    }\n  }, [canvas, workSpace])\n  // useEffect(() => {\n  //   if (!canvas) return\n  //   canvas.on('selection:updated', selectionUpdated)\n  //   return () => {\n  //     canvas.off('selection:updated', selectionUpdated)\n  //   }\n  // }, [canvas, isClipImage, clipImageId, clipRawIndex])\n  //\n  // const selectionUpdated = useCallback(() => {\n  //   const objects = canvas?.getActiveObjects()\n  //   if (isClipImage) {\n  //     cancelClipImage()\n  //   }\n  // }, [canvas, isClipImage, clipImageId, clipRawIndex])\n  /**\n   * 单选多选事件\n   */\n  const selected = useCallback(() => {\n    if (!canvas) return\n    const actives = canvas\n      .getActiveObjects()\n      .filter((item) => !(item instanceof fabric.GuideLine)); // 过滤掉辅助线\n    if (actives && actives.length === 1) {\n      const activeObject = actives[0]\n      if (activeObject && activeObject.type === 'image') {\n        activeObject.set({\n          prevWidth: activeObject.getScaledWidth(),\n          prevHeight: activeObject.getScaledHeight()\n        })\n        canvas.renderAll()\n      }\n      if (activeObject.type === 'i-text') {\n        activeObject.setControlsVisibility({\n          mt: false,\n          ml: false,\n          mb: false,\n          mr: false,\n        })\n        canvas.renderAll()\n      }\n      setSelectMode('one')\n      setSelectIds([activeObject.id])\n      setSelectOneType(activeObject.type)\n    } else if (actives && actives.length > 1) {\n      setSelectMode('multiple')\n      setSelectIds(actives.map(item => item.id as string))\n    } else {\n      setSelectMode('')\n      setSelectIds([])\n      setSelectOneType('')\n    }\n  }, [canvas, editor])\n  /**\n   * 放大缩小\n   */\n  const onZoom = useCallback((e) => {\n    if (e.code === 'Minus') {\n      workSpace?.small(0.05)\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    if (e.code === 'Equal') {\n      workSpace?.big(0.05)\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }, [canvas, workSpace])\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on('object:modified', (e) => {\n      const target = e.transform?.target\n      if (!target) return\n      if (target.type !== 'image') return\n      if (isUndef(target.rawScaleX) || isUndef(target.rawScaleY)) return\n      const prevWidth = target.prevWidth\n      const prevHeight = target.prevHeight\n      target.set({\n        rawScaleX: target.getScaledWidth() / prevWidth * target.rawScaleX,\n        rawScaleY: target.getScaledHeight() / prevHeight * target.rawScaleY,\n        prevWidth: target.getScaledWidth(),\n        prevHeight: target.getScaledHeight()\n      })\n      canvas.renderAll()\n\n    })\n  }, [canvas])\n  /**\n   * 鼠标缩放事件\n   */\n  const onWheel = useCallback(({e}) => {\n    const delta = e.deltaY;\n    // 根据滚轮方向调整缩放级别\n    if (delta > 0) {\n      workSpace?.small(0.01)\n    } else {\n      workSpace?.big(0.01)\n    }\n    // 阻止默认滚轮事件\n    e.preventDefault();\n    e.stopPropagation();\n  }, [canvas, workSpace])\n\n  const deleteClipImageAndRect = useCallback(() => {\n    if (!canvas) return\n    let rect = null // 裁剪rect\n    let clipImage = null // 被裁剪的图片\n    canvas.getObjects().forEach((item) => {\n      if (item.id === 'currentClipRect') {\n        rect = item\n      }\n      if (item.id === clipImageId) {\n        clipImage = item\n      }\n    })\n    if (!rect || !clipImage) return\n    canvas.remove(rect)\n    canvas.remove(clipImage)\n    canvas.discardActiveObject()\n    canvas.renderAll()\n    setIsClipImage(false)\n  }, [canvas, clipImageId])\n  /**\n   * 删除\n   */\n  const deleteObjects = useCallback(() => {\n    // 如果正在剪裁图片\n    if (isClipImage) {\n      return\n      // deleteClipImageAndRect()\n    }\n    const activeObject = canvas.getActiveObjects()\n    if (activeObject) {\n      activeObject.map((item) => canvas.remove(item))\n      canvas.discardActiveObject()\n      canvas.renderAll()\n    }\n  }, [canvas, isClipImage, clipImageId])\n}\n\nexport default useEvents\n","import React from 'react'\nimport style from './index.module.scss'\nimport useSave from '../../Draw/hooks/useSave';\n\ninterface ImportFileProps {\n  onBack?: () => void\n}\n\nconst ImportFile: React.FC<ImportFileProps> = (props) => {\n  const {saveHistory, unloadSendBeacon} = useSave()\n  const back = () => {\n    saveHistory()\n    unloadSendBeacon()\n    props.onBack?.()\n  }\n  return (\n    <div className={style.importFile}>\n      {\n        props.onBack ? <span className={style.back} onClick={back}>\n        <img src='https://ossprod.jrdaimao.com/file/1690265070713402.svg' alt=''/>\n        <img src=\"https://ossprod.jrdaimao.com/file/1690358472515604.svg\" alt=\"\"/>\n        <span>返回</span>\n      </span> : null\n      }\n\n      {/*<span className={style.openFile}>*/}\n      {/*  <img src=\"https://ossprod.jrdaimao.com/file/1690423416245892.svg\" alt=\"\"/>*/}\n      {/*  <img src=\"https://ossprod.jrdaimao.com/file/1690423788579835.svg\" alt=\"\"/>*/}\n      {/*  <span>打开文件</span>*/}\n      {/*</span>*/}\n    </div>\n  )\n}\n\nexport default ImportFile\n","import { useMemo, useRef } from 'react';\n\ntype noop = (this: any, ...args: any[]) => any;\n\ntype PickFunction<T extends noop> = (\n  this: ThisParameterType<T>,\n  ...args: Parameters<T>\n) => ReturnType<T>;\n\nfunction useMemoizedFn<T extends noop>(fn: T) {\n  const fnRef = useRef<T>(fn);\n\n  // why not write `fnRef.current = fn`?\n  // https://github.com/alibaba/hooks/issues/728\n  fnRef.current = useMemo(() => fn, [fn]);\n\n  const memoizedFn = useRef<PickFunction<T>>();\n  if (!memoizedFn.current) {\n    memoizedFn.current = function (this, ...args) {\n      return fnRef.current.apply(this, args);\n    };\n  }\n\n  return memoizedFn.current as T;\n}\n\nexport default useMemoizedFn;\n","// @ts-nocheck\nimport { useRef, useState } from 'react';\nimport useMemoizedFn from './useMemoizedFn';\nimport { isNumber } from '../utils';\n\ninterface IData<T> {\n  present?: T;\n  past: T[];\n  future: T[];\n}\n\nconst dumpIndex = <T>(step: number, arr: T[]) => {\n  let index =\n    step > 0\n      ? step - 1 // move forward\n      : arr.length + step; // move backward\n  if (index >= arr.length - 1) {\n    index = arr.length - 1;\n  }\n  if (index < 0) {\n    index = 0;\n  }\n  return index;\n};\n\nconst split = <T>(step: number, targetArr: T[]) => {\n  const index = dumpIndex(step, targetArr);\n  return {\n    _current: targetArr[index],\n    _before: targetArr.slice(0, index),\n    _after: targetArr.slice(index + 1),\n  };\n};\n\nexport default function useHistoryTravel<T>(initialValue?: T, maxLength: number = 0) {\n  const [history, setHistory] = useState<IData<T | undefined>>({\n    present: initialValue,\n    past: [],\n    future: [],\n  });\n\n  const { present, past, future } = history;\n  const initialValueRef = useRef(initialValue);\n\n  const reset = (...params: any[]) => {\n    const _initial = params.length > 0 ? params[0] : initialValueRef.current;\n    initialValueRef.current = _initial;\n\n    setHistory({\n      present: _initial,\n      future: [],\n      past: [],\n    });\n  };\n\n  const updateValue = (val: T) => {\n    const _past = [...past, present];\n    const maxLengthNum = isNumber(maxLength) ? maxLength : Number(maxLength);\n    // maximum number of records exceeded\n    if (maxLengthNum > 0 && _past.length > maxLengthNum) {\n      //delete first\n      _past.splice(0, 1);\n    }\n    setHistory({\n      present: val,\n      future: [],\n      past: _past,\n    });\n  };\n\n  const _forward = (step: number = 1) => {\n    if (future.length === 0) {\n      return;\n    }\n    const { _before, _current, _after } = split(step, future);\n    setHistory({\n      past: [...past, present, ..._before],\n      present: _current,\n      future: _after,\n    });\n  };\n\n  const _backward = (step: number = -1) => {\n    if (past.length === 0) {\n      return;\n    }\n\n    const { _before, _current, _after } = split(step, past);\n    setHistory({\n      past: _before,\n      present: _current,\n      future: [..._after, present, ...future],\n    });\n  };\n\n  const go = (step: number) => {\n    const stepNum = isNumber(step) ? step : Number(step);\n    if (stepNum === 0) {\n      return;\n    }\n    if (stepNum > 0) {\n      return _forward(stepNum);\n    }\n    _backward(stepNum);\n  };\n\n  return {\n    value: present,\n    backLength: past.length,\n    forwardLength: future.length,\n    setValue: useMemoizedFn(updateValue),\n    go: useMemoizedFn(go),\n    back: useMemoizedFn(() => {\n      go(-1);\n    }),\n    forward: useMemoizedFn(() => {\n      go(1);\n    }),\n    reset: useMemoizedFn(reset),\n  };\n}\n","import useHistoryTravel from '../../../hooks/useHistoryTravel';\nimport { useCallback, useContext, useEffect, useRef } from 'react';\nimport { Context } from '../CanvasContext';\n\nconst useHistory = () => {\n  const {canvas, workSpace, editor, clipImageId, isClipImage} = useContext(Context)\n  const {value, setValue, go, reset, backLength, forwardLength} = useHistoryTravel<any>(undefined, 50)\n  const historyFlagRef = useRef(false)\n\n\n  useEffect(() => {\n    canvas?.on({\n      'object:added': save,\n      'object:modified': save,\n      'object:removed': save\n    })\n    return () => {\n      canvas?.off({\n        'object:added': save,\n        'object:modified': save,\n        'object:removed': save\n      })\n    }\n  }, [canvas, editor, setValue, isClipImage, clipImageId])\n  useEffect(() => {\n    if (!workSpace || !editor) return\n    reset(editor.getJson());\n  }, [editor, workSpace])\n  useEffect(() => {\n    if (!canvas) return\n    if (!historyFlagRef.current) return\n    canvas?.clear();\n    canvas?.loadFromJSON(value, () => {\n      historyFlagRef.current = false\n      canvas.renderAll();\n    });\n  }, [value, canvas])\n  /**\n   * 每次操作保存历史记录\n   * @param event\n   */\n  const save = useCallback((event: any) => {\n    // 过滤选择元素事件\n    const isSelect = event.action === undefined && event.e;\n    if (isSelect || !canvas) return\n    if (historyFlagRef.current) return\n    if (event.target && event.target.id === \"currentClipRect\") {\n      // 裁剪图片新增的rect不需要记录\n      return\n    }\n    if (isClipImage && event.target.id === clipImageId || event.target.id === 'clipRawImage'){\n      return\n    }\n    setValue(editor?.getJson())\n  }, [canvas, editor, setValue, isClipImage, clipImageId])\n  /**\n   * 后退\n   */\n  const undo = useCallback(() => {\n    historyFlagRef.current = true\n    go(-1);\n  }, [go])\n  /**\n   * 重做\n   */\n  const redo = useCallback(() => {\n    historyFlagRef.current = true\n    go(1);\n  }, [go]);\n  return {\n    undo,\n    redo,\n    backLength,\n    forwardLength,\n  }\n}\n\nexport default useHistory\n","// @ts-nocheck\nimport React, { useContext, useEffect, useRef, useState } from 'react'\nimport { Context } from '../../Draw'\nimport { events, Types } from '../../../utils/events'\nimport { KeyNames } from '../../../utils/hotEventKeys'\nimport { hotkeys } from '../../../core/initHotKeys'\nimport styles from './styles.module.scss'\nimport { floatRound } from '../../../utils/calculate'\nimport useClipImage from '../../Draw/hooks/useClipImage'\nimport useHistory from '../../Draw/hooks/useHistory';\n\nconst HeaderControl = () => {\n  const {\n    workSpace, drawMode, setDrawMode, canvas, editor, isClipImage,\n    setIsClipImage, setClipImageId, setClipRawIndex, clipImageId, clipRawIndex\n  } = useContext(Context)\n  const {saveClipImage, cancelClipImage} = useClipImage()\n  const {undo, redo, backLength, forwardLength} = useHistory()\n  const [scale, setScale] = useState(0)\n  const drawModeRef = useRef('default')\n  drawModeRef.current = drawMode\n\n  useEffect(() => {\n    hotkeys(KeyNames.enter, saveClipImage)\n    hotkeys(KeyNames.esc, cancelClipImage)\n    return () => {\n      hotkeys.unbind(KeyNames.enter, saveClipImage)\n      hotkeys.unbind(KeyNames.esc, cancelClipImage)\n    }\n  }, [canvas, workSpace, clipImageId, clipRawIndex])\n  useEffect(() => {\n    hotkeys(KeyNames.ctrlz, undo)\n    hotkeys(KeyNames.ctrlshiftz, redo)\n    events.on(Types.CLIP_IMAGE, onClipImage)\n    return () => {\n      hotkeys.unbind(KeyNames.ctrlz, undo)\n      hotkeys.unbind(KeyNames.ctrlshiftz, redo)\n      events.off(Types.CLIP_IMAGE, onClipImage)\n    }\n  }, [])\n  useEffect(() => {\n    if (workSpace?.scale) {\n      setScale(floatRound(workSpace.scale * 100))\n    }\n  }, [workSpace?.scale])\n  useEffect(() => {\n    events.on(Types.CHANGE_SCALE, scale => {\n      setScale(floatRound(scale * 100))\n    })\n    window.addEventListener('keydown', onKeyDown)\n    window.addEventListener('keyup', onKeyUp)\n    return () => {\n      window.removeEventListener('keydown', onKeyDown)\n      window.removeEventListener('keyup', onKeyUp)\n    }\n  }, [workSpace, drawMode])\n\n  /**\n   * 裁剪的回调，存储一些裁剪信息\n   * @param visible\n   * @param rawIndex\n   * @param clipImageId\n   */\n  const onClipImage = ({visible, rawIndex, clipImageId}) => {\n    setIsClipImage(visible)\n    setClipRawIndex(rawIndex)\n    setClipImageId(clipImageId)\n  }\n  /**\n   * 按下空格开启拖拽模式\n   * @param e\n   */\n  const onKeyDown = (e: any) => {\n    if (e.code !== 'Space') return\n    if (drawModeRef.current === 'move') return\n    switchDragMode()\n  }\n  /**\n   * 抬起空格取消拖拽模式\n   * @param e\n   */\n  const onKeyUp = (e: any) => {\n    if (e.code !== 'Space') return\n    switchDefaultMode()\n  }\n  /**\n   * 开启拖拽模式\n   */\n  const switchDragMode = () => {\n    editor?.disableGuidelines?.()\n    workSpace?.startDring()\n    setDrawMode('move')\n  }\n  /**\n   * 恢复默认模式\n   */\n  const switchDefaultMode = () => {\n    editor?.enableGuidelines?.()\n    workSpace?.endDring()\n    setDrawMode('default')\n  }\n  // 是否正在剪裁图片，如果正在裁剪图片应该展示裁剪图片的按钮\n  if (isClipImage) {\n    return <div className={styles.headerControl}>\n      <span className={styles.clipSaveButton} onClick={saveClipImage}>\n        <img src=\"https://ossprod.jrdaimao.com/file/1691980964433863.svg\" alt=\"\"/>\n        <img src=\"https://ossprod.jrdaimao.com/file/1691981310968623.svg\" alt=\"\"/>\n        <span>保存</span>\n      </span>\n      <span className={styles.clipSaveButton} onClick={cancelClipImage}>\n        <img src=\"https://ossprod.jrdaimao.com/file/1691980998460679.svg\" alt=\"\"/>\n        <img src=\"https://ossprod.jrdaimao.com/file/1691981320881591.svg\" alt=\"\"/>\n        <span>取消</span>\n      </span>\n    </div>\n  }\n\n  return (\n    <div className={styles.headerControl}>\n      <div>\n        {/* 撤销 */}\n        <div\n          data-tooltip-content=\"撤销 Ctrl Z\"\n          data-tooltip-place=\"bottom\"\n          onClick={undo}\n          className={`${styles.button} ${backLength ? '' : styles.disabled}`}\n        >\n          <img\n            src={backLength ?\n              \"https://ossprod.jrdaimao.com/file/1690509281581673.svg\" :\n              \"https://ossprod.jrdaimao.com/file/1690789676330313.svg\"}\n            alt=\"\"\n          />\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509933132558.svg\" alt=\"\"/>\n        </div>\n        {/* 重做 */}\n        <div\n          onClick={redo}\n          className={`${styles.button} ${forwardLength ? '' : styles.disabled}`}\n          id='control-tooltip'\n          data-tooltip-content=\"重做 Ctrl Shift Z\"\n          data-tooltip-place=\"bottom\"\n        >\n          <img\n            src={forwardLength ?\n              \"https://ossprod.jrdaimao.com/file/1690509311318726.svg\" :\n              \"https://ossprod.jrdaimao.com/file/1690789758114451.svg\"}\n            alt=\"\"\n          />\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509942889198.svg\" alt=\"\"/>\n        </div>\n      </div>\n      <div className={styles.line}/>\n      <div>\n        {/* 拖拽 */}\n        <div\n          className={`${styles.button} ${drawMode === 'move' ? styles.active : ''}`}\n          onClick={switchDragMode}\n          id='control-tooltip'\n          data-tooltip-content=\"移动视图 Space\"\n          data-tooltip-place=\"bottom\"\n        >\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509577879796.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509952709638.svg\" alt=\"\"/>\n        </div>\n        {/* 默认鼠标 */}\n        <div\n          className={`${styles.button} ${drawMode === 'default' ? styles.active : ''}`}\n          onClick={switchDefaultMode}\n          id='control-tooltip'\n          data-tooltip-content=\"选择\"\n          data-tooltip-place=\"bottom\"\n        >\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509620102920.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509961015895.svg\" alt=\"\"/>\n        </div>\n      </div>\n      <div className={styles.line}/>\n      <div>\n        {/* 放大 */}\n        <div\n          className={styles.button}\n          onClick={() => workSpace?.big()}\n          id='control-tooltip'\n          data-tooltip-content=\"放大视图 Ctrl +\"\n          data-tooltip-place=\"bottom\"\n        >\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509650392929.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/169050996966396.svg\" alt=\"\"/>\n        </div>\n        {/* 缩小 */}\n        <div\n          className={styles.button}\n          onClick={() => workSpace?.small()}\n          id='control-tooltip'\n          data-tooltip-content=\"缩小视图 Ctrl -\"\n          data-tooltip-place=\"bottom\"\n        >\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509673723181.svg\" alt=\"\"/>\n          <img src=\"https://ossprod.jrdaimao.com/file/1690509977928322.svg\" alt=\"\"/>\n        </div>\n        {/* 比例 */}\n        <div style={{visibility: scale ? 'visible' : 'hidden'}} className={styles.ratioText}>{scale}%</div>\n      </div>\n    </div>\n  );\n}\n\n\nexport default HeaderControl\n","// @ts-nocheck\nimport React from 'react'\nimport styles from './index.module.scss'\nimport useSave from '../../Draw/hooks/useSave'\n\nconst SaveButton = () => {\n  const { saveToImage } = useSave()\n  return (\n    <div className={styles.headerRightControl}>\n      {/*<span className={styles.previewButton} onClick={onPreview}>*/}\n      {/*  <img src=\"https://ossprod.jrdaimao.com/file/1690422594923183.svg\" alt=\"\"/>*/}\n      {/*  <img src=\"https://ossprod.jrdaimao.com/file/1690423932285584.svg\" alt=\"\"/>*/}\n      {/*  <span>预览</span>*/}\n      {/*</span>*/}\n      <span className={styles.saveWrap}>\n        <span onClick={saveToImage} className={styles.saveButton}>\n          下&nbsp;载\n        </span>\n        {/*<span className={`${styles.fixButton} ${show ? styles.showButton : ''}`}>*/}\n        {/*<span onClick={onSaveToJson}>保存</span>*/}\n        {/*<span onClick={onSaveToImage}>保存为图片</span>*/}\n        {/*</span>*/}\n      </span>\n    </div>\n  )\n}\n\nexport default SaveButton\n","// @ts-nocheck\nimport { useCallback, useContext } from 'react';\nimport { Context } from '../CanvasContext';\nimport { Context as EditorContext } from '../../Editor/Context'\nimport { fabric } from 'fabric';\nimport { uuid } from '../../../utils/utils';\nimport useClipImage from './useClipImage';\n\n// 默认参数\nconst DefaultOptions = {\n  text: {\n    fill: '#000000'\n  },\n  image: {},\n}\n\nconst useAddObject = () => {\n  const {workSpace, canvas, isClipImage, clipImageId, clipRawIndex} = useContext(Context)\n  const {cancelClipImage} = useClipImage()\n  const {setLoading} = useContext(EditorContext)\n  /**\n   * 新增图片\n   * @param item\n   */\n  const addImage = useCallback((src, options, callback) => {\n    if (!workSpace) return\n    setLoading(true)\n    if (isClipImage) cancelClipImage()\n    const scale = workSpace.getScale()\n    fabric.Image.fromURL(`${src}?t=${Date.now()}`, img => {\n      if (!img.width || !img.height) {\n        setLoading(false)\n        return\n      }\n      img.set({\n        ...DefaultOptions.image,\n        id: uuid(),\n        scaleY: scale,\n        scaleX: scale,\n        left: (workSpace.width - img.width * scale) / 2,\n        top: (workSpace.height - img.height * scale) / 2,\n        ...options,\n      })\n      canvas?.add(img)\n      canvas?.setActiveObject(img);\n      callback?.(img)\n      canvas?.renderAll();\n      setLoading(false)\n    }, {crossOrigin: 'anonymous'})\n  }, [workSpace, canvas, clipImageId, clipRawIndex])\n\n  /**\n   * 新增文字\n   */\n  const addText = useCallback((item) => {\n    if (!workSpace) return\n    if (isClipImage) cancelClipImage()\n    const text = new fabric.IText(item.title, {\n      fontFamily: 'serif',\n      fontSize: item.style.fontSize as number * 3,\n      fontWeight: item.style.fontWeight as number,\n      id: uuid(),\n      lockScalingX: false,\n      lockScalingY: false,\n      ...DefaultOptions.text,\n    })\n    text.set({\n      left: (workSpace.width - text.width) / 2,\n      top: (workSpace.height - text.height) / 2,\n    })\n    canvas?.add(text)\n    canvas?.setActiveObject(text)\n    canvas?.renderAll();\n  }, [workSpace, canvas, clipImageId, clipRawIndex])\n  return {\n    addImage,\n    addText,\n  }\n}\nexport default useAddObject\n","import { CSSProperties } from 'react';\n\nexport type TextListItem = {\n  title: string\n  key: string\n  style: CSSProperties\n}\n\nexport const textList:Array<TextListItem> = [\n  {\n    title: '添加标题',\n    key: 'addTitle',\n    style: {\n      fontSize: 20,\n      fontWeight: 600\n    }\n  },\n  {\n    title: '添加副标题',\n    key: 'addSubTitle',\n    style: {\n      fontSize: 16,\n      fontWeight: 600\n    }\n  },\n  {\n    title: '添加正文',\n    key: 'addText',\n    style: {\n      fontSize: 14\n    }\n  },\n  {\n    title: '添加注释',\n    key: 'addAnnotation',\n    style: {\n      fontSize: 12\n    }\n  }\n]\n","import ImageResource from '../Components/Resource/ImageResource'\nimport TextResource from '../Components/Resource/TextResource';\n\nexport type ResourceNavItem = {\n  title: string\n  icon: string\n  activeIcon: string\n  key: string\n}\n\nexport const ResourceTypeEnum = {\n  ALREADY_UPLOAD: 'alreadyUpload',\n  TEXT: 'i-text'\n}\n\nexport const resourceNavList = [\n  {\n    title: '已上传',\n    icon: 'https://ossprod.jrdaimao.com/file/1690351687096238.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690351735822596.svg',\n    key: ResourceTypeEnum.ALREADY_UPLOAD\n  },\n  {\n    title: '文 字',\n    icon: 'https://ossprod.jrdaimao.com/file/1690351715036668.svg',\n    activeIcon: 'https://ossprod.jrdaimao.com/file/1690351759741179.svg',\n    key: ResourceTypeEnum.TEXT\n  }\n]\n\nexport const ResourceContentComEnum = {\n  [ResourceTypeEnum.ALREADY_UPLOAD]: ImageResource,\n  [ResourceTypeEnum.TEXT]: TextResource\n}\nexport const DefaultSelectKey = ResourceTypeEnum.ALREADY_UPLOAD\n","// @ts-nocheck\nimport React, { useContext, useEffect, useRef, useState } from 'react'\nimport styles from './index.module.scss'\nimport { useDropDown } from './dropDown';\nimport useAddObject from '../../../../Draw/hooks/useAddObject';\nimport { addImageApi, getImageList, postUploadImage } from '../../../../../api/image';\nimport { Context } from '../../../../Draw';\nimport { Context as EditorContext } from '../../../Context'\nimport useToast from '../../../../Draw/hooks/useToast';\n\nconst ImageResource = () => {\n  const {setLoading} = useContext(EditorContext)\n  const toast = useToast()\n  const {canvas} = useContext(Context)\n  const EDIT_IMAGE_LIST = sessionStorage.getItem('EDIT_IMAGE_LIST')\n  const [uploading, setUploading] = useState(false)\n  const {addImage} = useAddObject()\n\n  const [list, setList] = useState(EDIT_IMAGE_LIST ?\n    JSON.parse(EDIT_IMAGE_LIST) :\n    [])\n  const {run} = useDropDown()\n\n\n  useEffect(() => {\n    queryList()\n  }, [])\n\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on('drop', onDrop)\n    canvas.on('dragover', onDragover)\n    return () => {\n      canvas.off('drop', onDrop)\n      canvas.off('dragover', onDragover)\n    }\n  }, [canvas])\n\n  // 添加画布的拖拽事件监听器\n  const onDrop = ({e}) => {\n    e.preventDefault()\n    const imageUrl = e.dataTransfer.getData('text/plain');\n    // 画布元素距离浏览器左侧和顶部的距离\n    let offset = {\n      left: canvas.getSelectionElement().getBoundingClientRect().left,\n      top: canvas.getSelectionElement().getBoundingClientRect().top\n    }\n    // 鼠标坐标转换成画布的坐标（未经过缩放和平移的坐标）\n    let point = {\n      x: e.x - offset.left,\n      y: e.y - offset.top,\n    }\n    // 转换后的坐标，restorePointerVpt 不受视窗变换的影响\n    let pointerVpt = canvas.restorePointerVpt(point)\n    addImage(imageUrl, {}, img => {\n      img.set({\n        left: pointerVpt.x - img.getScaledWidth() / 2,\n        top: pointerVpt.y - img.getScaledHeight() / 2,\n      })\n    })\n  }\n  // 阻止画布的默认拖拽行为\n  const onDragover = ({e}) => {\n    e.preventDefault()\n  }\n  const onClickMore = (e: any, item: any) => {\n    run(e, {...item, callback: queryList})\n  }\n  /**\n   * 获取图片数据\n   */\n  const queryList = async () => {\n    try {\n      const res = await getImageList({ pageIndex: 1, pageSize: 500})\n      if (res) {\n        sessionStorage.setItem('EDIT_IMAGE_LIST', JSON.stringify(res))\n      }\n      setList(res)\n    } catch (err) {\n      console.log(err)\n    }\n  }\n  /**\n   * 上传文件\n   * @param e\n   */\n  const onUploadFile = async (e: any) => {\n    if (uploading) return\n    const fileList = e.target.files\n    try {\n      setUploading(true)\n      setLoading(true)\n      for (let i = 0; i < fileList.length; i++) {\n        const file = fileList[i]\n        if (!/(png|jpg|jpeg)/g.test(file.type)) continue\n        const res = await postUploadImage(file)\n        await addImageApi({\n          imgSrc: res.url,\n          stockName: file.name\n        })\n      }\n      await queryList()\n    } catch (err) {\n      console.log(err)\n      toast.error(err.message)\n    } finally {\n      setUploading(false)\n      setLoading(false)\n      // e.target.value = ''\n    }\n  }\n\n  const onDragStart = e => {\n    e.dataTransfer.setData('text/plain', e.target.src);\n  }\n  return (\n    <div className={styles.imageResource}>\n      {/*<div className={styles.searchBox}>*/}\n      {/*  <input type='text' placeholder='请输入' onChange={e => searchRef.current = e.target.value}/>*/}\n      {/*  <img src=\"https://ossprod.jrdaimao.com/file/1690356901972689.svg\" alt=\"\"/>*/}\n      {/*</div>*/}\n      <div className={styles.uploadFile}>\n        <span>{uploading ? '上传中...' : '上传文件'}</span>\n        <input multiple disabled={uploading} type=\"file\" accept='.png,.jpg,.jpeg' onChange={onUploadFile}/>\n      </div>\n      {\n        !list?.length ? <div className={styles.empty}>\n          <img src=\"https://ossprod.jrdaimao.com/file/169035729200810.png\" alt=\"\"/>\n          <p>还没有文件哦~</p>\n        </div> : null\n      }\n      {\n        list?.length ? <div className={styles.fileList} id='img-file-list'>\n          {\n            list.map((item) => {\n              return <div\n                key={item._id}\n                className={styles.fileListItem}\n              >\n                <img\n                  onDragStart={onDragStart}\n                  onClick={() => addImage(item.imgSrc)}\n                  className={styles.image}\n                  src={item.imgSrc}\n                  alt=\"\"\n                />\n                <img\n                  onClick={(e) => onClickMore(e, item)}\n                  className={styles.more}\n                  src=\"https://ossprod.jrdaimao.com/file/1690363754666532.svg\"\n                  alt=\"\"\n                />\n              </div>\n            })\n          }\n        </div> : null\n      }\n    </div>\n  )\n}\n\nexport default ImageResource\n","// @ts-nocheck\nimport React, { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { saveAs } from 'file-saver';\nimport { delstock } from '../../../../../api/image';\nimport { Context } from '../../../Context';\n\n\nexport const useDropDown = () => {\n  const clickRef = useRef()\n  const cacheItem = useRef()\n  const [show, setShow] = useState(false)\n  const {setLoading} = useContext(Context)\n  const shareEl = useRef()\n\n\n  useEffect(() => {\n    const el = document.querySelector('#img-file-list')\n    if (!el) return\n    if (show) {\n      el.style.overflow = 'hidden'\n    } else {\n      el.style.overflow = 'auto'\n    }\n  }, [show])\n  useEffect(() => {\n    window.addEventListener('click', removeEl)\n    return () => {\n      removeEl()\n      window.removeEventListener('click', removeEl)\n    }\n  }, [])\n\n  const removeEl = useCallback((e) => {\n    if (e?.target === clickRef.current) return\n    if (shareEl.current) {\n      document.body.removeChild(shareEl.current)\n      shareEl.current = null\n      setShow(false)\n    }\n  }, [])\n  const onClick = async (e) => {\n    // e.stopPropagation()\n    if (!e.target || !cacheItem.current) return\n    const {imgSrc, stockName, _id, callback} = cacheItem.current\n    if (e.target.innerHTML === '下载') {\n      saveAs(imgSrc, `${stockName}${imgSrc.slice(imgSrc.lastIndexOf('.'))}`)\n    }\n    if (e.target.innerHTML === '删除') {\n      try {\n        setLoading(true)\n        await delstock({id: _id})\n        await callback?.()\n        setLoading(false)\n      } catch (err) {\n        setLoading(false)\n      }\n    }\n  }\n  const run = (e: any, item: any) => {\n    setShow(true)\n    cacheItem.current = item\n    if (shareEl.current) {\n      document.body.removeChild(shareEl.current)\n      shareEl.current = null\n    }\n    clickRef.current = e.target;\n    const parentNode = e.target.parentNode\n    const {top, left} = parentNode.getBoundingClientRect()\n    const div = shareEl.current = document.createElement('div')\n    div.addEventListener('click', onClick)\n    div.innerHTML = `<div class='customMenu' style='left:${left + parentNode.offsetWidth + 10}px;top:${top}px'>\n<!--    <div class='editName'>-->\n<!--      <span>某某文件名...名称.png</span>-->\n<!--      <img src=\"https://ossprod.jrdaimao.com/file/1690528866207938.svg\" alt=\"\"/>-->\n<!--    </div>-->\n    <div class='buttons'>\n      <div>下载</div>\n      <div>删除</div>\n    </div>\n  </div>`\n    document.body.appendChild(div)\n  }\n  return {\n    run\n  }\n}\n","// @ts-nocheck\nimport React from 'react'\nimport { textList } from './config'\nimport styles from './index.module.scss'\nimport useAddObject from '../../../../Draw/hooks/useAddObject';\n\n\nconst TextResource = () => {\n  const {addText} = useAddObject()\n  return (\n    <div className={styles.textResource}>\n      <div className={styles.addShareTextButton}>\n        <span onClick={() => addText({...textList[3], title: '文本框'})}>添加文本框</span>\n      </div>\n      <div className={styles.textList}>\n        {\n          textList.map(item => {\n            return <div\n              onClick={() => addText(item)}\n              key={item.key}\n              style={item.style}\n              className={styles.textListItem}\n            >\n              <span>{item.title}</span>\n            </div>\n          })\n        }\n      </div>\n    </div>\n  )\n}\n\nexport default TextResource\n","// @ts-nocheck\nimport React, { useState } from 'react'\nimport { ResourceContentComEnum, DefaultSelectKey, ResourceNavItem, resourceNavList } from './config'\nimport styles from './index.module.scss'\n\n\nconst ResourceArea = () => {\n  const [collapsed, setCollapsed] = useState(false);\n  const [activeKey, setActiveKey] = useState(DefaultSelectKey)\n  const onResourceNavChange = (item: ResourceNavItem) => {\n    setActiveKey(item.key)\n  }\n  const activeIndex = resourceNavList.findIndex(item => item.key === activeKey)\n  const ResourceComponent = ResourceContentComEnum[activeKey]\n  const onSetCollapsed = () => {\n    if (!collapsed) {\n      document.body.style.setProperty('--dm-change-resource-content-width', '0')\n      setCollapsed(true)\n    } else {\n      document.body.style.setProperty('--dm-change-resource-content-width', '240px')\n      setCollapsed(false)\n    }\n  }\n  return (\n    <div className={styles.resourceArea}>\n      <div className={styles.resourceNav}>\n        {\n          resourceNavList.map((item, index) => {\n            const active = activeIndex === index\n            let className = `${styles.resourceNavItem} ${active ? styles.resourceNavItemActive : ''}`\n            // 获取一下高亮的前一个元素加下border-radius\n            if (index === activeIndex - 1) {\n              className += styles.resourceNavItemPrevActive\n            }\n            return <div\n              onClick={() => onResourceNavChange(item)}\n              className={className}\n              key={item.key}\n            >\n              <img src={active ? item.activeIcon : item.icon} alt=\"\"/>\n              <span>{item.title}</span>\n            </div>\n          })\n        }\n        <div className={styles.resourceNavPlace}/>\n      </div>\n      <div className={styles.resourceContent}>\n        <ResourceComponent/>\n        <div className={styles.packUp} onClick={onSetCollapsed}>\n          <img\n            src={collapsed ?\n              'https://ossprod.jrdaimao.com/file/1690513793832702.svg' :\n              'https://ossprod.jrdaimao.com/file/1690445829374723.svg'\n            }\n            alt=\"\"\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default ResourceArea\n","// @ts-nocheck\nimport React, { useCallback, useContext, useEffect, useState } from 'react'\nimport { sortableContainer, sortableElement, arrayMove } from 'react-sortable-hoc'\nimport { fabric } from 'fabric'\nimport style from './index.module.scss'\nimport { Context } from '../../Draw'\nimport userOrder from '../../Draw/hooks/userOrder';\nimport useLock from '../../Draw/hooks/useLock';\n\nconst SortableItem = sortableElement((props: { item }) => {\n  const {changeOwnLock} = useLock()\n  const {item} = props\n  const {selectIds, canvas} = useContext(Context)\n  const isLock = item.object.hasControls\n  const isVisible = item.object.visible\n  /**\n   * 设置高亮\n   */\n  const clickItem = useCallback(() => {\n    if (!canvas) return\n    canvas.setActiveObject(item.object)\n    canvas.renderAll()\n  }, [item, canvas])\n\n  /**\n   * 锁定对象\n   */\n  const onLockObject = (e) => {\n    e.stopPropagation()\n    changeOwnLock(!isLock, item.object)\n  }\n  /**\n   * 隐藏对象\n   */\n  const onHiddenObject = (e) => {\n    e.stopPropagation()\n    item.object.set({visible: !isVisible})\n    canvas?.renderAll()\n  }\n  const fontFamily = item.object.get('fontFamily')\n  return <div\n    onClick={clickItem}\n    className={`${style.orderListItem} ${selectIds.includes(item.id) ? style.active : ''}`}\n  >\n    <div className={style.button}>\n      {/* 隐藏 */}\n      <img\n        draggable={false}\n        onClick={onHiddenObject}\n        src={isVisible ?\n          'https://ossprod.jrdaimao.com/file/1690437893570728.svg' :\n          'https://ossprod.jrdaimao.com/file/1690945206225980.svg'}\n        alt=\"\"\n      />\n      {/* 锁定 */}\n      <img\n        draggable={false}\n        onClick={onLockObject}\n        src={isLock ?\n          'https://ossprod.jrdaimao.com/file/1690437902259961.svg' :\n          'https://ossprod.jrdaimao.com/file/1690944574168632.svg'}\n        alt=\"\"\n      />\n    </div>\n    <div className={style.content}>\n      {/*目前只有俩类型，先这样写吧，后面多了跨域拆成枚举组件*/}\n      {\n        item.type === 'image' ?\n          <div className={style.image}>\n            <img draggable={false} src={item.src} alt=\"\"/>\n          </div> :\n          <div\n            className={style.text}\n            style={{fontFamily: fontFamily || 'serif'}}\n          >\n            {item.text}\n          </div>\n      }\n    </div>\n    <DragHandle/>\n  </div>\n});\n\nconst DragHandle = () => {\n  return <div className={style.move}>\n    <img draggable={false}\n         src=\"https://ossprod.jrdaimao.com/file/1690437934587361.svg\" alt=\"\"/>\n  </div>\n}\n\nconst SortableContainer = sortableContainer(({children}: { children }) => {\n  return children\n})\n\nconst OrderList = () => {\n  const {canvas} = useContext(Context)\n  const {up, upTop, down, downTop} = userOrder()\n  const [list, setList] = useState([])\n  /**\n   * 修改层级顺序\n   * @param oldIndex\n   * @param newIndex\n   */\n  const onSortEnd = useCallback(({oldIndex, newIndex}) => {\n    // 位置不变不处理\n    if (oldIndex === newIndex) return\n    const oldObject = list[oldIndex]?.object;\n    if (!oldObject) return\n    if (newIndex < oldIndex) {\n      if (newIndex === 0) return upTop(oldObject)\n      // 上移\n      for (let i = newIndex; i < oldIndex; i++) {\n        up(oldObject)\n      }\n    } else {\n      if (newIndex === list.length - 1) return downTop(oldObject)\n      // 下移\n      for (let i = oldIndex; i < newIndex; i++) {\n        down(oldObject)\n      }\n    }\n    setList(prevState => arrayMove(prevState, oldIndex, newIndex))\n  }, [list, setList, up, upTop, down, downTop]);\n\n  useEffect(() => {\n    if (!canvas) return\n    canvas.on('after:render', getList);\n    return () => {\n      canvas.off('after:render', getList);\n    }\n  }, [canvas])\n\n  /**\n   * 获取列表数据\n   */\n  const getList = useCallback(() => {\n    const objects = canvas?.getObjects() || []\n    const list = [\n      ...objects.filter((item) => {\n        // 过滤掉辅助线和背景和裁剪rect\n        return !(item instanceof fabric.GuideLine || item.id === 'workspace' || item.id === 'currentClipRect');\n      })\n    ]\n      .reverse()\n      .map((item) => {\n        const {type, id, text} = item;\n        const src = type === 'image' ? item._element?.src : undefined\n        return {\n          object: item,\n          type,\n          id,\n          text,\n          src\n        };\n      });\n    setList(list)\n  }, [setList, canvas]);\n\n  return (\n    <div className={style.orderWrap}>\n      <div className={style.orderListTitle}>图层</div>\n      {\n        !list.length ? <div className={style.orderListEmpty}>\n          <div className={style.empty}>\n            <img src=\"https://ossprod.jrdaimao.com/file/169035729200810.png\" alt=\"\"/>\n            <p>暂无图层~</p>\n          </div>\n        </div> : null\n      }\n      {\n        list.length ? <SortableContainer distance={10} lockAxis=\"y\" onSortEnd={onSortEnd}>\n          <div className={style.orderList}>\n            {\n              list.map((item, index) => {\n                return <SortableItem index={index} key={item.id} item={item}/>\n              })\n            }\n          </div>\n        </SortableContainer> : null\n      }\n    </div>\n  )\n}\n\nexport default OrderList\n","// @ts-nocheck\nimport React, { useContext, useEffect, useState } from 'react';\nimport Size from '../Components/Size'\nimport style from './index.module.scss'\nimport { SketchPicker } from 'react-color'\nimport { Context } from '../../../../Draw';\nimport { DefaultWorkSpaceColor } from '../../../../../core/EditorWorkspace';\n\nconst ColorPicker: any = SketchPicker\n\nconst WorkSpaceAttr = () => {\n  const {workSpace} = useContext(Context)\n  const [color, setColor] = useState(workSpace?.fill || DefaultWorkSpaceColor)\n  const onChangeColor = (e) => {\n    setColor(e.hex)\n    console.log('change bg color e.hex', e.hex)\n    workSpace?.setBgColor(e.hex)\n  }\n  return (\n    <div className={style.workSpaceAttr}>\n      <div className={style.base}>\n        <div>\n          {/* 设置元素的大小、锁定比例 */}\n          <Size isWorkSpace getActiveObject={() => workSpace?.workspace}/>\n        </div>\n        <div>\n          <div className={style.title}>背景色</div>\n          <ColorPicker\n            color={color}\n            onChange={onChangeColor}\n            className={style.colorPicker}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default WorkSpaceAttr;\n","import React, { useContext, useMemo } from 'react'\nimport style from './index.module.scss'\nimport { attrAreaComponent, attrTabList, AttrTabListItem } from './config'\nimport { Context as EditorContext } from '../Context'\nimport OrderList from '../OrderList';\nimport WorkSpaceAttr from '../Components/Attr/WorkSpaceAttr'\nimport { Context } from '../../Draw';\n\nconst AttrArea = () => {\n  const {selectOneType} = useContext(Context)\n  const {attrTab, setAttrTab} = useContext(EditorContext)\n  const bg = useMemo(() => {\n    return attrTabList.find(item => item.key === attrTab)?.bg\n  }, [attrTabList, attrTab])\n\n  const onChangeTab = (item: AttrTabListItem) => {\n    setAttrTab(item.key)\n  }\n  const AttrCom = attrAreaComponent[selectOneType];\n  return (\n    <div className={style.attrWrap}>\n      <div className={style.attrTab} style={{backgroundImage: `url(${bg})`}}>\n        {\n          attrTabList.map(item => {\n            return <div\n              onClick={() => onChangeTab(item)}\n              key={item.key}\n              className={attrTab === item.key ? style.attrTabActive : ''}\n            >\n              <span>{item.title}</span>\n            </div>\n          })\n        }\n      </div>\n      <div id='attr-content' className={style.attrContent}>\n        <div style={{display: attrTab === 'Attr' ? 'block' : 'none'}}>\n          {\n            AttrCom ? <AttrCom/> : <WorkSpaceAttr/>\n          }\n        </div>\n        <div style={{display: attrTab === 'coverage' ? 'block' : 'none'}}>\n          <OrderList/>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default AttrArea\n","// @ts-nocheck\nimport React, { useContext, useEffect } from 'react'\nimport ImportFile from './ImportFile'\nimport HeaderControl from './HeaderControl'\nimport SaveButton from './SaveButton'\nimport ResourceArea from './ResourceArea'\nimport Draw, { Context } from '../Draw'\nimport { Context as EditorContext } from './Context'\nimport AttrArea from './AttrArea'\nimport LoadingOverlay from 'react-loading-overlay'\nimport styles from './styles.module.css'\nimport { EditImageProps } from '../../index';\n\nconst Editor: React.FC<EditImageProps> = (props) => {\n  const {loading, loadingText} = useContext(EditorContext)\n  const {show} = useContext(Context)\n\n  return <LoadingOverlay\n    active={loading}\n    spinner\n    text={loadingText}\n  >\n    <div className={styles.dmEditImageContainer}>\n      <div className={styles.header}>\n        {/* 导入文件 */}\n        <ImportFile onBack={props.onBack}/>\n        {/* 快捷操作 */}\n        { show ?  <HeaderControl/> : null}\n        {/* 保存 */}\n        <SaveButton />\n      </div>\n      <div className={styles.content}>\n        {/* 左侧资源区域 */}\n        <ResourceArea/>\n        <div className={styles.canvasArea}>\n          {/* 画布区域 */}\n          <Draw src={props.src}/>\n        </div>\n        {\n          <div className={styles.attrArea}>\n            {/* 属性区域 */}\n            <AttrArea/>\n          </div>\n        }\n      </div>\n    </div>\n  </LoadingOverlay>\n}\n\nexport default Editor\n","import React from 'react'\nimport { CanvasProvider } from './components/Draw'\nimport { EditorProvider } from './components/Editor/Context'\nimport Editor from './components/Editor'\nimport { Toaster } from 'react-hot-toast'\n\n\nexport interface EditImageProps {\n  src?: string\n  onBack?: () => void\n}\n\nexport const EditImage: React.FC<EditImageProps> = (props) => {\n  return (\n    <CanvasProvider>\n      <EditorProvider>\n        <Editor\n          onBack={props.onBack}\n          src={props.src}\n        />\n        <Toaster/>\n      </EditorProvider>\n    </CanvasProvider>\n  )\n}\n","import React from 'react'\nimport { EditImage } from '@dm/edit-image'\nimport '@dm/edit-image/dist/index.css'\n\nconst App = () => {\n  return <>\n    <EditImage src={\"http://localhost:5678/static/images/9897c2e019e04304ba01293579ed1ce2~tplv-p14lwwcsbr-7.jpeg\"} />\n  </>\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}